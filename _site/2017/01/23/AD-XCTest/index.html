<!DOCTYPE html>
<html>

  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <title>持续集成系列 - 测试: XCTest</title>
    <meta name="description" content="  测试简述          自动执行测试,自动构建并分发,自动部署到 ITC      Unit 代表单元测试:        UI自动化测试框架  iOS 自动化测试实践测试简述自动执行测试,自动构建并分发,自动部署到 ITC自动化测试 –&gt; 持续部署在互联网的产品开发时代，产品迭代越来越频繁，“从功...">

    <link rel="shortcut icon" href="/favicon.ico?" type="image/x-icon">
    <link rel="icon" href="/favicon.ico?" type="image/x-icon">
    <link rel="stylesheet" href="/css/fontawesome/css/font-awesome.min.css ">
    <link rel="stylesheet" href="/css/main.css ">
    <link rel="canonical" href="http://localhost:4000/2017/01/23/AD-XCTest/">
    <link rel="alternate" type="application/rss+xml" title="3行代码" href="http://localhost:4000/feed.xml ">


<script>
    // 百度统计代码
    var _hmt = _hmt || [];
    (function() {
     var hm = document.createElement("script");
     hm.src = "//hm.baidu.com/hm.js?d9432112fb859bf7276f8399641fb0c5";
     var s = document.getElementsByTagName("script")[0];
     s.parentNode.insertBefore(hm, s);
     })();
    </script>




    <script>
    // google analytics
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-85978943-1', 'auto');
      ga('send', 'pageview');

    </script>

</head>


  <body>

    <header id="top">
    <div class="wrapper">
        <a href="/" class="brand">3行代码</a>
        <small>技术博客</small>
        <button id="headerMenu" class="menu"><i class="fa fa-bars"></i></button>
        <nav id="headerNav">
            <ul>
                
                <li>
                    
                    <a href="/">
                    
                        <i class="fa fa-home"></i>Home
                    </a>
                </li>


                
                    
                    <li>
                        
                        <a href="/archive/">
                        
                            <i class="fa fa-archive"></i>Archives
                        </a>
                    </li>
                    
                
                    
                    <li>
                        
                        <a href="/category/">
                        
                            <i class="fa fa-th-list"></i>Categories
                        </a>
                    </li>
                    
                
                    
                    <li>
                        
                        <a href="/tag/">
                        
                            <i class="fa fa-tags"></i>Tags
                        </a>
                    </li>
                    
                
                    
                    <li>
                        
                        <a href="/collection/">
                        
                            <i class="fa fa-bookmark"></i>Collections
                        </a>
                    </li>
                    
                
                    
                    <li>
                        
                        <a href="/about/">
                        
                            <i class="fa fa-heart"></i>About
                        </a>
                    </li>
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
            </ul>
        </nav>
    </div>
</header>


        <div class="page clearfix" post>
    <div class="left">
        <h1>持续集成系列 - 测试: XCTest</h1>
        <div class="label">

            <div class="label-card">
                <i class="fa fa-calendar"></i>2017-01-23
            </div>

            <div class="label-card">
                <i class="fa fa-user"></i>3行代码
                
            </div>

            <div class="label-card">
                
            </div>

            <div class="label-card">
            


<!-- <span class="point">•</span> -->
<span class="categories">
  <i class="fa fa-th-list"></i>
  
    
        <a href="/category/#CI" title="Category: CI" rel="category">CI</a>
    
  

  <!-- <span class="point">•</span> -->
</span>


            </div>

            <div class="label-card">
            
<!-- <span class="point">•</span> -->
<span class="pageTag">
  <i class="fa fa-tags"></i>
  
    
        <!--a href="/tag/#XCTest" title="Tag: XCTest" rel="tag">XCTest</a-->
        <a href="/tag/#XCTest" title="Tag: XCTest" rel="tag">XCTest</a>
    
  

</span>

            </div>

        </div>
        <hr>
        <article itemscope itemtype="http://schema.org/BlogPosting">
        <ul id="markdown-toc">
  <li><a href="#section" id="markdown-toc-section">测试简述</a>    <ul>
      <li><a href="#itc" id="markdown-toc-itc">自动执行测试,自动构建并分发,自动部署到 ITC</a></li>
      <li><a href="#unit-" id="markdown-toc-unit-">Unit 代表单元测试:</a></li>
    </ul>
  </li>
  <li><a href="#ui" id="markdown-toc-ui">UI自动化测试框架</a></li>
  <li><a href="#ios-" id="markdown-toc-ios-">iOS 自动化测试实践</a>    <ul>
      <li><a href="#ui-testing--accessibility" id="markdown-toc-ui-testing--accessibility">UI Testing 和 Accessibility</a></li>
      <li><a href="#demo" id="markdown-toc-demo">demo</a></li>
      <li><a href="#section-1" id="markdown-toc-section-1">参考及延伸阅读</a></li>
    </ul>
  </li>
</ul>

<h3 id="section">测试简述</h3>

<h5 id="itc">自动执行测试,自动构建并分发,自动部署到 ITC</h5>

<p>自动化测试 –&gt; 持续部署</p>

<p>在互联网的产品开发时代，产品迭代越来越频繁，“从功能开发完成直到成功部署”这一阶段被称为软件开发“最后一公里”。很多开发团队也越来越认识到，自动化测试和持续部署可帮助开发团队提高迭代效率和质量。
那么，如何更好地解决“最后一公里”这一问题呢?</p>

<p>一切从自动化测试开始，让自动化测试贯穿在整个项目开发-集成-部署-交付的-开发流程中。</p>

<p><img src="http://huaban.com/go/?pin_id=1002439558" alt="" />
在这个分层自动化测试金字塔中，</p>
<h4 id="unit-">Unit 代表单元测试:</h4>

<p>XCTest是苹果在iOS 7和Xcode5引入的一个简单而强大的测试框架，它的测试编写起来非常简单，并且遵循xUnit风格。XCTest的优点是与Xcode深度集成，有专门的Test导航栏，但因为受限于官方测试API，因此功能不是很丰富。</p>

<p>iOS 中的单元测试开源库:</p>
<ul>
  <li>Kiwi是对XCTest的一个完整替代，使用xSpec风格编写测试。Kiwi带有自己的一套工具集，包括expectations、mocks、stubs，甚至还支持异步测试。</li>
  <li>Specta与Kiwi功能相似，但在架构上非常不同。Kiwi注重功能的整合，而Specta则注重模块化。它本身只专注于运行测试，而将模拟、匹配等功能交给第三方。下
下面这些一些开源测试组件，它们能与Specta和Kiwi框架搭配使用：</li>
  <li>Expecta：匹配程序框架。</li>
  <li>OCHamcrest：匹配程序框架。</li>
  <li>OCMock：模拟测试框架。</li>
  <li>OCMockito：模拟测试框架。</li>
  <li>OHTTPStubs：模拟网络请求的库，基于block的语法来匹配URL。</li>
  <li>Nocilla：模拟网络请求的库，使用链式API。</li>
  <li>Quick是:一个使用Swift开发的新测试框架，对测试使用Swift编写的App非常友好。它还有一个Nimble库用于编写匹配模式。</li>
</ul>

<h2 id="ui">UI自动化测试框架</h2>

<p>一些第三方自动化测试框架则比较成熟，如Appium, MonkeyTalk，Frank等，这里介绍KIF和EarlGrey:开源\内嵌式框架 (以 framework 形式内嵌至应用中) , 本质上是iOS的Unit test
\使用Object-C和Swift\支持真机和模拟器</p>

<ul>
  <li>EarlGrey:原生的 iOS UI 自动化测试框架,写法多样,操作灵活,作为后来者的EarlGrey功能更加强大.<a href="https://github.com/google/EarlGrey">github/文档</a></li>
  <li>KIF:出来早\KIF的语法比较简单\适合快速开发.<a href="">github</a><a href="http://cocoadocs.org/docsets/KIF/3.5.1/">文档</a></li>
</ul>

<h1 id="ios-">iOS 自动化测试实践</h1>

<p>###单元测试（Unit Testing）是针对程序单元进行正确性检验的测试工作,程序单元是应用的 最小可测试部件.</p>

<ul>
  <li>Expecta:专为Objective-C/Cocoa而生，相比OCHamcrest，其优化了匹配的语法，测试用例的可读性更高。</li>
  <li>OCHamcrest:</li>
  <li>GHUnit已被弃用，不能积极维护！使用XCTest来代替。</li>
  <li>OCUnit，被官方集成进XCode 4.x版本中；</li>
</ul>

<p>持续集成CI（Continuous Integration）是一种实践,可以让团队在持续的基础上收到反馈并进行改进,不必等到开发周期后期才寻找和修复缺陷.通俗一点儿说:就是指对于开发人员的每一次代码提交,都自动地把Repository中所有代码Check out到一个空目录,并且自动运行所有Test Case.如果成功则接受这次提交,否则告诉所有人,这是一个失败的Revision[2]</p>

<p>说起 UI 测试,在 iOS 的开源社区有过一系列的尝试,比如 KIF 框架,Apple 自己的 Automating UI Testing 或者 Facebook 的截图测试等.这些方法有一个共同的特点,那就是配置起来十分繁琐,使用上也有诸多不便.这大概也是 UI 测试所面临的最大窘境 – 往往开发者在一个项目里写了一两个 UI 测试用例后,就会觉得难以维护,怯于巨大的时间成本,继而放弃.</p>

<p>Apple 在 Xcode 7 中新加入了一套 UI Testing 的工具,其目的就是解决这个问题.新的 UI Testing 比以往的解决方案要简单不少,特别是在创建测试用例的时候更集成了录制的功能,这有希望让 UI Testing 变得更为普及.</p>

<p>其他概念比如: 单元测试\集成测试.</p>

<p>单元测试:对软件中的最小可测试单元进行检验。通常而言，一个单元测试是用于判断某个特定条件（或者场景）下某个特定函数的行为。相比其他层级的测试，单元测试发现并解决问题付出的成本相对来说最低，而投入产出比最高</p>

<p>集成测试:是在单元测试的基础上，将所有模块按照设计要求（如根据结构图）组装成为子系统或系统，进行集成测试集成测试是在单元测试的基础上，测试在将所有的软件单元按照概要设计规格说明的要求组装成模块、子系统或系统的过程中各部分工作是否达到或实现相应技术指标及要求的活动。也就是说，在集成测试之前，单元测试应该已经完成。这一点很重要，因为如果不经过单元测试，那么集成测试的效果将会受到很大影响，并且会大幅增加软件单元代码纠错的代价。</p>

<h3 id="ui-testing--accessibility">UI Testing 和 Accessibility</h3>

<p>在 iOS 中使用 XCTest, 就必须要了解 Accessibility. UI Accessibility 早在 iOS 3.0 就被引入了,用来辅助身体不便的人士使用 app.VoiceOver 是 Apple 的屏幕阅读技术,而 UI Accessibility 的基本原则就是对屏幕上的 UI 元素进行分类和标记.两者配合,通过阅读或者聆听这些元素,用户就可以在不接触屏幕的情况下通过声音来使用 app.</p>

<p>Accessibility 的核心思想是对 UI 元素进行分类和标记 – 将屏幕上的 UI 分类为像是按钮,文本框,cell 或者是静态文本 (也就是 label) 这样的类型,然后使用 identifier 来区分不同的 UI 元素.用户可以通过语音控制 app 的按钮点击,或是询问某个 label 的内容等等,十分方便.iOS SDK 中的控件都实现了默认的 Accessibility 支持,而我们如果使用自定义的控件的话,则需要自行使用 Accessibility 的 API 来进行添加.</p>

<p>UI 测试的本质就是定位在屏幕上的元素,实现一些像是点击或者拖动这样的操作交互,然后获取 UI 的状态进行断言来判断是否符合我们的预期.这个过程及其需求与 Accessibility 的功能是高度吻合的.这也是为什么 iOS 中大部分的 UI 测试框架都是基于 UI Accessibility 的原因, UI Testing 也不例外.</p>

<h3 id="demo">demo</h3>

<p>demo 比较简单,主要用于演示基本的流程,代码在 GitHub 中.</p>

<p>相比起其他一些 UI 测试框架,Xcode 的 UI Testing 最为诱人的优点在于可以直接录制操作.新建一个 XCTest,默认实现如下:</p>

<div class="language-swift highlighter-rouge"><pre class="highlight"><code><span class="kd">import</span> <span class="kt">XCTest</span>

<span class="kd">class</span> <span class="kt">UITESTUITests</span><span class="p">:</span> <span class="kt">XCTestCase</span> <span class="p">{</span>
        
    <span class="k">override</span> <span class="kd">func</span> <span class="nf">setUp</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">super</span><span class="o">.</span><span class="nf">setUp</span><span class="p">()</span>
        
        <span class="n">continueAfterFailure</span> <span class="o">=</span> <span class="kc">false</span>
        
        <span class="c1">// launch 方法来启动测试 app</span>
        <span class="c1">// XCUIApplication 是 UIApplication 在测试进程中的代理 (proxy)</span>

        <span class="kt">XCUIApplication</span><span class="p">()</span><span class="o">.</span><span class="nf">launch</span><span class="p">()</span> 

    <span class="p">}</span>
    
    <span class="k">override</span> <span class="kd">func</span> <span class="nf">tearDown</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">super</span><span class="o">.</span><span class="nf">tearDown</span><span class="p">()</span>
    <span class="p">}</span>
    
    <span class="kd">func</span> <span class="nf">testExample</span><span class="p">()</span> <span class="p">{</span>
        
    <span class="p">}</span>
    
<span class="p">}</span>
</code></pre>
</div>

<p>使用的方法是,先创建一个测试方法,然后将光标停留在方法中,然后点击录制.和 app 的交互就会被自动转写成代码.</p>

<p><img src="https://ooo.0o0.ooo/2017/02/06/5898158326f72.png" alt="" /></p>

<p>操作是:</p>
<ul>
  <li>2次点击 “color” 按钮 ,改变背景色</li>
  <li>点击”下一页”按钮 push 到第二页</li>
  <li>点击”back” 按钮 pop 回第一页</li>
</ul>

<p><img src="https://ooo.0o0.ooo/2017/02/06/589817a5d03a6.png" alt="" /></p>

<div class="language-swift highlighter-rouge"><pre class="highlight"><code><span class="kd">func</span> <span class="nf">testMyApp</span><span class="p">()</span> <span class="p">{</span>
        
        <span class="k">let</span> <span class="nv">app</span> <span class="o">=</span> <span class="kt">XCUIApplication</span><span class="p">()</span>

        <span class="c1">// "color" 按钮设置 Accessibility id 为 changeColor</span>
        <span class="k">let</span> <span class="nv">changecolorButton</span> <span class="o">=</span> <span class="n">app</span><span class="o">.</span><span class="n">buttons</span><span class="p">[</span><span class="s">"changeColor"</span><span class="p">]</span>

        <span class="n">changecolorButton</span><span class="o">.</span><span class="nf">tap</span><span class="p">()</span>
        <span class="n">changecolorButton</span><span class="o">.</span><span class="nf">tap</span><span class="p">()</span>

        <span class="c1">// "下一页"按钮没有设置 Accessibility id</span>
        <span class="n">app</span><span class="o">.</span><span class="n">buttons</span><span class="p">[</span><span class="s">"下一页"</span><span class="p">]</span><span class="o">.</span><span class="nf">tap</span><span class="p">()</span>

        <span class="c1">// "back" 按钮设置 Accessibility id 为 back</span>
        <span class="n">app</span><span class="o">.</span><span class="n">buttons</span><span class="p">[</span><span class="s">"back"</span><span class="p">]</span><span class="o">.</span><span class="nf">tap</span><span class="p">()</span>
        
    <span class="p">}</span>
</code></pre>
</div>

<p>编写完成之后可以 cmd+U 运行试试吧.</p>

<h3 id="section-1">参考及延伸阅读</h3>

<ul>
  <li><a href="http://www.blogs8.cn/posts/A1Rj797">Swift中KIF测试的特点－b</a></li>
  <li><a href="http://www.infoq.com/cn/news/2015/01/fastlane-ios-continuous-deploy">Xcode 7 UI 测试初窥</a></li>
  <li><a href="http://masilotti.com/ui-testing-cheat-sheet/">UITest</a></li>
  <li><a href="http://nshipster.com/xctestcase/">XCTest​Case</a></li>
  <li><a href="https://objccn.io/issue-15-6/">UI 测试</a></li>
  <li><a href="https://objccn.io/issue-15-7/">截图测试</a></li>
</ul>


        </article>
        <hr>

        
        
            
            
                
                    
                
            
                
                    
                
            
        
            
            
        
            
            
                
                    
                
            
        
            
            
                
                    
                
            
                
                    
                
            
        
            
            
                
                    
                
            
        
            
            
                
                    
                
            
                
                    
                
            
        
            
            
                
                    
                
            
        
            
            
                
                    
                
            
        
            
            
                
                    
                
            
        
            
            
                
                    
                
            
        
        

        <div class="post-recent">
    <div class="pre">
        
        <p><strong>上一篇</strong> <a href="/2017/01/13/Travis-CI/">持续集成系列 - Github中的魔法工具:Travis CI</a></p>
        
    </div>
    <div class="nex">

        
        <p><strong>下一篇</strong> <a href="/2017/02/07/AD-Fastlane/"> 持续集成系列 - Fastlane的黑魔法:自动打包编译上传 AppStore</a></p>
        
    </div>
</div>


        <h2 id="comments">评论</h2>
        
<!-- 多说评论框 start -->
<div class="ds-thread" data-thread-key="http://localhost:4000/2017/01/23/AD-XCTest/" data-title="持续集成系列 - 测试: XCTest" data-url="http://localhost:4000/2017/01/23/AD-XCTest/"></div>
<!-- 多说评论框 end -->
<!-- 多说公共JS代码 start (一个网页只需插入一次) -->
<script type="text/javascript">
    var duoshuoQuery = {
        short_name: "mythkiven"
    };
    (function() {
        var ds = document.createElement('script');
        ds.type = 'text/javascript';
        ds.async = true;
        ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
        ds.charset = 'UTF-8';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(ds);
    })();
</script>
<!-- 多说公共JS代码 end -->






    </div>
    <button class="anchor"><i class="fa fa-anchor"></i></button>
    <div class="right">
        <div class="wrap">

            <!-- Content -->
            <div class="side content">
                <div>
                    内容
                </div>
                <ul id="content-side" class="content-ul">
                    <li><a href="#similar_posts">相似文章</a></li>
                    <li><a href="#comments">评论</a></li>
                </ul>
            </div>
            <!-- 其他div框放到这里 -->
            <!-- <div class="side">bbbb</div> -->
        </div>
    </div>
</div>
<script>
/**
 * target _blank
 */
(function() {
    var aTags = document.querySelectorAll('article a:not([id])')
    for (var i = 0; i < aTags.length; i++) {
        aTags[i].setAttribute('target', '_blank')
    }
}());
</script>
<script src="/js/pageContent.js " charset="utf-8"></script>


    <footer class="site-footer">


    <div class="wrapper">

        <p class="description">
             3行代码的技术博客 
        </p>
        <p class="contact">
            Contact me at:  
            <a href="mailto:mythziven@gmail.com" title="email"><i class="fa fa-envelope-o" aria-hidden="true"></i></a>   -->
<!--            <a href="mailto:mythziven@gmail.com" title="email"><i class="fa fa-envelope-o" aria-hidden="true"></i></a>-->
<!--            <a href="mailto:mythziven@gmail.com" title="email"><i class="fa fa-envelope-o" aria-hidden="true"></i></a>        -->


        </p>
        <p>
            本站总访问量<span id="busuanzi_value_site_pv"></span>次，本站访客数<span id="busuanzi_value_site_uv"></span>人次，本文总阅读量<span id="busuanzi_value_page_pv"></span>次
        </p>
        <p class="power">
        
            <span>
                Site powered by <a href="https://jekyllrb.com/">Jekyll</a> & <a href="https://pages.github.com/">Github Pages</a>.
            </span>

          <!--   <span>
                Theme designed by <a href="https://github.com/mythkiven">MyKiven</a>.
            </span> -->

        </p>
    </div>
</footer>
<script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>

    <div class="back-to-top">
    <a href="#top" class="scroll">
        <i class="fa fa-arrow-up" aria-hidden="true"></i>
    </a>
</div>

    <script src=" /js/main.js " charset="utf-8"></script>
    <script src=" /js/scroll.min.js " charset="utf-8"></script>
  </body>

</html>
