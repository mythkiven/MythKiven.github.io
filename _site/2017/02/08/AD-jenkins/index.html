<!DOCTYPE html>
<html>

  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <title> 持续集成系列 - CI + Jenkins的魔法世界</title>
    <meta name="description" content="  CI 基础知识          持续集成(Continuous Integration)      持续部署(Continuous Deployment)        最近一直在关注移动端的持续集成部署相关的内容,在网搜 Jenkins 资料是很多,但是基本都不是移动端的集成部署.下边将个人的使用体会分享...">

    <link rel="shortcut icon" href="/favicon.ico?" type="image/x-icon">
    <link rel="icon" href="/favicon.ico?" type="image/x-icon">
    <link rel="stylesheet" href="/css/fontawesome/css/font-awesome.min.css ">
    <link rel="stylesheet" href="/css/main.css ">
    <link rel="canonical" href="http://localhost:4000/2017/02/08/AD-jenkins/">
    <link rel="alternate" type="application/rss+xml" title="3行代码" href="http://localhost:4000/feed.xml ">


<script>
    // 百度统计代码
    var _hmt = _hmt || [];
    (function() {
     var hm = document.createElement("script");
     hm.src = "//hm.baidu.com/hm.js?d9432112fb859bf7276f8399641fb0c5";
     var s = document.getElementsByTagName("script")[0];
     s.parentNode.insertBefore(hm, s);
     })();
    </script>




    <script>
    // google analytics
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-85978943-1', 'auto');
      ga('send', 'pageview');

    </script>

</head>


  <body>

    <header id="top">
    <div class="wrapper">
        <a href="/" class="brand">3行代码</a>
        <small>技术博客</small>
        <button id="headerMenu" class="menu"><i class="fa fa-bars"></i></button>
        <nav id="headerNav">
            <ul>
                
                <li>
                    
                    <a href="/">
                    
                        <i class="fa fa-home"></i>Home
                    </a>
                </li>


                
                    
                    <li>
                        
                        <a href="/archive/">
                        
                            <i class="fa fa-archive"></i>Archives
                        </a>
                    </li>
                    
                
                    
                    <li>
                        
                        <a href="/category/">
                        
                            <i class="fa fa-th-list"></i>Categories
                        </a>
                    </li>
                    
                
                    
                    <li>
                        
                        <a href="/tag/">
                        
                            <i class="fa fa-tags"></i>Tags
                        </a>
                    </li>
                    
                
                    
                    <li>
                        
                        <a href="/collection/">
                        
                            <i class="fa fa-bookmark"></i>Collections
                        </a>
                    </li>
                    
                
                    
                    <li>
                        
                        <a href="/about/">
                        
                            <i class="fa fa-heart"></i>About
                        </a>
                    </li>
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
            </ul>
        </nav>
    </div>
</header>


        <div class="page clearfix" post>
    <div class="left">
        <h1> 持续集成系列 - CI + Jenkins的魔法世界</h1>
        <div class="label">

            <div class="label-card">
                <i class="fa fa-calendar"></i>2017-02-08
            </div>

            <div class="label-card">
                <i class="fa fa-user"></i>3行代码
                
            </div>

            <div class="label-card">
                
            </div>

            <div class="label-card">
            


<!-- <span class="point">•</span> -->
<span class="categories">
  <i class="fa fa-th-list"></i>
  
    
        <a href="/category/#CI" title="Category: CI" rel="category">CI</a>
    
  

  <!-- <span class="point">•</span> -->
</span>


            </div>

            <div class="label-card">
            
<!-- <span class="point">•</span> -->
<span class="pageTag">
  <i class="fa fa-tags"></i>
  
    
        <!--a href="/tag/#fastlane" title="Tag: fastlane" rel="tag">fastlane</a-->
        <a href="/tag/#fastlane" title="Tag: fastlane" rel="tag">fastlane</a>&nbsp;
    
        <!--a href="/tag/#CI" title="Tag: CI" rel="tag">CI</a-->
        <a href="/tag/#CI" title="Tag: CI" rel="tag">CI</a>
    
  

</span>

            </div>

        </div>
        <hr>
        <article itemscope itemtype="http://schema.org/BlogPosting">
        <ul id="markdown-toc">
  <li><a href="#ci-" id="markdown-toc-ci-">CI 基础知识</a>    <ul>
      <li><a href="#continuous-integration" id="markdown-toc-continuous-integration">持续集成(Continuous Integration)</a></li>
      <li><a href="#continuous-deployment" id="markdown-toc-continuous-deployment">持续部署(Continuous Deployment)</a></li>
      <li><a href="#xcode---xcodebuild" id="markdown-toc-xcode---xcodebuild">1.  Xcode 命令行工具 : xcodebuild</a></li>
      <li><a href="#project-" id="markdown-toc-project-">2. project 项目的命令行编译:</a></li>
      <li><a href="#cocoapods-" id="markdown-toc-cocoapods-">3.CocoaPods 项目</a></li>
      <li><a href="#xctool" id="markdown-toc-xctool">4.Xctool</a></li>
    </ul>
  </li>
  <li><a href="#jenkins-" id="markdown-toc-jenkins-">Jenkins 简介</a></li>
  <li><a href="#jenkins" id="markdown-toc-jenkins">安装 Jenkins</a>    <ul>
      <li><a href="#section" id="markdown-toc-section">1. 安装</a></li>
      <li><a href="#section-1" id="markdown-toc-section-1">2. 启动</a></li>
      <li><a href="#section-2" id="markdown-toc-section-2">3. 访问方式</a></li>
      <li><a href="#section-3" id="markdown-toc-section-3">4. 修改端口</a></li>
      <li><a href="#section-4" id="markdown-toc-section-4">5. 用户设置</a></li>
      <li><a href="#section-5" id="markdown-toc-section-5">6.系统设置</a></li>
      <li><a href="#section-6" id="markdown-toc-section-6">7. 认证配置</a></li>
    </ul>
  </li>
  <li><a href="#section-7" id="markdown-toc-section-7">项目通用配置</a>    <ul>
      <li><a href="#section-8" id="markdown-toc-section-8">项目编译参数</a></li>
      <li><a href="#section-9" id="markdown-toc-section-9">项目构建参数</a></li>
      <li><a href="#section-10" id="markdown-toc-section-10">构建触发器</a></li>
    </ul>
  </li>
  <li><a href="#build-when-a-change-is-pushed-to-github" id="markdown-toc-build-when-a-change-is-pushed-to-github">根据提交进行构建(Build when a change is pushed to GitHub)</a>    <ul>
      <li><a href="#jobs-" id="markdown-toc-jobs-">Jobs构建方式\编译 配置</a></li>
      <li><a href="#section-11" id="markdown-toc-section-11">构建后的操作</a></li>
      <li><a href="#github" id="markdown-toc-github">配置 github</a>        <ul>
          <li><a href="#freestyle" id="markdown-toc-freestyle">创建freestyle任务</a>            <ul>
              <li><a href="#githubwebhook" id="markdown-toc-githubwebhook">配置Github仓库的Webhook</a></li>
            </ul>
          </li>
        </ul>
      </li>
      <li><a href="#gitlab" id="markdown-toc-gitlab">配置 GitLab</a>        <ul>
          <li><a href="#section-12" id="markdown-toc-section-12">1. 安装插件</a></li>
          <li><a href="#api-token" id="markdown-toc-api-token">2. 配置 API Token</a></li>
          <li><a href="#gitlab-" id="markdown-toc-gitlab-">3. 配置 Gitlab 账号密码</a></li>
          <li><a href="#ssh" id="markdown-toc-ssh">4. 配置 SSH</a></li>
          <li><a href="#freestyle-1" id="markdown-toc-freestyle-1">创建freestyle任务</a></li>
        </ul>
      </li>
      <li><a href="#xcode-builder" id="markdown-toc-xcode-builder">Xcode Builder</a>        <ul>
          <li><a href="#xcode-builder-" id="markdown-toc-xcode-builder-">Xcode Builder 设置</a></li>
        </ul>
      </li>
      <li><a href="#target-" id="markdown-toc-target-">多 Target 扩展</a></li>
      <li><a href="#jenkins-shell-" id="markdown-toc-jenkins-shell-">Jenkins Shell 脚本</a></li>
      <li><a href="#section-13" id="markdown-toc-section-13">其他</a>        <ul>
          <li><a href="#firim" id="markdown-toc-firim">fir.im</a></li>
          <li><a href="#travis" id="markdown-toc-travis">Travis</a></li>
        </ul>
      </li>
    </ul>
  </li>
  <li><a href="#section-14" id="markdown-toc-section-14">自动发布</a></li>
</ul>

<blockquote>

  <p>最近一直在关注移动端的持续集成部署相关的内容,在网搜 Jenkins 资料是很多,但是基本都不是移动端的集成部署.下边将个人的使用体会分享出来,希望能帮助到需要的伙伴们.</p>

</blockquote>

<p><strong>在进行 CI 之前,你需要一些基本的知识</strong></p>

<h3 id="ci-">CI 基础知识</h3>

<p>在互联网的产品开发时代,产品迭代越来越频繁,“从功能开发完成直到成功部署”这一阶段被称为软件开发“最后一公里”.很多开发团队也越来越认识到,自动化测试和持续部署可帮助开发团队提高迭代效率和质量.
那么,如何更好地解决“最后一公里”这一问题呢?</p>

<p>可以分为两部分:持续集成和持续部署</p>
<ul>
  <li>持续集成:是指整个开发过程,每个人开发的模块向项目主体交付时,频繁进行集成以便更快地发现其中的错误</li>
  <li>持续部署:是指开发过程中连续的阶段性版本的上线, V1.1.0上线部署,V1.1.1上线部署…</li>
  <li>前者和后者时间尺度是一样的,不过前者是涵盖每一次 push ,后者是指一个稳定的版本,可以内测和发布用的</li>
  <li>实际使用中,两者是结合在一起的,持续集成的平台上,可以进一步配置持续部署,这样就可以实现:每次 push 自动构建测试,每次稳定的版本,可以顺利的构建分发用于内测.</li>
</ul>

<h5 id="continuous-integration">持续集成(Continuous Integration)</h5>

<p>持续集成:是指整个开发过程,个人开发的模块,向项目主体交付,频繁进行集成以便更快地发现其中的错误.涉及到的内容为:</p>

<ul>
  <li>自动化测试:单元测试+ UI 测试</li>
  <li>持续集成平台:Jenkins (自动化的构建) \ Travis CI (基于 github 平台的CI持续集成)等</li>
  <li>版本控制:如 Git\SVN\CVS 等</li>
  <li>部署发布工具:fastlane 等</li>
  <li>部署发布平台:蒲公英\Fir.im (目前支持 Android 和 iOS 应用的分发,提供的工具有 flow.ci)</li>
  <li>一般流程(Jenkins 为例):Jenkins 服务器轮训 Git ,发现新的版本,就会 clone 到本地,并按照预先设定的脚本进行自动编译,并执行测试.如果有问题,就会发出邮件通知.</li>
</ul>

<h5 id="continuous-deployment">持续部署(Continuous Deployment)</h5>

<p>持续部署:是指开发过程中的连续的阶段性版本, V1.1.0上线部署,V1.1.1上线部署…
在移动端主要是使用 fastlane 实现持续部署:</p>

<ul>
  <li>开发项目,单元测试</li>
  <li>模块开发,集成\UI 测试</li>
  <li>Archive项目</li>
  <li>上传包到iTunes</li>
  <li>在iTunes后台提交版本截图\描述等信息(也可以在测试完成后配置)</li>
  <li>配置TestFlight,分发测试Beta版</li>
  <li>测试,改 bug</li>
  <li>测试完成,提交App Store审核</li>
</ul>

<h5 id="xcode---xcodebuild">1.  Xcode 命令行工具 : xcodebuild</h5>

<p>Xcode 不仅可以通过 GUI 编译运行,还可以通过命令行实现编译运行,这也是 CI 的基础条件之一.</p>

<p>官方的使用方法:</p>

<div class="language-shell highlighter-rouge"><pre class="highlight"><code>xcodebuild <span class="o">[</span>-project &lt;projectname&gt;] <span class="o">[[</span>-target &lt;targetname&gt;]...|-alltargets] <span class="o">[</span>-configuration &lt;configurationname&gt;] <span class="o">[</span>-arch &lt;architecture&gt;]... <span class="o">[</span>-sdk <span class="o">[</span>&lt;sdkname&gt;|&lt;sdkpath&gt;]] <span class="o">[</span>-showBuildSettings] <span class="o">[</span>&lt;buildsetting&gt;<span class="o">=</span>&lt;value&gt;]... <span class="o">[</span>&lt;buildaction&gt;]...

...
</code></pre>
</div>

<p>关键字:</p>
<div class="highlighter-rouge"><pre class="highlight"><code>Options:
    -usage                              print brief usage
    -help                               print complete usage
    -verbose                            provide additional status output
    -license                            show the Xcode and SDK license agreements
    ....
</code></pre>
</div>

<p><strong>实战:</strong></p>
<div class="highlighter-rouge"><pre class="highlight"><code>$ cd  /Users/guoyinjinrong1/Git_Projecrt/XCTest/UITEST 
$ xcodebuild build -workspace UITEST.xcworkspace -scheme UITEST -sdk iphonesimulator ONLY_ACTIVE_ARCH=NO
</code></pre>
</div>

<h5 id="project-">2. project 项目的命令行编译:</h5>

<div class="language-shell highlighter-rouge"><pre class="highlight"><code><span class="c"># 列出 xcodebuild 所有可用的参数:</span>
<span class="gp">$ </span>xcodebuild --help
<span class="c"># project 项目的命令行编译:</span>
<span class="gp">$ </span>xcodebuild -project <span class="o">{</span>project<span class="o">}</span>.xcodeproj -target <span class="o">{</span>xxtarget<span class="o">}</span> -sdk iphonesimulator <span class="nv">ONLY_ACTIVE_ARCH</span><span class="o">=</span>NO
<span class="c">#</span>
</code></pre>
</div>

<p>使用 iphonesimulator SDK 是为了避免签名错误.直到我们稍后引入证书之前,这一步是必须的.通过设置 ONLY_ACTIVE_ARCH=NO 我们可以确保利用模拟器架构编译工程.你也可以设置额外的属性,例如 configuration,输入 man xcodebuild 查看相关文档.</p>

<h5 id="cocoapods-">3.CocoaPods 项目</h5>

<div class="language-shell highlighter-rouge"><pre class="highlight"><code><span class="c"># 需要用下面的命令来指定 workspace 和 scheme：</span>
<span class="gp">$ </span>xcodebuild -workspace <span class="o">{</span>workspace<span class="o">}</span>.xcworkspace -scheme <span class="o">{</span>scheme<span class="o">}</span> -sdk iphonesimulator <span class="nv">ONLY_ACTIVE_ARCH</span><span class="o">=</span>NO
</code></pre>
</div>

<p>schemes 是由 Xcode 自动生成的,但这在服务器上不会发生.确保所有的 scheme 都被设为 shared 并加入到仓库中.否则它只会在本地工作而不会被  CI 系统识别</p>

<h5 id="xctool">4.Xctool</h5>

<p>Xctool 是来自 Facebook 的命令行工具,它可以简化程序的编译和测试.它的彩色输出信息比 xcodebuild 更加简洁直观.同时还添加了对逻辑测试,应用测试的支持.(Travis 中已经预装了 xctool.要在本地测试的话,需要用 Homebrew 安装 xctool)</p>

<p>xctool 用法非常简单,它使用的参数跟 xcodebuild 相同:</p>
<div class="language-shell highlighter-rouge"><pre class="highlight"><code>xctool <span class="nb">test</span> -workspace TravisExample.xcworkspace -scheme TravisExampleTests -sdk iphonesimulator <span class="nv">ONLY_ACTIVE_ARCH</span><span class="o">=</span>NO
</code></pre>
</div>

<h3 id="jenkins-">Jenkins 简介</h3>

<p>1.简介:</p>

<ul>
  <li>Jenkins 由以前的 hudson 更名而来</li>
  <li>Jenkins 是一个跨平台的开源软件项目,旨在实现持续集成和持续交付以提高工作效率</li>
  <li>Jenkins 的主要功能是监视重复工作的执行,例如项目的构建等</li>
  <li>最终都是为了提高软件开发的效率</li>
</ul>

<p>2.特点:</p>

<ul>
  <li>易于安装:一个命令就可启动,也方便部署到各种Web容器中（如tomcat)</li>
  <li>易于配置:所有的配置都在Web界面实现,权限控制得也不错</li>
  <li>插件支持:基本上所有的扩展都是有插件完成的,开发插件也很方便,由此产生了庞大的社区</li>
  <li>支持分布式构建:Jenkins能够让通过主从模式（master/slave）多台机器一起构建</li>
  <li>采用 shell 自定义脚本,控制集成部署环境更加方便灵活</li>
  <li>构建失败发邮件通知相关人员解决</li>
  <li>自动按天备份 war 包,Jenkins 配置备份以及版本控制化</li>
</ul>

<p>3.公司的配置流程:</p>

<p>1\Jenkins服务器一般先架设在一台服务器上,有配置管理人员管理
2\产品有构建需求后,配置管理人员就新建一个任务,配好源码仓库,设置构建时间,指定运行脚本来编译测试产品,并且设置报告输出</p>

<p>4.弊端:</p>

<ul>
  <li>多平台或依赖的包:
如果你的软件想在不同的操作系统软件构建并验​​证,这将是相当有难度和技巧性,一般是准备不同的操作系统的机器,然后使用主/从模式进行分布式构建.在C++中你可以使用有关的交叉编译器;当然你可有使用虚拟机的技术<a href="http://larrycai.github.com/2011/10/25/vagrant-jenkins-ci.html">vagrant/virtualbox</a></li>
  <li>配置管理人员的工作:
一般来说Jenkins的构建任务,它是集中控制的.大多来说都是有专职的配置管理人员来管理,否者权限会混乱.
当有需求时,他们负责在CI服务器创建任务（这些配置文件不是有版本控制的）,这个就涉及到了沟通成本,你有变化需求,很难及时满足.</li>
</ul>

<p>作为开发者,要想随时构建项目,那就需要 Travis CI.</p>

<h3 id="jenkins">安装 Jenkins</h3>

<h5 id="section">1. 安装</h5>

<p>安装方式一:下载<a href="https://mirrors.tuna.tsinghua.edu.cn/jenkins/osx/jenkins-2.45.pkg">pkg</a>文件,然后安装即可(此处未必是最新版,请移步<a href="https://jenkins.io/">官网</a>下载)</p>

<p>安装方式二:终端</p>

<div class="language-shell highlighter-rouge"><pre class="highlight"><code><span class="c"># 安装自动选择最快源的插件</span>
<span class="gp">$ </span>yum install yum-fastestmirror -y  
<span class="c"># 添加 Jenkins 源:</span>
<span class="gp">$ </span>sudo wget -O /etc/yum.repos.d/jenkins.repo http://jenkins-ci.org/redhat/jenkins.repo
<span class="gp">$ </span>sudo rpm --import http://pkg.jenkins-ci.org/redhat/jenkins-ci.org.key
<span class="c">#安装 Jenkins</span>
<span class="gp">$ </span>yum install jenkins               
</code></pre>
</div>

<h5 id="section-1">2. 启动</h5>

<div class="language-shell highlighter-rouge"><pre class="highlight"><code><span class="gp">$ </span>sudo service jenkins start
</code></pre>
</div>

<h5 id="section-2">3. 访问方式</h5>

<div class="language-shell highlighter-rouge"><pre class="highlight"><code><span class="gp">$ </span>open http://localhost:8080/
</code></pre>
</div>

<h5 id="section-3">4. 修改端口</h5>

<p>为避免端口冲突,可重配端口:</p>

<div class="language-shell highlighter-rouge"><pre class="highlight"><code><span class="gp">$ </span>vim /etc/sysconfig/jenkins
<span class="gp">$ </span>sudo service jenkins restart
</code></pre>
</div>

<p>或者这样修改端口:</p>

<div class="language-shell highlighter-rouge"><pre class="highlight"><code>sudo launchctl unload /Library/LaunchDaemons/org.jenkins-ci.plist
sudo defaults write /Library/Preferences/org.jenkins-ci httpPort 8443
sudo launchctl load /Library/LaunchDaemons/org.jenkins-ci.plist
<span class="c"># 如果是 https:</span>
sudo defaults write /Library/Preferences/org.jenkins-ci httpPort 8443
sudo defaults write /Library/Preferences/org.jenkins-ci httpsKeyStore /path/to/your/keystore/file
sudo defaults write /Library/Preferences/org.jenkins-ci httpsKeyStorePassword &lt;keystore password&gt;
<span class="c"># 其中两条命令分别是启动和关闭 Jenkins</span>
</code></pre>
</div>

<h5 id="section-4">5. 用户设置</h5>

<ul>
  <li>
    <p>打开页面: http://localhost:8080 , 按照提示从<code class="highlighter-rouge">/Users/Shared/Jenkins/Home/secrets/initialAdminPassword</code>文件中获取密码,然后输入即可. <strong>vim 打开文件或者 cat 显示文件皆可</strong></p>
  </li>
  <li>
    <p>然后进入插件设置页面,可以选择 Jenkins 推荐的插件,也可自主选择需要安装的插件.(会有一些插件安装失败,没关系,可以后续再安装)</p>
  </li>
  <li>
    <p>安装完成之后,进入创建用户页面,设置用户名密码等</p>
  </li>
  <li>
    <p>用户创建完成,就可以开始创建第一个 Jenkins 任务啦!</p>
  </li>
</ul>

<p>主界面如下(已经创建过一个任务):</p>

<p><img src="http://img.hb.aicdn.com/0b2dc9f4695effe8bd26d856957165a040f4c3c310b35-pnIrgy_fw658" alt="" /></p>

<h5 id="section-5">6.系统设置</h5>

<ol>
  <li>编码设置:</li>
</ol>

<blockquote>
  <p>进入 系统管理-&gt;系统设置 界面：</p>
</blockquote>

<p>首先设置一下 jenkins 内部shell 执行编码，目的当在jenkins执行shell命令时，有时候会报 utf-8 编码错误。主要是pod install的时候报错。</p>

<p>[33mWARNING: CocoaPods requires your terminal to be using UTF-8 encoding.</p>

<p>设置如下：</p>

<p><img src="http://img.hb.aicdn.com/cb6bfa7ef1bc54947df56afd938f66f13617e97b220ed-hPTfFv_fw658" alt="" /></p>

<p>2.邮件设置:</p>

<p>jenkins Location 设置
主要设置 jenkins 外部访问的 URL 和系统管理员的邮箱地址.用来发送错误报告的邮箱地址：如图
<img src="http://7xsugd.com2.z0.glb.clouddn.com/runningyoungBlog/images/location.png" alt="" /></p>

<p>上面只设置了邮箱发送的地址（From地址）,下面设置邮箱的服务器\协议\邮箱\密码.如图:</p>

<p><img src="http://7xsugd.com2.z0.glb.clouddn.com/runningyoungBlog/images/email.png" alt="" /></p>

<h5 id="section-6">7. 认证配置</h5>

<ul>
  <li>基于 用户名+密码 : 将 Gitlab 的用户名,密码添加进来.就可以通过此认证,来访问 Git 的项目库</li>
  <li></li>
  <li>基于 API Token : 将 GIT的 token 添加进来.</li>
</ul>

<h3 id="section-7">项目通用配置</h3>

<ul>
  <li>插件gitlab hook plugin，可以识别gitlab发送过来的提交信息，并触发对应的job</li>
  <li>Environment Injector Plugin（自定义全局变量）</li>
  <li>Email Extension Plugin（邮件）</li>
</ul>

<p>可以先看看下边的官方教程:</p>

<p><a href="https://berlin.gitbooks.io/jenkins/content/job/pei_zhi_bian_yi_can_shu.html">官方指南 教程</a></p>

<h5 id="section-8">项目编译参数</h5>

<p>设置 debug,test等:</p>

<blockquote>
  <p>打开项目 -&gt; 选择参数化构建过程 -&gt; 点选 Choice 配置如下</p>

  <p><img src="https://berlin.gitbooks.io/jenkins/content/pic/job/jb-02.jpg" alt="" /></p>
</blockquote>

<h5 id="section-9">项目构建参数</h5>

<p>设置构建参数:</p>

<blockquote>
  <p>打开项目 -&gt; Build with Parameters -&gt; 配置如下</p>

  <p><img src="https://berlin.gitbooks.io/jenkins/content/pic/job/jb-03.jpg" alt="" /></p>
</blockquote>

<h5 id="section-10">构建触发器</h5>

<blockquote>
  <p>通常手动构建job不是我们想要的，我们想要让其自动构建，这就需要达到一定条件进行触发构建，所有就有了触发器
详细的配置,参考<a href="https://berlin.gitbooks.io/jenkins/content/job/gou_jian_de_hong_fa_qi.html">官方文档</a></p>
</blockquote>

<p>Jenkins 支持多种触发器配置,包括：</p>

<ul>
  <li></li>
  <li>定期检测代码更新，如有更新则进行构建（Poll SCM） (隔一段时间比较一次源代码如果发生变更，那么就build。否则，不进行build)</li>
  <li></li>
  <li>
    <h2 id="build-when-a-change-is-pushed-to-github">根据提交进行构建(Build when a change is pushed to GitHub)</h2>
  </li>
  <li>触发远程构建(例如和gitlab的webhooks联动)(当一有对代码push的情况下，就执行构建)</li>
</ul>

<p>这里以 Gitlab 为例: 有两种方法,这里介绍简单的一种,复杂的请看<a href="https://berlin.gitbooks.io/jenkins/content/job/gou_jian_de_hong_fa_qi.html">官方</a></p>

<blockquote>
  <p>1.通过gitlab的webhook与jenkins联动自动触发:需要 jenkins上安装Gitlab Hook Plugin插件.</p>

  <p>2.勾选:Build when a change is pushed to GitLab. GitLab CI Service URL: http://localhost:8080/project/CI%20GitLab  并保存后边的 URL, 这用于在 gitlab 中的 webhook.</p>

  <p>保存以上设置,然后:</p>

  <p>3.进入 gitlab -&gt; 项目 -&gt; 点击左侧的设置 -&gt; webhook -&gt; 粘贴刚才的 URL, 保存,并点击 TEST HOOK… 如果 一切 OK, 页面很快会提示:HOOK SUCCESSFUL.</p>

  <p>4.有问题,参见<a href="https://berlin.gitbooks.io/jenkins/content/job/gou_jian_de_hong_fa_qi.html">官方</a></p>

  <p><img src="https://berlin.gitbooks.io/jenkins/content/pic/job/jb-18.jpg" alt="" /></p>

</blockquote>

<ul>
  <li>定期进行构建（Build periodically），(隔一段时间build一次，不管版本库代码是否发生变化，通常不会采用此种方式),语法如下:
    <div class="highlighter-rouge"><pre class="highlight"><code>H(25-30) 18 1-5： 工作日下午6点25到30分之间进行build
H 23 1-5：工作日每晚23:00至23:59之间的某一时刻进行build
H(0-29)/15：前半小时内每隔15分钟进行build（开始时间不确定） 
H/20：每隔20分钟进行build（开始时间不确定）
</code></pre>
    </div>
  </li>
</ul>

<h6 id="jobs-">Jobs构建方式\编译 配置</h6>

<p>Jenkins支持多种编译配置方式,包括：</p>

<ul>
  <li>Xcode: iOS编译配置（安装Xcode integration插件）</li>
  <li>Invoke Gradle script： Android编译配置(安装Gradle plugin插件)</li>
  <li>Exceute Shell： 脚本方式</li>
</ul>

<p>对于iOS应用的构建,如果选择Xcode方式构建,需要配置好开发者证书. 推荐使用Exceute Shell方式,简单有效。</p>

<h5 id="section-11">构建后的操作</h5>

<ul>
  <li>向分支push后自动触发jenkins job,上边已经是实现</li>
  <li>jenkins job 成功执行后为当前的commit添加一个标签，方便以后进行线上回滚</li>
  <li>如果编译失败，就发邮件给开发人员,如果编译成功，就发邮件给测试人员</li>
</ul>

<p>Artifacts和邮件通知配置等,<a href="https://gold.xitu.io/entry/5792b7320a2b580061ab0e27">参考</a></p>

<h3 id="github">配置 github</h3>

<p>之所以要配置,是因为 Jenkins 默认不支持 GitHub,需要自行配置(默认支持 CVS\Subversion)</p>

<ul>
  <li>1.在 GitHub 中,配置 token (保存此 token 紧接着就要用)</li>
</ul>

<blockquote>
  <p>流程: github –&gt; setting –&gt; Personal Access Token –&gt; Generate new token</p>
</blockquote>

<p>详细配置如下图:</p>

<p><img src="http://img.hb.aicdn.com/df55935992514b80c0672f2d3ae55ce4f726f4731bdfe-eVrSec_fw658" alt="" /></p>

<ul>
  <li>2.安装 GitHub Plugin</li>
</ul>

<p>如果此前已经没安装过</p>
<blockquote>
  <p>流程:系统管理–&gt;插件管理–&gt;可选插件–&gt;直接安装 GitHub Plugin</p>

  <p>Jenkins会自动帮你安装plain-credentials 、git 、 credentials 、 github-api</p>
</blockquote>

<ul>
  <li>3.配置 GitHub Plugin</li>
</ul>

<blockquote>
  <p>流程:系统管理 –&gt; 系统设置 –&gt; GitHub –&gt; Add GitHub Sever</p>

  <p>Add GitHub Sever 页面 Kind 选择 Secrect text,Secret 贴入上文 GitHub 中配置的 Token,ID 可空白,并加上简单描述即可.</p>
</blockquote>

<p><img src="http://img.hb.aicdn.com/52b78661c0326778df8ea624bb680b59aa11c884106ee-Gos8u3_fw658" alt="" /></p>

<p>以上就完成了 GitHub 的配置.</p>

<h4 id="freestyle">创建freestyle任务</h4>

<p>主界面 –&gt; 点击新建 –&gt; 输入任务名称,并选择任务类型,然后确定</p>

<p><img src="http://img.hb.aicdn.com/c51fae690f1e3d46ae3b63c432fd275add8808b524354-J7rfU3_fw658" alt="" /></p>

<ul>
  <li>1.基本信息:填入 GitHub 项目主页</li>
</ul>

<p><img src="http://img.hb.aicdn.com/0503e68febf932d309025bba65434d9507d223cde4ae-ECKWwr_fw658" alt="" /></p>

<ul>
  <li>2.项目源码管理:</li>
</ul>

<blockquote>
  <p>填入项目的 git 地址–&gt;点击 Add 添加 git 账户,以便读写该项目–&gt;Branches to build 用于监听分支,**表示监听全部分支–&gt;Local subdirectory for repo 表示项目相对于默认路径的保存路径,之后都会在此路径进行构建执行.</p>
</blockquote>

<p><img src="http://img.hb.aicdn.com/969a90bcc1d7d12c26164dd7f7ef11b1048a24a3e321-l92EFL_fw658" alt="" /></p>

<ul>
  <li>3.构建触发器/构建环境:</li>
</ul>

<blockquote>
  <p>GitHub hook trigger for GITScm polling 选项:当 GitHub 有版本库更新时触发 Jenkins 进行构建
Poll SCM 选项:定期检查版本库是否有更新(使用Schedule语法)</p>
</blockquote>

<p><img src="http://img.hb.aicdn.com/cd592746112fbda093692f630b3b6c8c8e260d4134bac-9nqLy0_fw658" alt="" /></p>

<ul>
  <li>4.构建</li>
</ul>

<p><img src="http://img.hb.aicdn.com/e0ce275c67b89629017b4a706b2b6cc6b283ed5660c6-0fzKor_fw658" alt="" /></p>

<p>这里指定脚本</p>

<div class="language-shell highlighter-rouge"><pre class="highlight"><code><span class="c">#!/usr/bin/env zsh --login</span>

rvm use 2.0.0
ruby --version
bundle
bundle --version
bin/pod
/usr/bin/xcodebuild -scheme <span class="s1">'UITEST'</span> -workspace UITEST.xcworkspace -destination <span class="s2">"platform=iOS Simulator,name=iPhone Retina (4-inch),OS=latest"</span> -configuration Debug clean build <span class="nb">test </span><span class="nv">ONLY_ACTIVE_ARCH</span><span class="o">=</span>NO
</code></pre>
</div>
<ul>
  <li>5\ 构建后的操作
Jenkins默认只能构建前执行shell,不能构建后执行shell.当有该需求时 Jenkins 的 PostBuildScript plugin 插件实现这个功能.</li>
</ul>

<p><img src="http://img.hb.aicdn.com/517fe769dfaed57c8a9e6389d940bbbe1a50bfe83a7c-3uou8P_fw658" alt="" /></p>

<p>以上便完成了任务的配置.</p>

<h5 id="githubwebhook">配置Github仓库的Webhook</h5>

<blockquote>
  <p>进入GitHub上指定的项目 –&gt; setting –&gt; WebHooks&amp;Services –&gt; add webhook –&gt; 输入刚刚部署jenkins的服务器的IP</p>
</blockquote>

<p>这样,每次 push 都会触发一次build.</p>

<p>然而,我的 Jenkins 是本地的,在 GitHub 并不能直接访问到我的电脑,so,设置是无效的….</p>

<h3 id="gitlab">配置 GitLab</h3>

<p><strong>集成目的: Gitlab 有新的推送,就会触发 Jenkins 构建.构建状态反馈给 Gitlab</strong></p>

<h5 id="section-12">1. 安装插件</h5>

<blockquote>
  <p><a href="https://docs.gitlab.com/ee/integration/jenkins.html">Gitlab官方教程</a>
<a href="https://docs.gitlab.com/ee/integration/jenkins.html">Gitlab 官方教程2</a></p>
</blockquote>

<ul>
  <li>1). 安装 Gitlab 插件</li>
</ul>

<blockquote>
  <p>系统管理 -&gt; 管理插件 -&gt; 可选插件 :中选择GitLab Plugin 和 Gitlab Hook Plugin 这两项，然后安装.</p>
</blockquote>

<ul>
  <li>2). 安装 Xcode 插件</li>
</ul>

<blockquote>
  <p>同上,安装 Xcode integration</p>
</blockquote>

<ul>
  <li>3). 安装签名证书管理插件
OS打包内测版时,需要发布证书及相关签名文件,因此这两个插件对于管理iOS证书非常方便.</li>
</ul>

<blockquote>
  <p>同上,安装 Credentials Plugin 和 Keychains and Provisioning Profiles Management</p>
</blockquote>

<h5 id="api-token">2. 配置 API Token</h5>

<blockquote>
  <ol>
    <li>
      <p>Gitlabe: Copy the private API token from [ Profile Settings -&gt; Account ]</p>
    </li>
    <li>
      <p>Jenkins: Go to [ Manage Jenkins -&gt; Configure System ] -&gt; [GitLab] 粘贴 Gitlab 主机地址,以及 API Token</p>
    </li>
    <li>
      <p>可能2步骤没有 API Token 选项,因为都已经集成到 Credentials 中了,所以,要进入 Credentials 中,然后 添加新的凭证:</p>
    </li>
  </ol>

  <p>首页点击 Credentials -&gt; 点击 System -&gt; 点击底部的 Glopbal credentials(unrestricted) -&gt; 跳入新的页面,点击 Add Credentials -&gt; Kind 选择 [GitLab API Token],然后粘贴上述的 token ,要注意的是, Description 需要写清楚,不然容易弄混淆(GitHub 也添加了 Secret text, 容易混)</p>

  <p>以上前提是有安装插件:Plain Credentiles Plugin ,以及相关插件. 否则不会有 gitlab API token 这个选项的.</p>
</blockquote>

<h5 id="gitlab-">3. 配置 Gitlab 账号密码</h5>

<p>在系统配置里,添加 类型: Username with password -&gt; 配置账号密码即可.</p>

<h5 id="ssh">4. 配置 SSH</h5>

<p>1.直接获取:</p>

<div class="language-shell highlighter-rouge"><pre class="highlight"><code><span class="gp">$ </span>ls ~/.ssh
<span class="gp">$ </span>cat id_rsa <span class="c"># 显示</span>
<span class="gp">$ </span>pbcopy &lt; ~/.ssh/id_rsa <span class="c">#复制</span>
<span class="c"># 然后 粘贴到 Jenkins 中,并输入最初始的密码即可.如下图</span>
</code></pre>
</div>

<p><img src="http://img.hb.aicdn.com/9756ed06006b5d816ac3e4fdc9891249fd7879f116026-K0Lsxk_fw658" alt="" /></p>

<p>2.创建新的 SSH</p>

<div class="language-shell highlighter-rouge"><pre class="highlight"><code><span class="gp">$ </span>ssh-keygen -t rsa -C “Your email” 
<span class="c"># 私钥id_rsa:本机添加秘钥到秘钥管理器:</span>
<span class="gp">$ </span><span class="nb">eval</span> <span class="s2">"</span><span class="k">$(</span>ssh-agent -s<span class="k">)</span><span class="s2">"</span>
<span class="gp">$ </span>ssh-add ~/.ssh/id_rsa
<span class="c"># 私钥copy添加进 Jenkins（private key选项）</span>
<span class="gp">$ </span>pbcopy &lt; ~/.ssh/id_rsa
<span class="c"># 公钥id_rsa.pub:复制id_rsa.pub里面的公钥添加到Gitlab上  </span>
<span class="gp">$ </span>pbcopy &lt; ~/.ssh/id_rsa.pub

</code></pre>
</div>

<p>SSH 添加路径为:</p>

<blockquote>
  <p>系统管理 -&gt; 系统设置 -&gt; Gitlab 栏 点击 Add 添加,或者使用如下地址:</p>

  <p>http://localhost:8080/credentials/store/system/domain/_/</p>
</blockquote>

<h4 id="freestyle-1">创建freestyle任务</h4>

<p>主界面 –&gt; 点击新建 –&gt; 输入任务名称,并选择 freestyle 任务类型,然后确定</p>

<ul>
  <li>源码管理:</li>
</ul>

<blockquote>
  <blockquote>
    <p>输入项目 git 协议地址(git@your.gitlab.server:gitlab_group/gitlab_project.git) 
–&gt; 证书类型选择:相应的 SSH .
–&gt;在高级设置中，将名称设置为origin,将Refspec设置为 +refs/heads/<em>:refs/remotes/origin/</em> +refs/merge-requests/<em>/head:refs/remotes/origin/merge-requests/</em></p>
  </blockquote>
</blockquote>

<ul>
  <li></li>
  <li>构建触发器:Build when a change is pushed to GitLab. 注意,这里的地址,粘贴在 Gitlab 上 的 WebHook 中</li>
  <li></li>
  <li>更加详细的任务配置,参考插件<a href="https://github.com/jenkinsci/gitlab-plugin#using-it-with-a-job">官方文档</a></li>
</ul>

<h3 id="xcode-builder">Xcode Builder</h3>

<h6 id="xcode-builder-">Xcode Builder 设置</h6>

<blockquote>
  <p>系统管理–&gt;系统设置-&gt;Xcode Builder
默认 path 不变 -&gt; 点击 Add 需填写的内容：</p>

  <p><img src="http://img.blog.csdn.net/20160216141930768" alt="" /></p>
</blockquote>

<blockquote>
  <blockquote>
    <p>Keychain Name：iPhone Distribution: *（dis证书常用名）</p>

    <p>Keychain path：${HOME}/Library/Keychains/login.keychain（dis证书路径）</p>

    <p>Keychain password：*</p>

    <p>Add to keychain search path after build：Yes</p>

    <p>Default keychain:iPhone Distribution: *</p>
  </blockquote>
</blockquote>

<ul>
  <li>
    <ol>
      <li>General build settings:</li>
    </ol>
  </li>
</ul>

<blockquote>
  <p>++ 填写Target 名字</p>

  <p>++ Clean before build? YES</p>

  <p>++ Pack application and build .ipa? YES</p>

  <p>++ .ipa filename pattern IPA 路径:AD_Demo_${SHORT_VERSION}(固定写法:targetName_${SHORT_VERSION})</p>

  <p>++ Output directory IPA输出位置 ${WORKSPACE}/build/${BUILD_NUMBER}/</p>

</blockquote>

<ul>
  <li>2.Code signing &amp; OS X keychain options:</li>
</ul>

<p>在系统Xcode Builder（钥匙串设置）已配置,上边已配置</p>
<ul>
  <li>3.Advanced Xcode build options:
    <blockquote>
      <p>++ “Clean test reports?”  YES</p>

      <p>++Build output directory：${WORKSPACE}/build/${BUILD_NUMBER}/</p>

    </blockquote>
  </li>
</ul>

<p><img src="http://img.blog.csdn.net/20160218095046760" alt="" />
<img src="http://img.blog.csdn.net/20160218095059932" alt="" />
<img src="http://img.blog.csdn.net/20160218095117084" alt="" /></p>
<ul>
  <li>
    <ol>
      <li>Versioning 构建后的设置 :SHELL 脚本</li>
    </ol>
  </li>
</ul>

<p><img src="http://img.blog.csdn.net/20160218100247953" alt="" /></p>

<p>1).点击增加 Shell 脚本:</p>

<div class="language-shell highlighter-rouge"><pre class="highlight"><code><span class="s2">"</span><span class="k">${</span><span class="nv">WORKSPACE</span><span class="k">}</span><span class="s2">/build/</span><span class="k">${</span><span class="nv">BUILD_NUMBER</span><span class="k">}</span><span class="s2">"</span>

<span class="k">for </span>file <span class="k">in</span> <span class="s2">"*.ipa"</span>
<span class="k">do
    </span><span class="nv">PLIST_NAME</span><span class="o">=</span><span class="sb">`</span><span class="nb">echo</span> <span class="nv">$file</span><span class="sb">`</span>
<span class="k">done

</span><span class="nv">PLIST_NAME</span><span class="o">=</span><span class="k">${</span><span class="nv">PLIST_NAME</span><span class="p">%.*</span><span class="k">}</span>

<span class="nb">cd</span> <span class="s2">"</span><span class="k">${</span><span class="nv">WORKSPACE</span><span class="k">}</span><span class="s2">/build"</span>
<span class="nb">echo</span> <span class="s2">"PLIST_NAME=</span><span class="nv">$PLIST_NAME</span><span class="s2">"</span> &gt; jenkinsUserGlobal.properties

cat <span class="sh">&lt;&lt; EOF &gt; ${WORKSPACE}/build/${BUILD_NUMBER}/$PLIST_NAME.plist
&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;!DOCTYPE plist PUBLIC "-//Apple//DTD PLIST 1.0//EN" "http://www.apple.com/DTDs/PropertyList-1.0.dtd"&gt;
&lt;plist version="1.0"&gt;
&lt;dict&gt;
        &lt;key&gt;items&lt;/key&gt;
        &lt;array&gt;
                &lt;dict&gt;
                        &lt;key&gt;assets&lt;/key&gt;
                        &lt;array&gt;
                                &lt;dict&gt;
                                        &lt;key&gt;kind&lt;/key&gt;
                                        &lt;string&gt;software-package&lt;/string&gt;
                                        &lt;key&gt;url&lt;/key&gt;
                                        &lt;string&gt;https://127.0.0.1/$PLIST_NAME.ipa&lt;/string&gt;
                                &lt;/dict&gt;
                        &lt;/array&gt;
                        &lt;key&gt;metadata&lt;/key&gt;
                        &lt;dict&gt;
                                &lt;key&gt;bundle-identifier&lt;/key&gt;
                                &lt;string&gt;com.3code.ADDemo&lt;/string&gt;
                                &lt;key&gt;bundle-version&lt;/key&gt;
                                &lt;string&gt;1&lt;/string&gt;
                                &lt;key&gt;kind&lt;/key&gt;
                                &lt;string&gt;software&lt;/string&gt;
                                &lt;key&gt;title&lt;/key&gt;
                                &lt;string&gt;ADDemo&lt;/string&gt;
                        &lt;/dict&gt;
                &lt;/dict&gt;
        &lt;/array&gt;
&lt;/dict&gt;
&lt;/plist&gt;
EOF
</span></code></pre>
</div>

<p>2). 点击增加 Inject environment variables</p>

<p>并设置:</p>
<blockquote>
  <p>需填写的内容：(将在Execute shell中生成的全局变量文件地址放入 Properties File Path中)
Properties File Path：${WORKSPACE}/build/jenkinsUserGlobal.properties</p>
</blockquote>

<p><img src="http://img.blog.csdn.net/20160218100610924" alt="" /></p>

<ul>
  <li>5.构建后的操作: 设置邮件</li>
</ul>

<p><img src="http://img.blog.csdn.net/20160218100726636" alt="" />
触发器：构建成功、失败触发(扩展一下：失败点“高级”设置只发送给自己) 
<img src="http://img.blog.csdn.net/20160218100837965" alt="" /></p>

<blockquote>
  <p>需填写的内容：</p>

  <p>Project Recipient List：邮件接收人（多个时用”,“分割）</p>

  <p>Project Reply-To List：$DEFAULT_REPLYTO</p>

  <p>Content Type：选择”HTML(text/html)“</p>

  <p>Default Subject：标题: <strong>${PROJECT_NAME}构建通知:第${BUILD_NUMBER}次持续集成${PLIST_NAME}构建${BUILD_STATUS}</strong></p>

  <p>Default Content:（将ipa全局变量传递到邮件生成下载链接和链接二维码）,如下:</p>
</blockquote>

<div class="language-xml highlighter-rouge"><pre class="highlight"><code><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="nt">&lt;html&gt;</span>
<span class="nt">&lt;head&gt;</span>
<span class="nt">&lt;meta</span> <span class="na">charset=</span><span class="s">"UTF-8"</span><span class="nt">&gt;</span>
<span class="nt">&lt;title&gt;</span>${ENV, var="JOB_NAME"}-第${BUILD_NUMBER}次构建日志<span class="nt">&lt;/title&gt;</span>
<span class="nt">&lt;/head&gt;</span>

<span class="nt">&lt;body</span> <span class="na">leftmargin=</span><span class="s">"8"</span> <span class="na">marginwidth=</span><span class="s">"0"</span> <span class="na">topmargin=</span><span class="s">"8"</span> <span class="na">marginheight=</span><span class="s">"4"</span>
    <span class="na">ffset=</span><span class="s">"0"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;table</span> <span class="na">width=</span><span class="s">"95%"</span> <span class="na">cellpadding=</span><span class="s">"0"</span> <span class="na">cellspacing=</span><span class="s">"0"</span>
        <span class="na">style=</span><span class="s">"font-size: 11pt; font-family: Tahoma, Arial, Helvetica, sans-serif"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;tr&gt;</span>
            <span class="nt">&lt;td&gt;&lt;h2&gt;</span>
                    <span class="nt">&lt;font</span> <span class="na">color=</span><span class="s">"#0000FF"</span><span class="nt">&gt;</span>构建结果 - ${BUILD_STATUS}<span class="nt">&lt;/font&gt;</span>
                <span class="nt">&lt;/h2&gt;&lt;/td&gt;</span>
        <span class="nt">&lt;/tr&gt;</span>
        <span class="nt">&lt;tr&gt;</span>
                <span class="nt">&lt;td&gt;&lt;h2&gt;</span>
                    <span class="nt">&lt;font</span> <span class="na">color=</span><span class="s">"#FF0000"</span><span class="nt">&gt;</span>App下载链接:<span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"itms-services://?action=download-manifest&amp;url=https://******/${PLIST_NAME}.plist"</span><span class="nt">&gt;</span>itms-services://?action=download-manifest<span class="err">&amp;</span>url=https://127.0.0.1/${PLIST_NAME}.plist<span class="nt">&lt;/a&gt;&lt;/font&gt;</span>
                <span class="nt">&lt;/h2&gt;&lt;/td&gt;</span>
        <span class="nt">&lt;/tr&gt;</span>
        <span class="nt">&lt;tr&gt;</span>
               <span class="nt">&lt;td&gt;&lt;h2&gt;</span>
                      <span class="nt">&lt;font</span> <span class="na">color=</span><span class="s">"#FF0000"</span><span class="nt">&gt;</span>二维码图片:<span class="nt">&lt;/font&gt;</span>
               <span class="nt">&lt;/h2&gt;&lt;/td&gt;</span>
        <span class="nt">&lt;/tr&gt;</span>
        <span class="nt">&lt;tr&gt;</span>
                <span class="nt">&lt;td&gt;</span>
                    <span class="nt">&lt;img</span> <span class="na">src=</span><span class="s">"http://qr.liantu.com/api.php?text=itms-services://?action=download-manifest%26url=https://******/${PLIST_NAME}.plist"</span> <span class="na">height=</span><span class="s">"300"</span> <span class="na">width=</span><span class="s">"300"</span><span class="nt">&gt;</span>
                <span class="nt">&lt;/td&gt;</span>
        <span class="nt">&lt;/tr&gt;</span>
        <span class="nt">&lt;tr&gt;</span>
            <span class="nt">&lt;td&gt;&lt;br</span> <span class="nt">/&gt;</span>
            <span class="nt">&lt;b&gt;&lt;font</span> <span class="na">color=</span><span class="s">"#0B610B"</span><span class="nt">&gt;</span>构建信息<span class="nt">&lt;/font&gt;&lt;/b&gt;</span>
            <span class="nt">&lt;hr</span> <span class="na">size=</span><span class="s">"2"</span> <span class="na">width=</span><span class="s">"100%"</span> <span class="na">align=</span><span class="s">"center"</span> <span class="nt">/&gt;&lt;/td&gt;</span>
        <span class="nt">&lt;/tr&gt;</span>
        <span class="nt">&lt;tr&gt;</span>
            <span class="nt">&lt;td&gt;</span>
                <span class="nt">&lt;ul&gt;</span>
                    <span class="nt">&lt;li&gt;</span>项目名称<span class="ni">&amp;nbsp;</span>：<span class="ni">&amp;nbsp;</span>${PROJECT_NAME}<span class="nt">&lt;/li&gt;</span>
                    <span class="nt">&lt;li&gt;</span>构建编号<span class="ni">&amp;nbsp;</span>：<span class="ni">&amp;nbsp;</span>第${BUILD_NUMBER}次构建<span class="nt">&lt;/li&gt;</span>
                    <span class="nt">&lt;li&gt;</span>SVN<span class="ni">&amp;nbsp;</span>版本：<span class="ni">&amp;nbsp;</span>${SVN_REVISION}<span class="nt">&lt;/li&gt;</span>
                    <span class="nt">&lt;li&gt;</span>触发原因：<span class="ni">&amp;nbsp;</span>${CAUSE}<span class="nt">&lt;/li&gt;</span>
                    <span class="nt">&lt;li&gt;</span>构建日志：<span class="ni">&amp;nbsp;</span><span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"${BUILD_URL}console"</span><span class="nt">&gt;</span>${BUILD_URL}console<span class="nt">&lt;/a&gt;&lt;/li&gt;</span>
                    <span class="nt">&lt;li&gt;</span>构建<span class="ni">&amp;nbsp;&amp;nbsp;</span>Url<span class="ni">&amp;nbsp;</span>：<span class="ni">&amp;nbsp;</span><span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"${BUILD_URL}"</span><span class="nt">&gt;</span>${BUILD_URL}<span class="nt">&lt;/a&gt;&lt;/li&gt;</span>
                    <span class="nt">&lt;li&gt;</span>工作目录<span class="ni">&amp;nbsp;</span>：<span class="ni">&amp;nbsp;</span><span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"${PROJECT_URL}ws"</span><span class="nt">&gt;</span>${PROJECT_URL}ws<span class="nt">&lt;/a&gt;&lt;/li&gt;</span>
                    <span class="nt">&lt;li&gt;</span>项目<span class="ni">&amp;nbsp;&amp;nbsp;</span>Url<span class="ni">&amp;nbsp;</span>：<span class="ni">&amp;nbsp;</span><span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"${PROJECT_URL}"</span><span class="nt">&gt;</span>${PROJECT_URL}<span class="nt">&lt;/a&gt;&lt;/li&gt;</span>
                <span class="nt">&lt;/ul&gt;</span>
            <span class="nt">&lt;/td&gt;</span>
        <span class="nt">&lt;/tr&gt;</span>
        <span class="nt">&lt;tr&gt;</span>
            <span class="nt">&lt;td&gt;&lt;b&gt;&lt;font</span> <span class="na">color=</span><span class="s">"#0B610B"</span><span class="nt">&gt;</span>Changes Since Last
                        Successful Build:<span class="nt">&lt;/font&gt;&lt;/b&gt;</span>
            <span class="nt">&lt;hr</span> <span class="na">size=</span><span class="s">"2"</span> <span class="na">width=</span><span class="s">"100%"</span> <span class="na">align=</span><span class="s">"center"</span> <span class="nt">/&gt;&lt;/td&gt;</span>
        <span class="nt">&lt;/tr&gt;</span>
        <span class="nt">&lt;tr&gt;</span>
            <span class="nt">&lt;td&gt;</span>
                <span class="nt">&lt;ul&gt;</span>
                    <span class="nt">&lt;li&gt;</span>历史变更记录 : <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"${PROJECT_URL}changes"</span><span class="nt">&gt;</span>${PROJECT_URL}changes<span class="nt">&lt;/a&gt;&lt;/li&gt;</span>
                <span class="nt">&lt;/ul&gt;</span> ${CHANGES_SINCE_LAST_SUCCESS,reverse=true, format="Changes for Build #%n:<span class="nt">&lt;br</span> <span class="nt">/&gt;</span>%c<span class="nt">&lt;br</span> <span class="nt">/&gt;</span>",showPaths=true,changesFormat="<span class="nt">&lt;pre&gt;</span>[%a]<span class="nt">&lt;br</span> <span class="nt">/&gt;</span>%m<span class="nt">&lt;/pre&gt;</span>",pathFormat="<span class="ni">&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;</span>%p"}
            <span class="nt">&lt;/td&gt;</span>
        <span class="nt">&lt;/tr&gt;</span>
        <span class="nt">&lt;tr&gt;</span>
            <span class="nt">&lt;td&gt;&lt;b&gt;</span>Failed Test Results<span class="nt">&lt;/b&gt;</span>
            <span class="nt">&lt;hr</span> <span class="na">size=</span><span class="s">"2"</span> <span class="na">width=</span><span class="s">"100%"</span> <span class="na">align=</span><span class="s">"center"</span> <span class="nt">/&gt;&lt;/td&gt;</span>
        <span class="nt">&lt;/tr&gt;</span>
        <span class="nt">&lt;tr&gt;</span>
            <span class="nt">&lt;td&gt;&lt;pre</span>
                    <span class="na">style=</span><span class="s">"font-size: 11pt; font-family: Tahoma, Arial, Helvetica, sans-serif"</span><span class="nt">&gt;</span>$FAILED_TESTS<span class="nt">&lt;/pre&gt;</span>
                <span class="nt">&lt;br</span> <span class="nt">/&gt;&lt;/td&gt;</span>
        <span class="nt">&lt;/tr&gt;</span>
        <span class="nt">&lt;tr&gt;</span>
            <span class="nt">&lt;td&gt;&lt;b&gt;&lt;font</span> <span class="na">color=</span><span class="s">"#0B610B"</span><span class="nt">&gt;</span>构建日志 (最后 100行):<span class="nt">&lt;/font&gt;&lt;/b&gt;</span>
            <span class="nt">&lt;hr</span> <span class="na">size=</span><span class="s">"2"</span> <span class="na">width=</span><span class="s">"100%"</span> <span class="na">align=</span><span class="s">"center"</span> <span class="nt">/&gt;&lt;/td&gt;</span>
        <span class="nt">&lt;/tr&gt;</span>
        <span class="nt">&lt;tr&gt;</span>
            <span class="nt">&lt;td&gt;&lt;textarea</span> <span class="na">cols=</span><span class="s">"80"</span> <span class="na">rows=</span><span class="s">"30"</span> <span class="na">readonly=</span><span class="s">"readonly"</span>
                    <span class="na">style=</span><span class="s">"font-family: Courier New"</span><span class="nt">&gt;</span>${BUILD_LOG, maxLines=100}<span class="nt">&lt;/textarea&gt;</span>
            <span class="nt">&lt;/td&gt;</span>
        <span class="nt">&lt;/tr&gt;</span>
    <span class="nt">&lt;/table&gt;</span>
<span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</code></pre>
</div>

<p>邮件截图</p>

<p><img src="http://img.blog.csdn.net/20160218103409264" alt="" />
<img src="http://img.blog.csdn.net/20160218103358248" alt="" /></p>

<h3 id="target-">多 Target 扩展</h3>

<h3 id="jenkins-shell-">Jenkins Shell 脚本</h3>

<p>在 Jenkins 的任务里面,在构建\构建后,都可选择 Execute shell ,作为构建前或者构建后要执行的 shell 脚本.</p>

<p>python\perl\ruby 等脚本其实也是 shell 脚本,因此这里的 Shell 可以扩展为 python\perl\ruby
等。</p>

<p>常见脚本如:</p>

<p>1\此脚本:在jenkins构建完成后,远程copy配置文件到项目中,并重启tomcat</p>

<div class="language-shell highlighter-rouge"><pre class="highlight"><code><span class="c">#!/bin/sh</span>
<span class="c">#datetime: 2017-2-7 17:00</span>
<span class="c">#author:3code</span>
<span class="c">#desc:此脚本用来在jenkins构建完成后，远程copy配置文件到项目中，并重启tomcat</span>

<span class="c">#copy API工程的配置文件</span>
cp -r /data/apache-tomcat-7.0.56/build/API/<span class="k">*</span>  /data/apache-tomcat-7.0.56/webapps/API/WEB-INF/classes

<span class="c">#重启tomcat</span>
bash /data/apache-tomcat-7.0.56/bin/shutdown.sh

sleep 30s

bash /data/apache-tomcat-7.0.56/bin/startup.sh
</code></pre>
</div>

<p><strong>Tips:</strong></p>
<ul>
  <li>对于刚接触Jenkins的同学可能有很多需要配置的地方不知道要怎么填，这时可以点击每一个填空后的？，就会弹出详细的提示。</li>
  <li>官方的wiki是很好的入门教程https://wiki.jenkins-ci.org/display/JENKINS/Home</li>
</ul>

<h3 id="section-13">其他</h3>

<ul>
  <li>Jenkins 的界面是可以自定义的,<a href="https://wiki.jenkins-ci.org/display/JENKINS/Simple+Theme+Plugin">参考此处</a></li>
  <li><a href="https://runningyoung.github.io/2016/04/01/2016-04-05-jenkins2/">优秀:Jenkins + Gitlab + 蒲公英 + 邮件通知</a></li>
  <li><a href="http://blog.csdn.net/fengshi_sh/article/details/50669754">优秀:jenkins+xcode+svn+七牛</a></li>
</ul>

<p><a href="http://www.itgo.me/a/x9151986573431569483">构建iOS持续集成平台（三）——CI服务器与自动化部署</a>
<a href="http://blog.fir.im/fir_im_weekly160505/">fir.im weekly - 「 持续集成 」实践教程合集</a>
<a href="http://blog.flow.ci/cicd_difference/">谈谈持续集成，持续交付，持续部署之间的区别</a>
<a href="http://blog.caoyue.me/post/react-native-travis-ci-ios">使用Travis CI自动部署React Native项目（iOS篇）</a>
<a href="http://www.infoq.com/cn/articles/build-ios-continuous-integration-platform-part3">构建iOS持续集成平台（三）——CI服务器与自动化部署</a>
…
<a href="https://objccn.io/issue-6-5/">为 iOS 建立 Travis CI</a>
<a href="https://gold.xitu.io/entry/57a982d10a2b58005869d8dc">iOS 持续集成 –Travis CI + Fir.im 自动编译发布</a>
<a href="http://yeziahehe.com/2016/08/07/use_travis_ci_for_ios_project/">iOS 持续集成–Travis CI + Fir.im自动编译发布</a>
<a href="https://objccn.io/issue-6-5/">为 iOS 建立 Travis CI</a>
<a href="https://docs.docker.com/docker-hub/builds/">在Docker Hub上配置自动构建</a>
<a href="http://www.jianshu.com/p/19c2b13e81fa">利用pod trunk发布程序</a>
<a href="http://www.55118885.com/w/166141242.html">使用GitLab来实现IOS项目的持续集成CI</a>
<a href="http://blog.fir.im/jenkinsgithubfir_cli-xing-ming-ling-cong-yuan-ma-dao-fir-im/">Jenkins + GitHub + fir-cli 一行命令从源码到 fir.im</a>
<a href="http://www.2cto.com/kf/201411/356826.html">用持续集成工具Travis进行构建和部署</a></p>
<h4 id="firim">fir.im</h4>
<p><a href="http://www.jianshu.com/p/f17caec72f0b">使用 fir CLI插件上传 Swift 应用至fir.im</a></p>

<h4 id="travis">Travis</h4>
<p>相关的文章:<a href="https://blog.jamespan.me/2015/11/01/ci-your-hexo-blog">Travis</a></p>

<blockquote>
  <p><a href="http://ios.jobbole.com/87803/">使用 TestFlight 进行 App Beta 版测试</a>
<a href="http://www.jianshu.com/p/27545c2d4d8b">使用TestFlight进行App构建版本测试</a>
<a href="https://onevcat.com/2012/01/testflight/">onevcat testflight</a>
持续部署是指当交付的代码通过评审之后，自动部署到生产环境中。持续部署是持续交付的最高阶段。这意味着，所有通过了一系列的自动化测试的改动都将自动部署到生产环境。它也可以被称为“Continuous Release”。</p>
</blockquote>

<h2 id="section-14">自动发布</h2>

<ul>
  <li>Fastlane 是一组工具套件,旨在实现iOS应用发布流程的自动化，并且提供一个运行良好的持续部署流程.</li>
  <li>使用场景: push 时执行单元测试,集成测试;创建屏幕截图发给客户;构建分发 Beta 版本;构建并分发到 appstore;</li>
  <li>支持与Jenkins和CocoaPods，xctools等其他第三方工具的集成</li>
  <li>博客教程:http://www.infoq.com/cn/news/2015/01/fastlane-ios-continuous-deploy</li>
  <li>官方教程:https://docs.fastlane.tools/getting-started/ios/screenshots/</li>
</ul>


        </article>
        <hr>

        
        
            
            
        
            
            
                
                    
                        
                        <h2 id="similar_posts">相似文章</h2>
                        <ul>
                        
                        <li class="relatedPost">
                            <a href="http://localhost:4000/2017/02/07/AD-Fastlane/"> 持续集成系列 - Fastlane的黑魔法:自动打包编译上传 AppStore
                            
                            </a>
                        </li>
                        
                        
                    
                
                    
                
            
        
            
            
                
                    
                
                    
                
            
        
            
            
                
                    
                
                    
                
            
                
                    
                
                    
                
            
        
            
            
                
                    
                
                    
                
            
        
            
            
                
                    
                
                    
                
            
                
                    
                
                    
                
            
        
            
            
                
                    
                
                    
                
            
        
            
            
                
                    
                
                    
                
            
        
            
            
                
                    
                
                    
                
            
        
            
            
                
                    
                
                    
                
            
        
        
            </ul>
        

        <div class="post-recent">
    <div class="pre">
        
        <p><strong>上一篇</strong> <a href="/2017/02/08/AD-jenkins/">Ad Jenkins</a></p>
        
    </div>
    <div class="nex">

        
    </div>
</div>


        <h2 id="comments">评论</h2>
        
<!-- 多说评论框 start -->
<div class="ds-thread" data-thread-key="http://localhost:4000/2017/02/08/AD-jenkins/" data-title=" 持续集成系列 - CI + Jenkins的魔法世界" data-url="http://localhost:4000/2017/02/08/AD-jenkins/"></div>
<!-- 多说评论框 end -->
<!-- 多说公共JS代码 start (一个网页只需插入一次) -->
<script type="text/javascript">
    var duoshuoQuery = {
        short_name: "mythkiven"
    };
    (function() {
        var ds = document.createElement('script');
        ds.type = 'text/javascript';
        ds.async = true;
        ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
        ds.charset = 'UTF-8';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(ds);
    })();
</script>
<!-- 多说公共JS代码 end -->






    </div>
    <button class="anchor"><i class="fa fa-anchor"></i></button>
    <div class="right">
        <div class="wrap">

            <!-- Content -->
            <div class="side content">
                <div>
                    内容
                </div>
                <ul id="content-side" class="content-ul">
                    <li><a href="#similar_posts">相似文章</a></li>
                    <li><a href="#comments">评论</a></li>
                </ul>
            </div>
            <!-- 其他div框放到这里 -->
            <!-- <div class="side">bbbb</div> -->
        </div>
    </div>
</div>
<script>
/**
 * target _blank
 */
(function() {
    var aTags = document.querySelectorAll('article a:not([id])')
    for (var i = 0; i < aTags.length; i++) {
        aTags[i].setAttribute('target', '_blank')
    }
}());
</script>
<script src="/js/pageContent.js " charset="utf-8"></script>


    <footer class="site-footer">


    <div class="wrapper">

        <p class="description">
             3行代码的技术博客 
        </p>
        <p class="contact">
            Contact me at:  
            <a href="mailto:mythziven@gmail.com" title="email"><i class="fa fa-envelope-o" aria-hidden="true"></i></a>   -->
<!--            <a href="mailto:mythziven@gmail.com" title="email"><i class="fa fa-envelope-o" aria-hidden="true"></i></a>-->
<!--            <a href="mailto:mythziven@gmail.com" title="email"><i class="fa fa-envelope-o" aria-hidden="true"></i></a>        -->


        </p>
        <p>
            本站总访问量<span id="busuanzi_value_site_pv"></span>次，本站访客数<span id="busuanzi_value_site_uv"></span>人次，本文总阅读量<span id="busuanzi_value_page_pv"></span>次
        </p>
        <p class="power">
        
            <span>
                Site powered by <a href="https://jekyllrb.com/">Jekyll</a> & <a href="https://pages.github.com/">Github Pages</a>.
            </span>

          <!--   <span>
                Theme designed by <a href="https://github.com/mythkiven">MyKiven</a>.
            </span> -->

        </p>
    </div>
</footer>
<script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>

    <div class="back-to-top">
    <a href="#top" class="scroll">
        <i class="fa fa-arrow-up" aria-hidden="true"></i>
    </a>
</div>

    <script src=" /js/main.js " charset="utf-8"></script>
    <script src=" /js/scroll.min.js " charset="utf-8"></script>
  </body>

</html>
