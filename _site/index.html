<!DOCTYPE html>
<html>

  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <title>3行代码</title>
    <meta name="description" content="">

    <link rel="shortcut icon" href="/favicon.ico?" type="image/x-icon">
    <link rel="icon" href="/favicon.ico?" type="image/x-icon">
    <link rel="stylesheet" href="/css/fontawesome/css/font-awesome.min.css ">
    <link rel="stylesheet" href="/css/main.css ">
    <link rel="canonical" href="http://localhost:4000/">
    <link rel="alternate" type="application/rss+xml" title="3行代码" href="http://localhost:4000/feed.xml ">


<script>
    // 百度统计代码
    var _hmt = _hmt || [];
    (function() {
     var hm = document.createElement("script");
     hm.src = "//hm.baidu.com/hm.js?d9432112fb859bf7276f8399641fb0c5";
     var s = document.getElementsByTagName("script")[0];
     s.parentNode.insertBefore(hm, s);
     })();
    </script>




    <script>
    // google analytics
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-85978943-1', 'auto');
      ga('send', 'pageview');

    </script>

</head>


  <body>

    <header id="top">
    <div class="wrapper">
        <a href="/" class="brand">3行代码</a>
        <small>技术博客</small>
        <button id="headerMenu" class="menu"><i class="fa fa-bars"></i></button>
        <nav id="headerNav">
            <ul>
                
                <li>
                    
                    <a class="active" href="/">
                        
                        <i class="fa fa-home"></i>Home
                    </a>
                </li>


                
                    
                    <li>
                        
                        <a href="/archive/">
                        
                            <i class="fa fa-archive"></i>Archives
                        </a>
                    </li>
                    
                
                    
                    <li>
                        
                        <a href="/category/">
                        
                            <i class="fa fa-th-list"></i>Categories
                        </a>
                    </li>
                    
                
                    
                    <li>
                        
                        <a href="/tag/">
                        
                            <i class="fa fa-tags"></i>Tags
                        </a>
                    </li>
                    
                
                    
                    <li>
                        
                        <a href="/collection/">
                        
                            <i class="fa fa-bookmark"></i>Collections
                        </a>
                    </li>
                    
                
                    
                    <li>
                        
                        <a href="/about/">
                        
                            <i class="fa fa-heart"></i>About
                        </a>
                    </li>
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
            </ul>
        </nav>
    </div>
</header>


        <div class="page clearfix" index>
    <div class="left">
        <h1>Welcome to 3code.info!</h1>
        <small>记录生活</small>
        <hr>
        <ul>
            
              <li>
                <h2>
                  <a class="post-link" href="/2017/02/08/AD-jenkins/"> 持续集成系列 - CI + Jenkins的魔法世界</a>
                </h2>
                <div class="label">
                    <div class="label-card">
                        <i class="fa fa-calendar"></i>2017-02-08
                    </div>
                    <div class="label-card">
                        <i class="fa fa-user"></i>3行代码
                        
                    </div>
                    <div class="label-card">
                        
                    </div>

                    <div class="label-card">
                    


<!-- <span class="point">•</span> -->
<span class="categories">
  <i class="fa fa-th-list"></i>
  
    
        <a href="/category/#CI" title="Category: CI" rel="category">CI</a>
    
  

  <!-- <span class="point">•</span> -->
</span>


                    </div>

                    <div class="label-card">
                    
<!-- <span class="point">•</span> -->
<span class="pageTag">
  <i class="fa fa-tags"></i>
  
    
        <a href="/tag/#fastlane" title="Tag: fastlane" rel="tag">fastlane</a>&nbsp;
    
        <a href="/tag/#CI" title="Tag: CI" rel="tag">CI</a>
    
  

</span>

                    </div>
                </div>
                <div class="excerpt">
                    <ul id="markdown-toc">
  <li><a href="#ci-" id="markdown-toc-ci-">CI 基础知识</a>    <ul>
      <li><a href="#continuous-integration" id="markdown-toc-continuous-integration">持续集成(Continuous Integration)</a></li>
      <li><a href="#continuous-deployment" id="markdown-toc-continuous-deployment">持续部署(Continuous Deployment)</a></li>
    </ul>
  </li>
</ul>

<blockquote>

  <p>最近一直在关注移动端的持续集成部署相关的内容,在网搜 Jenkins 资料是很多,但是基本都不是移动端的集成部署.下边将个人的使用体会分享出来,希望能帮助到需要的伙伴们.</p>

</blockquote>

<p><strong>在进行 CI 之前,你需要一些基本的知识</strong></p>

<h3 id="ci-">CI 基础知识</h3>

<p>在互联网的产品开发时代,产品迭代越来越频繁,“从功能开发完成直到成功部署”这一阶段被称为软件开发“最后一公里”.很多开发团队也越来越认识到,自动化测试和持续部署可帮助开发团队提高迭代效率和质量.
那么,如何更好地解决“最后一公里”这一问题呢?</p>

<p>可以分为两部分:持续集成和持续部署</p>
<ul>
  <li>持续集成:是指整个开发过程,每个人开发的模块向项目主体交付时,频繁进行集成以便更快地发现其中的错误</li>
  <li>持续部署:是指开发过程中连续的阶段性版本的上线, V1.1.0上线部署,V1.1.1上线部署…</li>
  <li>前者和后者时间尺度是一样的,不过前者是涵盖每一次 push ,后者是指一个稳定的版本,可以内测和发布用的</li>
  <li>实际使用中,两者是结合在一起的,持续集成的平台上,可以进一步配置持续部署,这样就可以实现:每次 push 自动构建测试,每次稳定的版本,可以顺利的构建分发用于内测.</li>
</ul>

<h5 id="continuous-integration">持续集成(Continuous Integration)</h5>

<p>持续集成:是指整个开发过程,个人开发的模块,向项目主体交付,频繁进行集成以便更快地发现其中的错误.涉及到的内容为:</p>

<ul>
  <li>自动化测试:单元测试+ UI 测试</li>
  <li>持续集成平台:Jenkins (自动化的构建) \ Travis CI (基于 github 平台的CI持续集成)等</li>
  <li>版本控制:如 Git\SVN\CVS 等</li>
  <li>部署发布工具:fastlane 等</li>
  <li>部署发布平台:蒲公英\Fir.im (目前支持 Android 和 iOS 应用的分发,提供的工具有 flow.ci)</li>
  <li>一般流程(Jenkins 为例):Jenkins 服务器轮训 Git ,发现新的版本,就会 clone 到本地,并按照预先设定的脚本进行自动编译,并执行测试.如果有问题,就会发出邮件通知.</li>
</ul>

<h5 id="continuous-deployment">持续部署(Continuous Deployment)</h5>

<p>持续部署:是指开发过程中的连续的阶段性版本, V1.1.0上线部署,V1.1.1上线部署…
在移动端主要是使用 fastlane 实现持续部署:</p>

<ul>
  <li>开发项目,单元测试</li>
  <li>模块开发,集成\UI 测试</li>
  <li>Archive项目</li>
  <li>上传包到iTunes</li>
  <li>在iTunes后台提交版本截图\描述等信息(也可以在测试完成后配置)</li>
  <li>配置TestFlight,分发测试Beta版</li>
  <li>测试,改 bug</li>
  <li>测试完成,提交App Store审核</li>
</ul>


                </div>
                <div class="read-all">
                    <a  href="/2017/02/08/AD-jenkins/"><i class="fa fa-newspaper-o"></i>Read All</a>
                </div>
                <hr>
              </li>
            
              <li>
                <h2>
                  <a class="post-link" href="/2017/02/07/AD-Fastlane/"> 持续集成系列 - Fastlane的黑魔法:自动打包编译上传 AppStore</a>
                </h2>
                <div class="label">
                    <div class="label-card">
                        <i class="fa fa-calendar"></i>2017-02-07
                    </div>
                    <div class="label-card">
                        <i class="fa fa-user"></i>3行代码
                        
                    </div>
                    <div class="label-card">
                        
                    </div>

                    <div class="label-card">
                    


<!-- <span class="point">•</span> -->
<span class="categories">
  <i class="fa fa-th-list"></i>
  
    
        <a href="/category/#CI" title="Category: CI" rel="category">CI</a>
    
  

  <!-- <span class="point">•</span> -->
</span>


                    </div>

                    <div class="label-card">
                    
<!-- <span class="point">•</span> -->
<span class="pageTag">
  <i class="fa fa-tags"></i>
  
    
        <a href="/tag/#fastlane" title="Tag: fastlane" rel="tag">fastlane</a>
    
  

</span>

                    </div>
                </div>
                <div class="excerpt">
                    <ul id="markdown-toc">
  <li><a href="#fastlane-" id="markdown-toc-fastlane-">Fastlane 简介</a>    <ul>
      <li><a href="#section" id="markdown-toc-section">1.主要使用场:</a></li>
      <li><a href="#section-1" id="markdown-toc-section-1">2.工具集</a></li>
      <li><a href="#section-2" id="markdown-toc-section-2">3.常见命令</a></li>
    </ul>
  </li>
  <li><a href="#fastlane--1" id="markdown-toc-fastlane--1">fastlane 入门实战</a>    <ul>
      <li><a href="#fastlane" id="markdown-toc-fastlane">1.安装 fastlane</a>        <ul>
          <li><a href="#app-id" id="markdown-toc-app-id">1.1 创建App ID\描述文件</a></li>
          <li><a href="#section-3" id="markdown-toc-section-3">1.2 安装</a></li>
          <li><a href="#fastlane-1" id="markdown-toc-fastlane-1">1.3 为项目配置 fastlane</a></li>
        </ul>
      </li>
      <li><a href="#fastlane--2" id="markdown-toc-fastlane--2">2.fastlane 文件配置</a>        <ul>
          <li><a href="#metadata-" id="markdown-toc-metadata-">2.1 配置 metadata 文件夹</a></li>
          <li><a href="#section-4" id="markdown-toc-section-4">2.2 配置证书</a></li>
          <li><a href="#fastlane--itc" id="markdown-toc-fastlane--itc">2.3 将 fastlane 本地配置上传至 ITC</a></li>
        </ul>
      </li>
      <li><a href="#xcode-" id="markdown-toc-xcode-">3.Xcode 配置</a></li>
      <li><a href="#snapshot--xctest" id="markdown-toc-snapshot--xctest">4.Snapshot 截图和 XCTest</a></li>
      <li><a href="#ipa-" id="markdown-toc-ipa-">5.创建 IPA 文件</a></li>
      <li><a href="#ipa--itc" id="markdown-toc-ipa--itc">6.上传 IPA 文件到 ITC</a></li>
      <li><a href="#deliverfile" id="markdown-toc-deliverfile">7.配置 Deliverfile</a></li>
      <li><a href="#appstore-" id="markdown-toc-appstore-">8.提交 AppStore 审核</a></li>
      <li><a href="#section-5" id="markdown-toc-section-5">9.使用一键命令</a></li>
      <li><a href="#section-6" id="markdown-toc-section-6">10.参考</a></li>
    </ul>
  </li>
</ul>

<blockquote>
  <p>有关神器 Fastlane 持续集成\部署的文章网上挺多,本文定位是入门教程,针对 iOS 应用的持续部署,<strong>只需一条命令就可实现从 Xcode 项目到 编译\打包\构建\提交审核</strong></p>

  <p>文章稍微有点长,涵盖内容为:fastlane 简介\安装\配置 + Snapshot 截图 + XCTest + 一键上传App Store</p>

  <p>说明:本文将 Apple Dev Center 简称为 ADC; iTunes Connect 简称为 ITC</p>

</blockquote>

<ul>
  <li>首发文章及代码请<a href="https://github.com/mythkiven/AD_Fastlane">戳一下</a></li>
  <li>先放图看 fastlane 实现自动上传功能:</li>
</ul>

<p>进度:</p>

<p><img src="https://ooo.0o0.ooo/2017/02/08/589a9ef7823dc.png" alt="" /></p>

<p>提交成功,等待审核
<img src="https://ooo.0o0.ooo/2017/02/08/589aaed07d991.png" alt="" /></p>

<h2 id="fastlane-">Fastlane 简介</h2>

<p>fastlane 是一个完全开源的项目,包含一组 Ruby 实现的工具集,能完成 iOS 和 Android 工程 的自动化构建\测试和发布等功能,<a href="https://krausefx.com/blog/fastlane-is-now-part-of-fabric">现被Twitter收购,是Fabric的一部分</a>.fastlane 强大之处就在于其提供的工具全,基本可以覆盖打包测试发布的所有流程,如下图:</p>

<p><img src="https://ooo.0o0.ooo/2017/02/08/589ace59a6210.png" alt="" /></p>

<p>fastlane 的每一个工具都对应一个 Ruby 脚本,用来执行某一特定的任务,而最妙的是可以通过配置文件将不同的工具灵活的结合在一起,从而形成一个完整的自动化流程,实现一键上传 ITC,从而缩短用于构建发布的时间.</p>

<h5 id="section">1.主要使用场:</h5>

<ul>
  <li>提交时执行测试（包括单元测试和集成测试）</li>
  <li>构建并分发内部测试\公开测试版本</li>
  <li>构建生产版本并上传至 ITC（包括更新配置文件,创建新的屏幕截图,上传应用并提交审核）</li>
  <li>…</li>
</ul>

<h5 id="section-1">2.工具集</h5>

<p>fastlane 将如下的工具套件有机地结合起来,从管理证书到单元测试,从编译打包到上传发布,都能通过命令行轻松完成.该套件支持与 Jenkins 和 CocoaPods,xctools 等其他第三方工具的集成,并且能够定义多个通道（lanes）以支持不同的部署目标.</p>

<ul>
  <li>deliver: 将应用在 ITC 上所需数据提交至 ITC (包括:截图,配置文件,ipa包)</li>
  <li>snapshot: 依靠 UI Test 完成截图</li>
  <li>frameit: 快速地把应用截图放入设备框里</li>
  <li>pem: 可以自动化地生成和更新应用推送通知描述文件</li>
  <li>sigh: 创建\更新\下载和修复 provisioning profiles,支持App Store, Ad Hoc, Development和企业profiles</li>
  <li>gym: 编译\打包iOS app,生成签名的ipa文件</li>
  <li>…</li>
</ul>

<h5 id="section-2">3.常见命令</h5>

<p>fastlane 命令中,个人觉得下面两个较为常用:</p>

<ul>
  <li>列出所有的 fastlane 的 actions:</li>
</ul>

<div class="highlighter-rouge"><pre class="highlight"><code>$ fastlane actions
</code></pre>
</div>

<ul>
  <li>fastlane action [action_name]: 显示某一个 action 的详细配置</li>
</ul>

<div class="highlighter-rouge"><pre class="highlight"><code>$  fastlane action match
</code></pre>
</div>

<h2 id="fastlane--1">fastlane 入门实战</h2>

<h3 id="fastlane">1.安装 fastlane</h3>

<h5 id="app-id">1.1 创建App ID\描述文件</h5>

<ul>
  <li>本教程目标是上传 ITC ,因此需要提前在 ADC 和 ITC 中创建 App ID\描述文件\App</li>
  <li>这里使用的项目是 AD Demo,代码见 <a href="https://github.com/mythkiven/AD_Fastlane">GitHub</a></li>
</ul>

<p><img src="https://ooo.0o0.ooo/2017/02/06/589845eaa299d.png" alt="" />
<img src="https://ooo.0o0.ooo/2017/02/06/589847204b77a.png" alt="" /></p>

<h5 id="section-3">1.2 安装</h5>

<p>查看 Ruby 版本,低于2.0最好升级</p>

<div class="highlighter-rouge"><pre class="highlight"><code>$ ruby -v
</code></pre>
</div>

<p>检查 Xcode CLT 是否安装</p>

<div class="highlighter-rouge"><pre class="highlight"><code>$ xcode-select --install
</code></pre>
</div>

<p>安装 fastlane</p>

<div class="highlighter-rouge"><pre class="highlight"><code>$ sudo gem install -n /usr/local/bin fastlane
</code></pre>
</div>

<p>检查版本 fastlane</p>

<div class="highlighter-rouge"><pre class="highlight"><code>$ fastlane --version
fastlane installation at path:
/Library/Ruby/Gems/2.0.0/gems/fastlane-2.14.2/bin/fastlane
-----------------------------
fastlane 2.14.2
</code></pre>
</div>

<p>OK,安装完成</p>

<h5 id="fastlane-1">1.3 为项目配置 fastlane</h5>

<div class="highlighter-rouge"><pre class="highlight"><code>$ cd 项目目录
$ fastlane init
</code></pre>
</div>

<p>如果期间报错 <code class="highlighter-rouge">Connection reset by peer - SSL_Connect</code>,就需要执行:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>$ brew update &amp;&amp; brew install ruby
// 重装
$ sudo gem install -n /usr/local/bin fastlane
</code></pre>
</div>

<p>然后重新执行</p>
<div class="highlighter-rouge"><pre class="highlight"><code>$ fastlane init
</code></pre>
</div>

<ul>
  <li>期间会让你输入 Apple ID 账号密码(这个信息会存在钥匙串中,后续使用无需再输入密码)</li>
  <li>会检测当前的 app identifier 是否在  ADC 中</li>
  <li>会检测当前 app 是否在 ITC 中</li>
  <li>如果已经在 ADC 和 ITC 中创建相应的信息,那么过程会很顺利,如下图:</li>
</ul>

<p><img src="https://ooo.0o0.ooo/2017/02/07/58992aea708c6.png" alt="" /></p>

<p>并在 Xcode 项目目录中生成如下文件:</p>

<p><img src="https://ooo.0o0.ooo/2017/02/07/58992b1016443.png" alt="" /></p>

<p>注意:如果没有在 ITC 中创建 App ,也就不会创建上述两个文件夹;当然也可以后续创建,执行如下操作即可:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>$ fastlane produce init
</code></pre>
</div>

<h3 id="fastlane--2">2.fastlane 文件配置</h3>

<p>fastlane 的各文件解释如下:</p>

<ul>
  <li>Appfile:用于存储应用程序标识符和Apple ID 等信息</li>
  <li>Fastfile:配置管理 lane</li>
  <li>Deliverfile:配置应用在 ITC 中的各种信息,和 ICC 中的数据是一一对应的</li>
  <li>metadata:包含应用在 ITC 中的各种信息</li>
  <li>screenshots:包含截图数据</li>
</ul>

<p>需要注意的是,metadata 和 Deliverfile,都可以配置 ITC 的数据,但后者优先级高.正如下图:</p>

<p><img src="https://ooo.0o0.ooo/2017/02/08/589aba7c0b998.png" alt="" /></p>

<p><img src="https://ooo.0o0.ooo/2017/02/08/589aba7c1d252.png" alt="" /></p>

<p>下文先在 metadata 文件夹中进行配置用于演示,在文末会删除 metadata 中的配置文本,全部配置在 Deliverfile 中.</p>

<h5 id="metadata-">2.1 配置 metadata 文件夹</h5>

<p>修改 App 描述:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>$ cd metadata 
$ cd zh-Hans
$ vim description.txt
</code></pre>
</div>

<p>修改关键字:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>$ vim keywords.txt
</code></pre>
</div>

<p>修改 support_url:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>$ vim support_url.txt
</code></pre>
</div>

<p>修改 copyright:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>$ vim copyright.txt
</code></pre>
</div>

<p>等等,其他信息的修改类似.</p>

<p>然后创建分级文件:itunes_rating_config.json,这个和 ICC 中的分级是对应的.</p>

<div class="language-json highlighter-rouge"><pre class="highlight"><code><span class="p">{</span><span class="nt">"CARTOON_FANTASY_VIOLENCE"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
</span><span class="nt">"REALISTIC_VIOLENCE"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> 
</span><span class="nt">"PROLONGED_GRAPHIC_SADISTIC_REALISTIC_VIOLENCE"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
</span><span class="nt">"PROFANITY_CRUDE_HUMOR"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
</span><span class="nt">"MATURE_SUGGESTIVE"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> 
</span><span class="nt">"HORROR"</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w">
</span><span class="nt">"MEDICAL_TREATMENT_INFO"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
</span><span class="nt">"ALCOHOL_TOBACCO_DRUGS"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> 
</span><span class="nt">"GAMBLING"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> 
</span><span class="nt">"SEXUAL_CONTENT_NUDITY"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
</span><span class="nt">"GRAPHIC_SEXUAL_CONTENT_NUDITY"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> 
</span><span class="nt">"UNRESTRICTED_WEB_ACCESS"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
</span><span class="nt">"GAMBLING_CONTESTS"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
</div>

<p>此处配置参见<a href="https://github.com/fastlane/fastlane/blob/master/deliver/Reference.md">官方文档</a></p>

<p>然后将 App 图标添加至文件夹中,接下来要创建证书:</p>

<h5 id="section-4">2.2 配置证书</h5>

<p>修改 Fastfile:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>$ vim Fastfile
</code></pre>
</div>

<p>修改内容如下:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>fastlane_version "2.14.2"

default_platform :ios

platform :ios do
 
  # 当前任务的描述
  desc "Creating a code signing certificate and provisioning profile"
  # 任务名称
  lane :provision do
    # 创建 ITC 中的 App 信息
    produce(
      app_name: 'AD_Demo',
      language: 'zh-Hans',
      app_version: '1.0',
      sku: 'com.3code.ADDemo.Test'
    )
    # 使用证书创建私钥及签名
    cert
    # 每次运行时创建新的配置文件
    sigh(force: true)
  end
 
  error do |lane, exception|
  
  end
  
end
</code></pre>
</div>

<p>如果想创建 ad hoc 配置文件,需要指定sigh(adhoc: true).更多的信息参见:</p>

<ul>
  <li><a href="https://github.com/fastlane/fastlane/tree/master/fastlane/docs">官方文档</a></li>
  <li><a href="https://docs.fastlane.tools/actions/">fastlane actions</a></li>
</ul>

<h5 id="fastlane--itc">2.3 将 fastlane 本地配置上传至 ITC</h5>

<p>重新进入项目目录,执行如下操作:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>$ fastlane provision
</code></pre>
</div>

<p>等待一小会儿,终端提示成功创建证书配置:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>fastlane.tools finished successfully 🎉
</code></pre>
</div>

<p>打开 ICC 网页,会发现本地的配置,已经成功上传.</p>

<h3 id="xcode-">3.Xcode 配置</h3>

<p>xcode 配置也简单,只需要将项目修改至生产状态即可(描述文件).其它像构建版本号之类的不用理会, fastlane 会处理的.</p>

<h3 id="snapshot--xctest">4.Snapshot 截图和 XCTest</h3>

<p>snapshot 需要和 XCTest 配合使用,关于 XCTest,我的博客中<a href="www.3code.info/2017/01/23/AD-XCTest/">有一篇文章</a>做了简单介绍.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>$ fastlane snapshot init
</code></pre>
</div>

<p>目录中会生成一个 Snapfile 文件,用于配置截图信息,修改内容如下:</p>

<div class="highlighter-rouge"><pre class="highlight"><code># 图片尺寸
devices([
  "iPhone 5",
  "iPhone 6",
  "iPhone 6 Plus"
])
 
# 支持语言
languages([
  'zh-Hans'
])
 
# 储存位置
output_directory "./fastlane/screenshots"
 
# 删除之前图片
clear_previous_screenshots true
</code></pre>
</div>

<p>然后打开 Xcode 工程,添加截图设置(需要增加 UI Test, 因为截图是在 UI Test 时截取的):</p>

<div class="highlighter-rouge"><pre class="highlight"><code>\\ 1）在项目添加UI测试,已经添加略过
\\ 2）将./fastlane/SnapshotHelper.swift 添加到UI测试中
\\ 3）打开 AD_DemoUITests.swift ,删除setUp和tearDown方法，然后在其中添加以下代码testExample：
 
  let app = XCUIApplication()
  setupSnapshot(app)
  app.launch()
  
  app.buttons["next"].tap()
  snapshot("01firstPage") // 此处截图
  
  app.buttons["back"].tap()
  snapshot("02secondPage") // 此处截图

</code></pre>
</div>

<p>打开 Fastfile ,并添加如下信息,用于配置截图</p>

<div class="highlighter-rouge"><pre class="highlight"><code>  desc "Take screenshots"
  lane :screenshot do
    snapshot
  end
</code></pre>
</div>

<p>执行 <code class="highlighter-rouge">$ fastlane screenshot</code>, fastlane 会自动调用模拟器,执行测试并生成快照,可能会由于模拟器启动慢而导致时间稍微有点长.</p>

<p>成功截图的提示:</p>

<p><img src="https://ooo.0o0.ooo/2017/02/07/58995745a83cd.png" alt="" /></p>

<h3 id="ipa-">5.创建 IPA 文件</h3>

<p>打开 fastfile,加入如下代码,配置创建 ipa</p>

<div class="highlighter-rouge"><pre class="highlight"><code>desc "Create ipa"
  lane :build do
    increment_build_number
    gym
  end
</code></pre>
</div>

<p>保存并执行如下操作,将自动创建 IPA 包</p>

<div class="highlighter-rouge"><pre class="highlight"><code>$ fastlane build
</code></pre>
</div>

<p>如果出现错误: <code class="highlighter-rouge">There does not seem to be a CURRENT_PROJECT_VERSION key set for this project.  Add this key to your target's expert build settings.</code>
<a href="https://developer.apple.com/library/content/qa/qa1827/_index.html">请查阅此处</a></p>

<p>这是一个自动增加构建版本号的设置,需要手动修改.</p>

<h3 id="ipa--itc">6.上传 IPA 文件到 ITC</h3>

<p>打开 Fastfile ,添加如下代码:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>desc "Upload to App Store"
  lane :upload do
    deliver
  end
</code></pre>
</div>

<p>然后执行命令,上传到 ITC :</p>

<div class="highlighter-rouge"><pre class="highlight"><code>$ fastlane upload
</code></pre>
</div>

<p>期间,会创建一个 html 形式的预览文件,确认没问题输入 y;</p>

<p>当然最有可能的错误就是网络链接的问题: <code class="highlighter-rouge">Please use diagnostic mode to check connectivity. You need to have outbound access to TCP port 443.</code> 重新配置代理即可.</p>

<h3 id="deliverfile">7.配置 Deliverfile</h3>

<p>其实上传 ITC 最主要的文件是 Deliverfile,配置好 Deliverfile 后,可以删除 metadata 文件夹中的文本配置.最终配置如下图:</p>

<p><img src="https://ooo.0o0.ooo/2017/02/08/589ac0ac8d172.png" alt="" /></p>

<p>以下是主要的配置,更多更详细的<a href="https://github.com/mythkiven/AD_Fastlane/blob/master/AD_Demo/fastlane/Deliverfile">请戳文件</a>,里面有详细的注释,拿来即可使用</p>

<div class="highlighter-rouge"><pre class="highlight"><code>
# 1 app_identifier
app_identifier "com.3code.ADDemo"

# 2 用户名,Apple ID电子邮件地址
username "Apple ID电子邮件地址"  

# 3 支持语言
supportedLanguages = {
  "cmn-Hans" =&gt; "zh-Hans"
}

# 4 app 名称
name({
'zh-Hans' =&gt; "ADDemo"
})

# 5 描述
description({
  'zh-Hans' =&gt; "简体中文版"
})

# 6 提交审核信息
submission_information({    
    export_compliance_encryption_updated: false,
    export_compliance_uses_encryption: false,
    content_rights_contains_third_party_content: false,
    add_id_info_uses_idfa: false
})

# 7 应用审核小组的联系信息 app 审核信息
app_review_information(
  first_name: "name",
  last_name: "name",
  phone_number: "手机号",
  email_address: "email",
  demo_user: "测试账号用户名",
  demo_password: "测试账号密码",
  notes: "noting"
)

# 8 copyright 
copyright "#{Time.now.year} 3code"

# 
</code></pre>
</div>

<h3 id="appstore-">8.提交 AppStore 审核</h3>

<p>继续打开 Fastfile,修改如下代码:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>desc "Upload to App Store and submit for review"
  lane :upload do
    deliver(
      submit_for_review: true
    )
  end
</code></pre>
</div>

<p>然后执行命令,提交审核 :</p>

<div class="highlighter-rouge"><pre class="highlight"><code>$ fastlane upload
</code></pre>
</div>

<h3 id="section-5">9.使用一键命令</h3>

<p>添加如下的代码,可以一步搞定所有的操作:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>desc "Provision, take screenshots, build and upload to App Store"
  lane :do_everything do
    provision
    screenshot
    build
    upload
  end
</code></pre>
</div>

<p>对应的命令是:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>$ fastlane do_everything
</code></pre>
</div>

<ul>
  <li>
    <p>本文只是简单的介绍了 fastlane 的使用,更多的资料还请参考文末的链接</p>
  </li>
  <li>
    <p>如果你对 ITC 不了解,或者很少发布 App ,建议看看官方文档,要知道发布 App 也有<a href="https://developer.apple.com/library/content/documentation/LanguagesUtilities/Conceptual/iTunesConnect_Guide_SCh/Appendices/Properties.html">官方指南哦</a></p>
  </li>
  <li>
    <p>本文是系列文章,后续文章会陆续在这里以及我的<a href="www.3code.info">博客</a>中发布,喜欢请给个✨吧</p>
  </li>
</ul>

<h3 id="section-6">10.参考</h3>

<ul>
  <li><a href="https://fastlane.tools/">官网</a></li>
  <li><a href="https://github.com/fastlane/fastlane">github</a></li>
  <li><a href="https://docs.fastlane.tools/getting-started/ios/setup/">文档</a></li>
</ul>

<p>最后给点小建议:如果遇到错误首选就是查 issues,你遇到的问题,基本前人都遇到过了.我能在2天里快速入门 fastlane 全靠看 issues 😁😁</p>


                </div>
                <div class="read-all">
                    <a  href="/2017/02/07/AD-Fastlane/"><i class="fa fa-newspaper-o"></i>Read All</a>
                </div>
                <hr>
              </li>
            
              <li>
                <h2>
                  <a class="post-link" href="/2017/01/23/AD-XCTest/">持续集成系列 - 测试: XCTest</a>
                </h2>
                <div class="label">
                    <div class="label-card">
                        <i class="fa fa-calendar"></i>2017-01-23
                    </div>
                    <div class="label-card">
                        <i class="fa fa-user"></i>3行代码
                        
                    </div>
                    <div class="label-card">
                        
                    </div>

                    <div class="label-card">
                    


<!-- <span class="point">•</span> -->
<span class="categories">
  <i class="fa fa-th-list"></i>
  
    
        <a href="/category/#CI" title="Category: CI" rel="category">CI</a>
    
  

  <!-- <span class="point">•</span> -->
</span>


                    </div>

                    <div class="label-card">
                    
<!-- <span class="point">•</span> -->
<span class="pageTag">
  <i class="fa fa-tags"></i>
  
    
        <a href="/tag/#XCTest" title="Tag: XCTest" rel="tag">XCTest</a>
    
  

</span>

                    </div>
                </div>
                <div class="excerpt">
                    <ul id="markdown-toc">
  <li><a href="#section" id="markdown-toc-section">简述</a></li>
  <li><a href="#ui-testing--accessibility" id="markdown-toc-ui-testing--accessibility">UI Testing 和 Accessibility</a></li>
  <li><a href="#demo" id="markdown-toc-demo">demo</a></li>
</ul>

<h3 id="section">简述</h3>

<p>说起 UI 测试,在 iOS 的开源社区有过一系列的尝试,比如 KIF 框架,Apple 自己的 Automating UI Testing 或者 Facebook 的截图测试等.这些方法有一个共同的特点,那就是配置起来十分繁琐,使用上也有诸多不便.这大概也是 UI 测试所面临的最大窘境 – 往往开发者在一个项目里写了一两个 UI 测试用例后,就会觉得难以维护,怯于巨大的时间成本,继而放弃.</p>

<p>Apple 在 Xcode 7 中新加入了一套 UI Testing 的工具,其目的就是解决这个问题.新的 UI Testing 比以往的解决方案要简单不少,特别是在创建测试用例的时候更集成了录制的功能,这有希望让 UI Testing 变得更为普及.</p>

<p>其他概念比如: 单元测试\集成测试.</p>

<p>单元测试:对软件中的最小可测试单元进行检验。通常而言，一个单元测试是用于判断某个特定条件（或者场景）下某个特定函数的行为。相比其他层级的测试，单元测试发现并解决问题付出的成本相对来说最低，而投入产出比最高</p>

<p>集成测试:是在单元测试的基础上，将所有模块按照设计要求（如根据结构图）组装成为子系统或系统，进行集成测试集成测试是在单元测试的基础上，测试在将所有的软件单元按照概要设计规格说明的要求组装成模块、子系统或系统的过程中各部分工作是否达到或实现相应技术指标及要求的活动。也就是说，在集成测试之前，单元测试应该已经完成。这一点很重要，因为如果不经过单元测试，那么集成测试的效果将会受到很大影响，并且会大幅增加软件单元代码纠错的代价。</p>

<h3 id="ui-testing--accessibility">UI Testing 和 Accessibility</h3>

<p>在 iOS 中使用 XCTest, 就必须要了解 Accessibility. UI Accessibility 早在 iOS 3.0 就被引入了,用来辅助身体不便的人士使用 app.VoiceOver 是 Apple 的屏幕阅读技术,而 UI Accessibility 的基本原则就是对屏幕上的 UI 元素进行分类和标记.两者配合,通过阅读或者聆听这些元素,用户就可以在不接触屏幕的情况下通过声音来使用 app.</p>

<p>Accessibility 的核心思想是对 UI 元素进行分类和标记 – 将屏幕上的 UI 分类为像是按钮,文本框,cell 或者是静态文本 (也就是 label) 这样的类型,然后使用 identifier 来区分不同的 UI 元素.用户可以通过语音控制 app 的按钮点击,或是询问某个 label 的内容等等,十分方便.iOS SDK 中的控件都实现了默认的 Accessibility 支持,而我们如果使用自定义的控件的话,则需要自行使用 Accessibility 的 API 来进行添加.</p>

<p>UI 测试的本质就是定位在屏幕上的元素,实现一些像是点击或者拖动这样的操作交互,然后获取 UI 的状态进行断言来判断是否符合我们的预期.这个过程及其需求与 Accessibility 的功能是高度吻合的.这也是为什么 iOS 中大部分的 UI 测试框架都是基于 UI Accessibility 的原因, UI Testing 也不例外.</p>

<h3 id="demo">demo</h3>

<p>demo 比较简单,主要用于演示基本的流程,代码在 GitHub 中.</p>

<p>相比起其他一些 UI 测试框架,Xcode 的 UI Testing 最为诱人的优点在于可以直接录制操作.新建一个 XCTest,默认实现如下:</p>

<div class="language-swift highlighter-rouge"><pre class="highlight"><code><span class="kd">import</span> <span class="kt">XCTest</span>

<span class="kd">class</span> <span class="kt">UITESTUITests</span><span class="p">:</span> <span class="kt">XCTestCase</span> <span class="p">{</span>
        
    <span class="k">override</span> <span class="kd">func</span> <span class="nf">setUp</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">super</span><span class="o">.</span><span class="nf">setUp</span><span class="p">()</span>
        
        <span class="n">continueAfterFailure</span> <span class="o">=</span> <span class="kc">false</span>
        
        <span class="c1">// launch 方法来启动测试 app</span>
        <span class="c1">// XCUIApplication 是 UIApplication 在测试进程中的代理 (proxy)</span>

        <span class="kt">XCUIApplication</span><span class="p">()</span><span class="o">.</span><span class="nf">launch</span><span class="p">()</span> 

    <span class="p">}</span>
    
    <span class="k">override</span> <span class="kd">func</span> <span class="nf">tearDown</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">super</span><span class="o">.</span><span class="nf">tearDown</span><span class="p">()</span>
    <span class="p">}</span>
    
    <span class="kd">func</span> <span class="nf">testExample</span><span class="p">()</span> <span class="p">{</span>
        
    <span class="p">}</span>
    
<span class="p">}</span>
</code></pre>
</div>

<p>使用的方法是,先创建一个测试方法,然后将光标停留在方法中,然后点击录制.和 app 的交互就会被自动转写成代码.</p>

<p><img src="https://ooo.0o0.ooo/2017/02/06/5898158326f72.png" alt="" /></p>

<p>操作是:</p>
<ul>
  <li>2次点击 “color” 按钮 ,改变背景色</li>
  <li>点击”下一页”按钮 push 到第二页</li>
  <li>点击”back” 按钮 pop 回第一页</li>
</ul>


                </div>
                <div class="read-all">
                    <a  href="/2017/01/23/AD-XCTest/"><i class="fa fa-newspaper-o"></i>Read All</a>
                </div>
                <hr>
              </li>
            
              <li>
                <h2>
                  <a class="post-link" href="/2017/01/13/Travis-CI/">持续集成系列 - Github中的魔法工具:Travis CI</a>
                </h2>
                <div class="label">
                    <div class="label-card">
                        <i class="fa fa-calendar"></i>2017-01-13
                    </div>
                    <div class="label-card">
                        <i class="fa fa-user"></i>3行代码
                        
                    </div>
                    <div class="label-card">
                        
                    </div>

                    <div class="label-card">
                    


<!-- <span class="point">•</span> -->
<span class="categories">
  <i class="fa fa-th-list"></i>
  
    
        <a href="/category/#CI" title="Category: CI" rel="category">CI</a>
    
  

  <!-- <span class="point">•</span> -->
</span>


                    </div>

                    <div class="label-card">
                    
<!-- <span class="point">•</span> -->
<span class="pageTag">
  <i class="fa fa-tags"></i>
  
    
        <a href="/tag/#Github" title="Tag: Github" rel="tag">Github</a>&nbsp;
    
        <a href="/tag/#Travis-CI" title="Tag: Travis-CI" rel="tag">Travis-CI</a>
    
  

</span>

                    </div>
                </div>
                <div class="excerpt">
                    <ul id="markdown-toc">
  <li><a href="#jenkins" id="markdown-toc-jenkins">基础知识,参考博文:Jenkins</a></li>
  <li><a href="#travis-ci-" id="markdown-toc-travis-ci-">1. Travis-CI 简介</a>    <ul>
      <li><a href="#jenkins-1" id="markdown-toc-jenkins-1">对比 Jenkins</a></li>
    </ul>
  </li>
  <li><a href="#travis-ci--1" id="markdown-toc-travis-ci--1">2.Travis-CI 配置小教程</a>    <ul>
      <li><a href="#project-" id="markdown-toc-project-">project 项目配置</a></li>
      <li><a href="#workspace-" id="markdown-toc-workspace-">workspace 管理的项目配置</a></li>
    </ul>
  </li>
  <li><a href="#section" id="markdown-toc-section">3. 应用程序的签名\证书</a></li>
  <li><a href="#section-1" id="markdown-toc-section-1">4.部署</a></li>
  <li><a href="#section-2" id="markdown-toc-section-2">密码和证书安全</a></li>
  <li><a href="#section-3" id="markdown-toc-section-3">其他</a>    <ul>
      <li><a href="#section-4" id="markdown-toc-section-4">显示构建状态</a></li>
      <li><a href="#section-5" id="markdown-toc-section-5">跳过自动构建</a></li>
    </ul>
  </li>
  <li><a href="#section-6" id="markdown-toc-section-6">资源</a>    <ul>
      <li><a href="#unit-" id="markdown-toc-unit-">Unit 代表单元测试:</a></li>
    </ul>
  </li>
  <li><a href="#ui-" id="markdown-toc-ui-">UI 测试</a></li>
</ul>

<h3 id="jenkins">基础知识,参考博文:Jenkins</h3>

<h3 id="travis-ci-">1. Travis-CI 简介</h3>

<p>Travis-CI 是一个开源的持续构建项目,能够测试和部署;Travis-CI 会同步你在 GitHub 上托管的项目,每当你 Commit Push 之后,预装的编译脚本会分析你的 Xcode 项目,并对每个 target 进行编译.如果所有文件都没有编译错误,并且测试也没有被打断,那么项目就编译成功了.</p>

<h5 id="jenkins-1">对比 Jenkins</h5>

<ul>
  <li>Jenkins 和 Travis-CI 类似,前者主要用于公司中项目的 CI(商业化),后者则主要用在 GitHub 中(小众)</li>
  <li>都是基于 Vagrant/Virtualbox技术</li>
  <li>配置文件:Jenkins 配置在 Jenkins 服务器中,后者配置文件和源码一起.使用 DSL 编写的</li>
  <li>Travis Ci 与 Github 集成非常紧密,官方的集成测试托管只支持 Github 项目</li>
  <li>总的来说:如果是开源项目,放在 GitHub 上,使用 Travis CI 来做集成测试是最佳选择.但如果是公司项目,当然是搭建 Jenkins 环境.</li>
</ul>

<h3 id="travis-ci--1">2.Travis-CI 配置小教程</h3>

<ul>
  <li>1.用你的 GitHub 账号登录 <a href="https://travis-ci.org/">Travis-CI</a>,赋予 TCI 访问 GH 的授权.</li>
</ul>

<p>对于私有仓库,需要注册一个 <a href="https://magnum.travis-ci.com/">Travis 专业版账号</a></p>

<ul>
  <li>
    <p>2.登录之后 Travis-CI 就会同步 GitHub 账号的仓库,然后打开个人页面并给你想要构建的项目启用 Travis-CI <img src="https://raw.githubusercontent.com/nukc/how-to-use-travis-ci/master/images/enable.png" alt="" /></p>
  </li>
  <li>
    <p>3.创建一个 .travis.yml 文件,在项目的根目录下.则 Travis-CI 会按照 .travis.yml 里的内容进行构建</p>
  </li>
  <li>
    <p>4.最后可以在<a href="https://travis-ci.org/repositories">构建状态页面</a>来查看你的项目是否构建成功</p>
  </li>
</ul>

<h5 id="project-">project 项目配置</h5>

<pre><code class="language-DSL">language: swift # 语言种类
#language: objective-c 

osx_image: xcode8 # 环境

# 根据项目类型不同,可以选择两个 key :xcode_project 或者  xcode_workspace
xcode_project: ./UITEST.xcodeproj # 项目文件相对于.travis.yml文件的路径

xcode_scheme: UITEST # 你需要集成测试的scheme

xcode_sdk: iphonesimulator10.0 # 模拟器

</code></pre>

<h5 id="workspace-">workspace 管理的项目配置</h5>

<pre><code class="language-DSL">language: swift # 语言种类
#language: objective-c 

osx_image: xcode8 # 环境

# 根据项目类型不同,可以选择两个 key :xcode_project 或者  xcode_workspace
xcode_workspace: ./UITEST.xcworkspace # 项目文件相对于.travis.yml文件的路径

xcode_scheme: UITEST # 你需要集成测试的scheme

xcode_sdk: iphonesimulator10.0 # 模拟器

</code></pre>

<p>同时也要设置 Target 为 shared 状态.</p>

<blockquote>
  <p>打开项目 -&gt; Manage Schemes -&gt; 把需要构建的 Target 勾上 shared -&gt; 选中你需要管理的 scheme,点击左下角的 Edit 按钮 -&gt; 选择 Build 选项，点击左下角的+号按钮，添加你需要依赖的 CocoaPods 管理的第三方静态库的名字，下图是已经添加后的截图.</p>
</blockquote>

<p><img src="http://upload-images.jianshu.io/upload_images/656113-97e903b6472ce2eb.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="" /></p>

<p>以上配置,可以看看<a href="https://docs.travis-ci.com/user/languages/objective-c/">官方文档</a>,写的挺详细的</p>

<h3 id="section">3. 应用程序的签名\证书</h3>

<p>[参见(https://objccn.io/issue-6-5/)</p>

<h3 id="section-1">4.部署</h3>

<p>负责分发部署的平台很多像:TestFlight \ HockeyApp \ 蒲公英 \ fir.im 等等</p>

<p>可以配置然后在上述平台进行部署.</p>

<h3 id="section-2">密码和证书安全</h3>

<p>对于密码等敏感信息,Travis CI提供了2种解决方案:</p>

<ul>
  <li>对密码等敏感信息进行加密,然后再构建环境时解密</li>
  <li>在 Travis CI控制台设置环境变量,然后使用 System.getenv() 获取值</li>
</ul>

<p><img src="https://raw.githubusercontent.com/nukc/how-to-use-travis-ci/master/images/var-setting.png" alt="" /></p>

<h3 id="section-3">其他</h3>

<h5 id="section-4">显示构建状态</h5>

<p><img src="https://raw.githubusercontent.com/nukc/how-to-use-travis-ci/master/images/image.png" alt="" /></p>

<h5 id="section-5">跳过自动构建</h5>

<p>如果commit不想让travis ci构建，那么就在commit message里加上[ci skip]就行了。</p>

<div class="language-shell highlighter-rouge"><pre class="highlight"><code>git commit -m <span class="s2">"[ci skip] commit message"</span>
</code></pre>
</div>

<h3 id="section-6">资源</h3>

<ul>
  <li><a href="https://docs.travis-ci.com/user/customizing-the-build/">官方文档</a></li>
  <li><a href="https://github.com/objcio/issue-6-travis-ci">示例 Demo</a></li>
  <li><a href="https://github.com/facebook/xctool">xctool</a></li>
  <li><a href="https://github.com/nukc/how-to-use-travis-ci">安卓环境下的教程</a></li>
</ul>

<p>-<a href="https://objccn.io/issue-6-5/">优秀的文章为 iOS 建立 Travis CI:签名+部署+发布</a>
-<a href="http://blog.csdn.net/jiang314/article/details/54965283">备份版:优秀的文章为 iOS 建立 Travis CI:签名+部署+发布</a></p>

<p>为 iOS 建立 Travis CI: https://objccn.io/issue-6-5/</p>

<p>自动化测试 –&gt; 持续部署</p>

<p>在互联网的产品开发时代，产品迭代越来越频繁，“从功能开发完成直到成功部署”这一阶段被称为软件开发“最后一公里”。很多开发团队也越来越认识到，自动化测试和持续部署可帮助开发团队提高迭代效率和质量。
那么，如何更好地解决“最后一公里”这一问题呢?</p>

<p>一切从自动化测试开始，让自动化测试贯穿在整个项目开发-集成-部署-交付的-开发流程中。</p>

<p><img src="http://huaban.com/go/?pin_id=1002439558" alt="" />
在这个分层自动化测试金字塔中，</p>
<h4 id="unit-">Unit 代表单元测试:</h4>

<p>XCTest是苹果在iOS 7和Xcode5引入的一个简单而强大的测试框架，它的测试编写起来非常简单，并且遵循xUnit风格。XCTest的优点是与Xcode深度集成，有专门的Test导航栏，但因为受限于官方测试API，因此功能不是很丰富。</p>

<p>iOS 中的单元测试开源库:</p>
<ul>
  <li>Kiwi是对XCTest的一个完整替代，使用xSpec风格编写测试。Kiwi带有自己的一套工具集，包括expectations、mocks、stubs，甚至还支持异步测试。</li>
  <li>Specta与Kiwi功能相似，但在架构上非常不同。Kiwi注重功能的整合，而Specta则注重模块化。它本身只专注于运行测试，而将模拟、匹配等功能交给第三方。下
下面这些一些开源测试组件，它们能与Specta和Kiwi框架搭配使用：</li>
  <li>Expecta：匹配程序框架。</li>
  <li>OCHamcrest：匹配程序框架。</li>
  <li>OCMock：模拟测试框架。</li>
  <li>OCMockito：模拟测试框架。</li>
  <li>OHTTPStubs：模拟网络请求的库，基于block的语法来匹配URL。</li>
  <li>Nocilla：模拟网络请求的库，使用链式API。</li>
  <li>Quick是:一个使用Swift开发的新测试框架，对测试使用Swift编写的App非常友好。它还有一个Nimble库用于编写匹配模式。</li>
</ul>

<p>对软件中的最小可测试单元进行检验。通常而言，一个单元测试是用于判断某个特定条件（或者场景）下某个特定函数的行为。相比其他层级的测试，单元测试发现并解决问题付出的成本相对来说最低，而投入产出比最高</p>

<h3 id="ui-">UI 测试</h3>

<ul>
  <li>KIF（Keep It Functional）是用Objective-C编写的用户界面测试框架。KIF tester使用了私有API来了解App中的视图层级。缺点是运行较慢。</li>
</ul>

<blockquote>
  <p>相关文章:<a href="http://www.blogs8.cn/posts/A1Rj797">Swift中KIF测试的特点－b</a></p>
</blockquote>

<ul>
  <li>
    <p>Subliminal是另一款与XCTest集成的框架。与KIF不同的是，它基于UIAutomation编写，旨在对开发者隐藏UIAutomation中一些复杂的细节。不过它最后更新日期是2014年2月，可能已停止更新。</p>
  </li>
  <li>
    <p>Calabash是跨平台开发工具Xamarin推出的一款测试工具。它使用BDD风格来编写验收测试。它的优点是支持跨平台（需使用不同的库），声明式的测试风格非常易于读写。缺点是不够稳定并且运行速度慢。</p>
  </li>
</ul>


                </div>
                <div class="read-all">
                    <a  href="/2017/01/13/Travis-CI/"><i class="fa fa-newspaper-o"></i>Read All</a>
                </div>
                <hr>
              </li>
            
              <li>
                <h2>
                  <a class="post-link" href="/2017/01/08/SDiffuseMenu/">Swift 版 AwesomeMenu 的改写之旅:SDiffuseMenu</a>
                </h2>
                <div class="label">
                    <div class="label-card">
                        <i class="fa fa-calendar"></i>2017-01-08
                    </div>
                    <div class="label-card">
                        <i class="fa fa-user"></i>3行代码
                        
                    </div>
                    <div class="label-card">
                        
                    </div>

                    <div class="label-card">
                    


<!-- <span class="point">•</span> -->
<span class="categories">
  <i class="fa fa-th-list"></i>
  
    
        <a href="/category/#Swift3.0" title="Category: Swift3.0" rel="category">Swift3.0</a>
    
  

  <!-- <span class="point">•</span> -->
</span>


                    </div>

                    <div class="label-card">
                    
<!-- <span class="point">•</span> -->
<span class="pageTag">
  <i class="fa fa-tags"></i>
  
    
        <a href="/tag/#SDiffuseMenu" title="Tag: SDiffuseMenu" rel="tag">SDiffuseMenu</a>&nbsp;
    
        <a href="/tag/#Animation" title="Tag: Animation" rel="tag">Animation</a>
    
  

</span>

                    </div>
                </div>
                <div class="excerpt">
                    <ul id="markdown-toc">
  <li><a href="#section" id="markdown-toc-section">一、使用方法：</a>    <ul>
      <li><a href="#section-1" id="markdown-toc-section-1">1、添加协议</a></li>
      <li><a href="#section-2" id="markdown-toc-section-2">2、设置菜单的选项按钮数据</a></li>
      <li><a href="#section-3" id="markdown-toc-section-3">3、设置菜单按钮</a></li>
      <li><a href="#sdiffusemenu" id="markdown-toc-sdiffusemenu">4、添加 SDiffuseMenu</a></li>
      <li><a href="#section-4" id="markdown-toc-section-4">5、动画配置</a></li>
      <li><a href="#section-5" id="markdown-toc-section-5">6、动画过程监听</a></li>
    </ul>
  </li>
  <li><a href="#swift" id="markdown-toc-swift">二、Swift转写之旅</a>    <ul>
      <li><a href="#capropertyanimation" id="markdown-toc-capropertyanimation">1、CAPropertyAnimation动画</a></li>
      <li><a href="#section-6" id="markdown-toc-section-6">2、动画分析</a>        <ul>
          <li><a href="#section-7" id="markdown-toc-section-7">2.1、单个选项关闭动画分析：</a></li>
          <li><a href="#section-8" id="markdown-toc-section-8">2.2、整体动画的控制</a></li>
        </ul>
      </li>
    </ul>
  </li>
</ul>

<blockquote>
  <p>本动画是 Swift 版的 AwesomeMenu,如需OC版还请移步<a href="https://github.com/levey/AwesomeMenu">这里</a>。</p>

  <p>SDiffuseMenu 当前版本 V1.2.1,代码<a href="https://github.com/mythkiven/DiffuseMenu_Swift">请戳这里</a></p>

  <p>SDiffuseMenu 嵌入 pod ‘SDiffuseMenu’, ‘~&gt; 1.2.1’</p>

</blockquote>

<p><strong>动画效果如下:</strong></p>

<p><img src="https://raw.githubusercontent.com/mythkiven/DiffuseMenu_Swift/master/Source/SDiffuseMenu.gif" alt="" /></p>

<p><strong>配置图如下:</strong></p>

<p><img src="https://raw.githubusercontent.com/mythkiven/DiffuseMenu_Swift/master/Source/settingAngle.png" alt="" /></p>

<h2 id="section">一、使用方法：</h2>

<p>添加协议(动画状态回调) -&gt; 设置选项数组 -&gt; 设置菜单按钮 -&gt; 动画属性配置 -&gt; .addSubview(menu)</p>

<h4 id="section-1">1、添加协议</h4>

<div class="language-swift highlighter-rouge"><pre class="highlight"><code><span class="kd">class</span> <span class="kt">ViewController</span><span class="p">:</span> <span class="kt">UIViewController</span><span class="p">,</span> <span class="kt">SDiffuseMenuDelegate</span> <span class="p">{</span>
    <span class="k">var</span> <span class="nv">menu</span><span class="p">:</span> <span class="kt">SDiffuseMenu</span><span class="o">!</span>
<span class="p">}</span>
</code></pre>
</div>

<h4 id="section-2">2、设置菜单的选项按钮数据</h4>

<div class="language-swift highlighter-rouge"><pre class="highlight"><code><span class="c1">// 加载图片</span>
<span class="k">guard</span> <span class="k">let</span> <span class="nv">storyMenuItemImage</span>            <span class="o">=</span>  <span class="kt">UIImage</span><span class="p">(</span><span class="nv">named</span><span class="p">:</span><span class="s">"menuitem-normal.png"</span><span class="p">)</span>         <span class="k">else</span> <span class="p">{</span> <span class="nf">fatalError</span><span class="p">(</span><span class="s">"图片加载失败"</span><span class="p">)</span> <span class="p">}</span>
<span class="k">guard</span> <span class="k">let</span> <span class="nv">storyMenuItemImagePressed</span>     <span class="o">=</span>  <span class="kt">UIImage</span><span class="p">(</span><span class="nv">named</span><span class="p">:</span><span class="s">"menuitem-highlighted.png"</span><span class="p">)</span>    <span class="k">else</span> <span class="p">{</span> <span class="nf">fatalError</span><span class="p">(</span><span class="s">"图片加载失败"</span><span class="p">)</span> <span class="p">}</span>
<span class="k">guard</span> <span class="k">let</span> <span class="nv">starImage</span>                     <span class="o">=</span>  <span class="kt">UIImage</span><span class="p">(</span><span class="nv">named</span><span class="p">:</span><span class="s">"star.png"</span><span class="p">)</span>                    <span class="k">else</span> <span class="p">{</span> <span class="nf">fatalError</span><span class="p">(</span><span class="s">"图片加载失败"</span><span class="p">)</span> <span class="p">}</span>
<span class="k">guard</span> <span class="k">let</span> <span class="nv">starItemNormalImage</span>           <span class="o">=</span>  <span class="kt">UIImage</span><span class="p">(</span><span class="nv">named</span><span class="p">:</span><span class="s">"addbutton-normal.png"</span><span class="p">)</span>        <span class="k">else</span> <span class="p">{</span> <span class="nf">fatalError</span><span class="p">(</span><span class="s">"图片加载失败"</span><span class="p">)</span> <span class="p">}</span>
<span class="k">guard</span> <span class="k">let</span> <span class="nv">starItemLightedImage</span>          <span class="o">=</span>  <span class="kt">UIImage</span><span class="p">(</span><span class="nv">named</span><span class="p">:</span><span class="s">"addbutton-highlighted.png"</span><span class="p">)</span>   <span class="k">else</span> <span class="p">{</span> <span class="nf">fatalError</span><span class="p">(</span><span class="s">"图片加载失败"</span><span class="p">)</span> <span class="p">}</span>
<span class="k">guard</span> <span class="k">let</span> <span class="nv">starItemContentImage</span>          <span class="o">=</span>  <span class="kt">UIImage</span><span class="p">(</span><span class="nv">named</span><span class="p">:</span><span class="s">"plus-normal.png"</span><span class="p">)</span>             <span class="k">else</span> <span class="p">{</span> <span class="nf">fatalError</span><span class="p">(</span><span class="s">"图片加载失败"</span><span class="p">)</span> <span class="p">}</span>
<span class="k">guard</span> <span class="k">let</span> <span class="nv">starItemContentLightedImage</span>   <span class="o">=</span>  <span class="kt">UIImage</span><span class="p">(</span><span class="nv">named</span><span class="p">:</span><span class="s">"plus-highlighted.png"</span><span class="p">)</span>        <span class="k">else</span> <span class="p">{</span> <span class="nf">fatalError</span><span class="p">(</span><span class="s">"图片加载失败"</span><span class="p">)</span> <span class="p">}</span>

<span class="k">var</span> <span class="nv">menus</span> <span class="o">=</span> <span class="p">[</span><span class="kt">SDiffuseMenuItem</span><span class="p">]()</span>

<span class="k">for</span> <span class="n">_</span> <span class="k">in</span> <span class="mi">0</span> <span class="o">..&lt;</span> <span class="mi">6</span> <span class="p">{</span>
    <span class="k">let</span> <span class="nv">starMenuItem</span> <span class="o">=</span>  <span class="kt">SDiffuseMenuItem</span><span class="p">(</span><span class="nv">image</span><span class="p">:</span> <span class="n">storyMenuItemImage</span><span class="p">,</span>
                                         <span class="nv">highlightedImage</span><span class="p">:</span> <span class="n">storyMenuItemImagePressed</span><span class="p">,</span> 
                                         <span class="nv">contentImage</span><span class="p">:</span> <span class="n">starImage</span><span class="p">,</span>
                                         <span class="nv">highlightedContentImage</span><span class="p">:</span> <span class="kc">nil</span><span class="p">)</span>
    <span class="n">menus</span><span class="o">.</span><span class="nf">append</span><span class="p">(</span><span class="n">starMenuItem</span><span class="p">)</span>
<span class="p">}</span>
</code></pre>
</div>

<h4 id="section-3">3、设置菜单按钮</h4>

<div class="language-swift highlighter-rouge"><pre class="highlight"><code><span class="k">let</span> <span class="nv">startItem</span> <span class="o">=</span> <span class="kt">SDiffuseMenuItem</span><span class="p">(</span><span class="nv">image</span><span class="p">:</span> <span class="n">starItemNormalImage</span><span class="p">,</span>
                                 <span class="nv">highlightedImage</span><span class="p">:</span> <span class="n">starItemLightedImage</span><span class="p">,</span>
                                 <span class="nv">contentImage</span><span class="p">:</span> <span class="n">starItemContentImage</span><span class="p">,</span>
                                 <span class="nv">highlightedContentImage</span><span class="p">:</span> <span class="n">starItemContentLightedImage</span><span class="p">)</span>
</code></pre>
</div>

<h4 id="sdiffusemenu">4、添加 SDiffuseMenu</h4>

<div class="language-swift highlighter-rouge"><pre class="highlight"><code><span class="k">let</span> <span class="nv">menuRect</span>  <span class="o">=</span> <span class="kt">CGRect</span><span class="o">.</span><span class="nf">init</span><span class="p">(</span><span class="nv">x</span><span class="p">:</span> <span class="k">self</span><span class="o">.</span><span class="n">menuView</span><span class="o">.</span><span class="n">bounds</span><span class="o">.</span><span class="n">size</span><span class="o">.</span><span class="n">width</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span>
                           <span class="nv">y</span><span class="p">:</span> <span class="k">self</span><span class="o">.</span><span class="n">menuView</span><span class="o">.</span><span class="n">bounds</span><span class="o">.</span><span class="n">size</span><span class="o">.</span><span class="n">width</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span>
                           <span class="nv">width</span><span class="p">:</span> <span class="k">self</span><span class="o">.</span><span class="n">menuView</span><span class="o">.</span><span class="n">bounds</span><span class="o">.</span><span class="n">size</span><span class="o">.</span><span class="n">width</span><span class="p">,</span>
                           <span class="nv">height</span><span class="p">:</span> <span class="k">self</span><span class="o">.</span><span class="n">menuView</span><span class="o">.</span><span class="n">bounds</span><span class="o">.</span><span class="n">size</span><span class="o">.</span><span class="n">width</span><span class="p">)</span>
<span class="n">menu</span>          <span class="o">=</span>  <span class="kt">SDiffuseMenu</span><span class="p">(</span><span class="nv">frame</span><span class="p">:</span> <span class="n">menuRect</span><span class="p">,</span>
                          <span class="nv">startItem</span><span class="p">:</span> <span class="n">startItem</span><span class="p">,</span>
                         <span class="nv">menusArray</span><span class="p">:</span> <span class="n">menus</span> <span class="k">as</span> <span class="kt">NSArray</span><span class="p">,</span>
                          <span class="nv">grapyType</span><span class="p">:</span> <span class="kt">SDiffuseMenu</span><span class="o">.</span><span class="kt">SDiffuseMenuGrapyType</span><span class="o">.</span><span class="n">arc</span><span class="p">)</span>
<span class="n">menu</span><span class="o">.</span><span class="n">center</span>   <span class="o">=</span> <span class="k">self</span><span class="o">.</span><span class="n">menuView</span><span class="o">.</span><span class="n">center</span>
<span class="n">menu</span><span class="o">.</span><span class="n">delegate</span> <span class="o">=</span> <span class="k">self</span>
<span class="k">self</span><span class="o">.</span><span class="n">menuView</span><span class="o">.</span><span class="nf">addSubview</span><span class="p">(</span><span class="n">menu</span><span class="p">)</span>
</code></pre>
</div>

<h4 id="section-4">5、动画配置</h4>

<ul>
  <li>如果配置弧线形动画,则动画中弧线半径变化为:0–&gt; 最大 farRadius–&gt; 最小 nearRadius–&gt; 结束 endRadius</li>
  <li>如果配置直线形动画,则动画中半径就是直线段的长度,变化为:0–&gt; 最大 farRadius–&gt; 最小 nearRadius–&gt;结束 endRadius</li>
</ul>

<div class="language-swift highlighter-rouge"><pre class="highlight"><code><span class="c1">// 动画时长</span>
<span class="n">menu</span><span class="o">.</span><span class="n">animationDuration</span>  <span class="o">=</span> <span class="kt">CFTimeInterval</span><span class="p">(</span><span class="n">animationDrationValue</span><span class="o">.</span><span class="n">text</span><span class="o">!</span><span class="p">)</span>
<span class="c1">// 最小半径</span>
<span class="n">menu</span><span class="o">.</span><span class="n">nearRadius</span>         <span class="o">=</span> <span class="kt">CGFloat</span><span class="p">((</span><span class="n">nearRadiusValue</span><span class="o">.</span><span class="n">text</span><span class="o">!</span> <span class="k">as</span> <span class="kt">NSString</span><span class="p">)</span><span class="o">.</span><span class="n">floatValue</span><span class="p">)</span>
<span class="c1">// 结束半径</span>
<span class="n">menu</span><span class="o">.</span><span class="n">endRadius</span>          <span class="o">=</span> <span class="kt">CGFloat</span><span class="p">((</span><span class="n">endRadiusValue</span><span class="o">.</span><span class="n">text</span><span class="o">!</span> <span class="k">as</span> <span class="kt">NSString</span><span class="p">)</span><span class="o">.</span><span class="n">floatValue</span><span class="p">)</span>
<span class="c1">// 最大半径</span>
<span class="n">menu</span><span class="o">.</span><span class="n">farRadius</span>          <span class="o">=</span> <span class="kt">CGFloat</span><span class="p">((</span><span class="n">farRadiusValue</span><span class="o">.</span><span class="n">text</span><span class="o">!</span> <span class="k">as</span> <span class="kt">NSString</span><span class="p">)</span><span class="o">.</span><span class="n">floatValue</span><span class="p">)</span>
<span class="c1">// 单个动画间隔时间</span>
<span class="n">menu</span><span class="o">.</span><span class="n">timeOffset</span>         <span class="o">=</span> <span class="kt">CFTimeInterval</span><span class="p">(</span><span class="n">timeOffSetValue</span><span class="o">.</span><span class="n">text</span><span class="o">!</span><span class="p">)</span><span class="o">!</span>
<span class="c1">// 整体角度</span>
<span class="n">menu</span><span class="o">.</span><span class="n">menuWholeAngle</span>     <span class="o">=</span> <span class="kt">CGFloat</span><span class="p">((</span><span class="n">menuWholeAngleValue</span><span class="o">.</span><span class="n">text</span><span class="o">!</span> <span class="k">as</span> <span class="kt">NSString</span><span class="p">)</span><span class="o">.</span><span class="n">floatValue</span><span class="p">)</span>
<span class="c1">// 整体偏移角度</span>
<span class="n">menu</span><span class="o">.</span><span class="n">rotateAngle</span>        <span class="o">=</span> <span class="kt">CGFloat</span><span class="p">((</span><span class="n">rotateAngleValue</span><span class="o">.</span><span class="n">text</span><span class="o">!</span> <span class="k">as</span> <span class="kt">NSString</span><span class="p">)</span><span class="o">.</span><span class="n">floatValue</span><span class="p">)</span>
<span class="c1">// 展开时自旋角度</span>
<span class="n">menu</span><span class="o">.</span><span class="n">expandRotation</span>     <span class="o">=</span> <span class="kt">CGFloat</span><span class="p">(</span><span class="kt">M_PI</span><span class="p">)</span>
<span class="c1">// 结束时自旋角度</span>
<span class="n">menu</span><span class="o">.</span><span class="n">closeRotation</span>      <span class="o">=</span> <span class="kt">CGFloat</span><span class="p">(</span><span class="kt">M_PI</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)</span>
<span class="c1">// 是否旋转菜单按钮</span>
<span class="n">menu</span><span class="o">.</span><span class="n">rotateAddButton</span>    <span class="o">=</span> <span class="n">rotateAddButton</span><span class="o">.</span><span class="n">isOn</span>
<span class="c1">// 菜单按钮旋转角度</span>
<span class="n">menu</span><span class="o">.</span><span class="n">rotateAddButtonAngle</span> <span class="o">=</span> <span class="kt">CGFloat</span><span class="p">((</span><span class="n">rotateAddButtonAngleValue</span><span class="o">.</span><span class="n">text</span><span class="o">!</span> <span class="k">as</span> <span class="kt">NSString</span><span class="p">)</span><span class="o">.</span><span class="n">floatValue</span><span class="p">)</span>
<span class="c1">// 菜单展示的形状:直线 or 弧形</span>
<span class="n">menu</span><span class="o">.</span><span class="n">sDiffuseMenuGrapyType</span> <span class="o">=</span> <span class="n">isLineGrapyType</span><span class="o">.</span><span class="n">isOn</span> <span class="o">==</span> <span class="kc">true</span> <span class="p">?</span> <span class="o">.</span><span class="nv">line</span> <span class="p">:</span> <span class="o">.</span><span class="n">arc</span>

<span class="c1">// 为方便使用,V1.1.0版本已枚举常见方位,可直接使用,无需再次设置 rotateAngle &amp;&amp; menuWholeAngle</span>
<span class="c1">// 若对于 rotateAngle\menuWholeAngle 不熟悉,建议查看 source 目录下的配置图片</span>
<span class="n">menu</span><span class="o">.</span><span class="n">sDiffuseMenuDirection</span> <span class="o">=</span> <span class="o">.</span><span class="n">above</span> <span class="c1">// 上方180°</span>
<span class="c1">//        menu.sDiffuseMenuDirection = .left // 左方180°</span>
<span class="c1">//        menu.sDiffuseMenuDirection = .below // 下方180°</span>
<span class="c1">//        menu.sDiffuseMenuDirection = .right // 右方180°</span>
<span class="c1">//        menu.sDiffuseMenuDirection = .upperRight // 右上方90°</span>
<span class="c1">//        menu.sDiffuseMenuDirection = .lowerRight // 右下方90°</span>
<span class="c1">//        menu.sDiffuseMenuDirection = .upperLeft // 左上方90°</span>
<span class="c1">//        menu.sDiffuseMenuDirection = .lowerLeft // 左下方90°</span>
</code></pre>
</div>

<h4 id="section-5">6、动画过程监听</h4>

<div class="language-swift highlighter-rouge"><pre class="highlight"><code><span class="kd">func</span> <span class="kt">SDiffuseMenuDidSelectMenuItem</span><span class="p">(</span><span class="n">_</span> <span class="nv">menu</span><span class="p">:</span> <span class="kt">SDiffuseMenu</span><span class="p">,</span> <span class="n">didSelectIndex</span> <span class="nv">index</span><span class="p">:</span> <span class="kt">Int</span><span class="p">)</span> <span class="p">{</span>
    <span class="nf">print</span><span class="p">(</span><span class="s">"选中按钮 at index:</span><span class="se">\(</span><span class="n">index</span><span class="se">)</span><span class="s"> is: </span><span class="se">\(</span><span class="n">menu</span><span class="o">.</span><span class="nf">menuItemAtIndex</span><span class="p">(</span><span class="n">index</span><span class="p">)</span><span class="se">)</span><span class="s"> "</span><span class="p">)</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="kt">SDiffuseMenuDidClose</span><span class="p">(</span><span class="n">_</span> <span class="nv">menu</span><span class="p">:</span> <span class="kt">SDiffuseMenu</span><span class="p">)</span> <span class="p">{</span>
    <span class="nf">print</span><span class="p">(</span><span class="s">"菜单关闭动画结束"</span><span class="p">)</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="kt">SDiffuseMenuDidOpen</span><span class="p">(</span><span class="n">_</span> <span class="nv">menu</span><span class="p">:</span> <span class="kt">SDiffuseMenu</span><span class="p">)</span> <span class="p">{</span>
    <span class="nf">print</span><span class="p">(</span><span class="s">"菜单展开动画结束"</span><span class="p">)</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="kt">SDiffuseMenuWillOpen</span><span class="p">(</span><span class="n">_</span> <span class="nv">menu</span><span class="p">:</span> <span class="kt">SDiffuseMenu</span><span class="p">)</span> <span class="p">{</span>
    <span class="nf">print</span><span class="p">(</span><span class="s">"菜单将要展开"</span><span class="p">)</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="kt">SDiffuseMenuWillClose</span><span class="p">(</span><span class="n">_</span> <span class="nv">menu</span><span class="p">:</span> <span class="kt">SDiffuseMenu</span><span class="p">)</span> <span class="p">{</span>
    <span class="nf">print</span><span class="p">(</span><span class="s">"菜单将要关闭"</span><span class="p">)</span>
<span class="p">}</span>
</code></pre>
</div>

<h2 id="swift">二、Swift转写之旅</h2>

<p>总的来说,动画的原理还是比较简单的,主要涉及到的知识点是 CABasicAnimation、CAKeyframeAnimation 以及事件响应链相关知识,下边分两部分介绍</p>

<h3 id="capropertyanimation">1、CAPropertyAnimation动画</h3>

<p><img src="https://developer.apple.com/library/content/documentation/Cocoa/Conceptual/Animation_Types_Timing/Art/animations_info_2x.png" alt="" /></p>

<p>在 SDiffuseMenu 中动画用 CAPropertyAnimation 的子类 CABasicAnimation 和 CAKeyframeAnimation 来实现,关于这两个子类简述如下:</p>

<ul>
  <li>CABasicAnimation 其实可以看作是一种特殊的关键帧动画,只有头尾两个关键帧,可实现移动、旋转、缩放等基本动画;</li>
  <li>CAKeyframeAnimation 则可以支持任意多个关键帧,关键帧有两种方式来指定,使用path或values;</li>
  <li>
    <ul>
      <li>path 可以是 CGPathRef、CGMutablePathRef 或者贝塞尔曲线,注意的是:设置了 path 之后 values 就无效了;values 则相对灵活, 可以指定任意关键帧帧值;</li>
    </ul>
  </li>
  <li>
    <ul>
      <li>keyTimes 可以为 values 中的关键帧设置一一对应对应的时间点,其取值范围为0到1.0,keyTimes 没有设置的时候,各个关键帧的时间是平分的;</li>
    </ul>
  </li>
  <li>
    <ul>
      <li>..</li>
    </ul>
  </li>
</ul>

<blockquote>
  <p>更多的动画知识请戳此处 <a href="https://developer.apple.com/library/content/documentation/Cocoa/Conceptual/CoreAnimation_guide/Introduction/Introduction.html#//apple_ref/doc/uid/TP40004514">CoreAnimation_guide</a></p>
  <blockquote>

    <p>相关的指南、示例代码可以通过点击页面右上角搜索按钮进行搜索,官方文档大多点到为止,挺适合入门学习的,更深的还需要在实践中摸索总结</p>
  </blockquote>
</blockquote>

<h3 id="section-6">2、动画分析</h3>

<p>在 V1.1.0 版本中,已扩展动画的形状:新加入直线型,其原理及计算方法同弧线形,下文不做过多介绍,详情参见版本记录</p>

<p>不论多么复杂的动画,都是由简单的动画组成的,大家先看下 SDiffuseMenu 中单选项动画：</p>

<p><img src="https://raw.githubusercontent.com/mythkiven/DiffuseMenu_Swift/master/Source/singleItemAnimation.gif" alt="" /></p>

<p>仔细分析发现可以将整个动画可以拆分为三大部分:</p>

<ul>
  <li>菜单按钮的自旋转,通过 transform 属性即可实现;</li>
  <li>选项按钮的整体展开动画,实际是在定时器中依次添加单个选项按钮的动画组,控制 timeInterval 来实现动画的先后执行顺序;</li>
  <li>单个选项按钮的动画则拆分为3部分:展开动画、结束动画和点击动画,都是动画组,下边以结束动画为例,简单介绍其实现过程</li>
</ul>

<h4 id="section-7">2.1、单个选项关闭动画分析：</h4>

<p>单选项按钮关闭动画过程如下:</p>

<p><img src="https://ooo.0o0.ooo/2017/01/20/58817b4e6ba40.png" alt="" /></p>

<p><strong>1、自旋</strong></p>

<p>大家仔细看会发现展开动画和结束动画的自旋转是有差异的,因为关键帧设置的不同</p>

<p>展开动画中设置的关键帧如下,0.1对应展开角度0°,0.3对应 expandRotation 自旋角度,0.4对应0°,所以在0.3 -&gt; 0.4的时间会出现较快速的自旋</p>

<div class="language-swift highlighter-rouge"><pre class="highlight"><code><span class="n">rotateAnimation</span><span class="o">.</span><span class="n">values</span>   <span class="o">=</span> <span class="p">[</span><span class="kt">CGFloat</span><span class="p">(</span><span class="mf">0.0</span><span class="p">),</span>
                           <span class="kt">CGFloat</span><span class="p">(</span><span class="n">expandRotation</span><span class="p">),</span>
                           <span class="kt">CGFloat</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)]</span>

<span class="n">rotateAnimation</span><span class="o">.</span><span class="n">keyTimes</span> <span class="o">=</span> <span class="p">[</span><span class="kt">NSNumber</span><span class="p">(</span><span class="nv">value</span><span class="p">:</span> <span class="mf">0.1</span> <span class="k">as</span> <span class="kt">Float</span><span class="p">),</span>
                           <span class="kt">NSNumber</span><span class="p">(</span><span class="nv">value</span><span class="p">:</span> <span class="mf">0.3</span> <span class="k">as</span> <span class="kt">Float</span><span class="p">),</span>
                           <span class="kt">NSNumber</span><span class="p">(</span><span class="nv">value</span><span class="p">:</span> <span class="mf">0.4</span> <span class="k">as</span> <span class="kt">Float</span><span class="p">)]</span>
</code></pre>
</div>

<p>而关闭的动画中,设置为0 -&gt; 0.4 慢速自旋,0.4 -&gt; 0.5 快速自旋</p>

<div class="language-swift highlighter-rouge"><pre class="highlight"><code><span class="n">rotateAnimation</span><span class="o">.</span><span class="n">values</span>   <span class="o">=</span> <span class="p">[</span><span class="kt">CGFloat</span><span class="p">(</span><span class="mf">0.0</span><span class="p">),</span>
                           <span class="kt">CGFloat</span><span class="p">(</span><span class="n">closeRotation</span><span class="p">),</span>
                           <span class="kt">CGFloat</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)]</span>

<span class="n">rotateAnimation</span><span class="o">.</span><span class="n">keyTimes</span> <span class="o">=</span> <span class="p">[</span><span class="kt">NSNumber</span><span class="p">(</span><span class="nv">value</span><span class="p">:</span> <span class="mf">0.0</span> <span class="k">as</span> <span class="kt">Float</span><span class="p">),</span>
                           <span class="kt">NSNumber</span><span class="p">(</span><span class="nv">value</span><span class="p">:</span> <span class="mf">0.4</span> <span class="k">as</span> <span class="kt">Float</span><span class="p">),</span>
                           <span class="kt">NSNumber</span><span class="p">(</span><span class="nv">value</span><span class="p">:</span> <span class="mf">0.5</span> <span class="k">as</span> <span class="kt">Float</span><span class="p">)]</span>
</code></pre>
</div>

<p><strong>2、移动</strong></p>

<p>移动的控制在于 path 是怎样设定的,代码中我写了两种方法,其中一种被注释掉</p>

<div class="language-swift highlighter-rouge"><pre class="highlight"><code><span class="k">let</span> <span class="nv">positionAnimation</span>      <span class="o">=</span>  <span class="kt">CAKeyframeAnimation</span><span class="p">(</span><span class="nv">keyPath</span><span class="p">:</span> <span class="s">"position"</span><span class="p">)</span>
<span class="n">positionAnimation</span><span class="o">.</span><span class="n">duration</span> <span class="o">=</span> <span class="n">animationDuration</span>
</code></pre>
</div>

<p>1)\使用贝塞尔曲线作为 path,从代码中可以明显的看出移动的路径: endPoint -&gt; farPoint -&gt; startPoint</p>

<div class="language-swift highlighter-rouge"><pre class="highlight"><code><span class="k">let</span> <span class="nv">path</span> <span class="o">=</span> <span class="kt">UIBezierPath</span><span class="o">.</span><span class="nf">init</span><span class="p">()</span>
<span class="n">path</span><span class="o">.</span><span class="nf">move</span><span class="p">(</span><span class="nv">to</span><span class="p">:</span> <span class="kt">CGPoint</span><span class="p">(</span><span class="nv">x</span><span class="p">:</span> <span class="n">item</span><span class="o">.</span><span class="n">endPoint</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="nv">y</span><span class="p">:</span> <span class="n">item</span><span class="o">.</span><span class="n">endPoint</span><span class="o">.</span><span class="n">y</span><span class="p">))</span>
<span class="n">path</span><span class="o">.</span><span class="nf">addLine</span><span class="p">(</span><span class="nv">to</span><span class="p">:</span> <span class="kt">CGPoint</span><span class="p">(</span><span class="nv">x</span><span class="p">:</span> <span class="n">item</span><span class="o">.</span><span class="n">farPoint</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="nv">y</span><span class="p">:</span> <span class="n">item</span><span class="o">.</span><span class="n">farPoint</span><span class="o">.</span><span class="n">y</span><span class="p">))</span>
<span class="n">path</span><span class="o">.</span><span class="nf">addLine</span><span class="p">(</span><span class="nv">to</span><span class="p">:</span> <span class="kt">CGPoint</span><span class="p">(</span><span class="nv">x</span><span class="p">:</span> <span class="n">item</span><span class="o">.</span><span class="n">startPoint</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="nv">y</span><span class="p">:</span> <span class="n">item</span><span class="o">.</span><span class="n">startPoint</span><span class="o">.</span><span class="n">y</span><span class="p">))</span>
<span class="n">positionAnimation</span><span class="o">.</span><span class="n">path</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">cgPath</span>
</code></pre>
</div>

<p>2)\使用 CGPathRef 或 GCMutablePathRef 设置路径</p>

<div class="language-swift highlighter-rouge"><pre class="highlight"><code><span class="k">let</span> <span class="nv">path</span> <span class="o">=</span>  <span class="kt">CGMutablePath</span><span class="p">()</span>
<span class="n">path</span><span class="o">.</span><span class="nf">move</span><span class="p">(</span><span class="nv">to</span><span class="p">:</span> <span class="kt">CGPoint</span><span class="p">(</span><span class="nv">x</span><span class="p">:</span> <span class="n">item</span><span class="o">.</span><span class="n">endPoint</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="nv">y</span><span class="p">:</span> <span class="n">item</span><span class="o">.</span><span class="n">endPoint</span><span class="o">.</span><span class="n">y</span><span class="p">))</span>
<span class="n">path</span><span class="o">.</span><span class="nf">addLine</span><span class="p">(</span><span class="nv">to</span><span class="p">:</span> <span class="kt">CGPoint</span><span class="p">(</span><span class="nv">x</span><span class="p">:</span> <span class="n">item</span><span class="o">.</span><span class="n">farPoint</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="nv">y</span><span class="p">:</span> <span class="n">item</span><span class="o">.</span><span class="n">farPoint</span><span class="o">.</span><span class="n">y</span><span class="p">))</span>
<span class="n">path</span><span class="o">.</span><span class="nf">addLine</span><span class="p">(</span><span class="nv">to</span><span class="p">:</span> <span class="kt">CGPoint</span><span class="p">(</span><span class="nv">x</span><span class="p">:</span> <span class="n">item</span><span class="o">.</span><span class="n">startPoint</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="nv">y</span><span class="p">:</span> <span class="n">item</span><span class="o">.</span><span class="n">startPoint</span><span class="o">.</span><span class="n">y</span><span class="p">))</span>
<span class="n">positionAnimation</span><span class="o">.</span><span class="n">path</span> <span class="o">=</span> <span class="n">path</span>
</code></pre>
</div>

<p>自旋和平移都有了,接下来要加入到动画组中：</p>

<div class="language-swift highlighter-rouge"><pre class="highlight"><code><span class="k">let</span> <span class="nv">animationgroup</span>              <span class="o">=</span>  <span class="kt">CAAnimationGroup</span><span class="p">()</span>
<span class="n">animationgroup</span><span class="o">.</span><span class="n">animations</span>       <span class="o">=</span> <span class="p">[</span><span class="n">positionAnimation</span><span class="p">,</span> <span class="n">rotateAnimation</span><span class="p">]</span>
<span class="n">animationgroup</span><span class="o">.</span><span class="n">duration</span>         <span class="o">=</span> <span class="n">animationDuration</span>
<span class="c1">// 动画结束后,layer保持最终的状态</span>
<span class="n">animationgroup</span><span class="o">.</span><span class="n">fillMode</span>         <span class="o">=</span> <span class="n">kCAFillModeForwards</span>
<span class="c1">// 速度控制我设置的如此,大家根据需要自行修改即可</span>
<span class="n">animationgroup</span><span class="o">.</span><span class="n">timingFunction</span>   <span class="o">=</span> <span class="kt">CAMediaTimingFunction</span><span class="p">(</span><span class="nv">name</span><span class="p">:</span><span class="n">kCAMediaTimingFunctionEaseIn</span><span class="p">)</span>
<span class="c1">// 代理是为了获取到动画结束的信号</span>
<span class="n">animationgroup</span><span class="o">.</span><span class="n">delegate</span>         <span class="o">=</span> <span class="k">self</span>
</code></pre>
</div>

<p>最添加进 layer 即可</p>
<div class="language-swift highlighter-rouge"><pre class="highlight"><code><span class="n">item</span><span class="o">.</span><span class="n">layer</span><span class="o">.</span><span class="nf">add</span><span class="p">(</span><span class="n">animationgroup</span><span class="p">,</span><span class="nv">forKey</span><span class="p">:</span> <span class="s">"Close"</span><span class="p">)</span>
</code></pre>
</div>
<p>其余的动画原理和上述的关闭动画其实是一样的,基于属性的动画,通过操作帧来实现我们想要的效果,小伙伴们直接看代码吧~</p>

<h4 id="section-8">2.2、整体动画的控制</h4>

<p>注意,整体动画的控制以上并未表述,在这个地方也需要注意下,为了让整体动画在一个合适的角度展示出来,就需要从整体上控制角度</p>

<p><img src="https://ooo.0o0.ooo/2017/01/16/587c8c512c911.png" alt="" />
<img src="https://ooo.0o0.ooo/2017/01/16/587c8c7530072.png" alt="" />
<img src="https://ooo.0o0.ooo/2017/01/16/587c8c8635998.png" alt="" /></p>

<p>从上图中可以看出,整体的角度是由 menuWholeAngle 和 rotateAngle 共同控制的</p>

<ul>
  <li>menuWholeAngle: 控制整体动画的范围角度;</li>
  <li>rotateAngle: 用于控制整体的偏移角度</li>
</ul>


                </div>
                <div class="read-all">
                    <a  href="/2017/01/08/SDiffuseMenu/"><i class="fa fa-newspaper-o"></i>Read All</a>
                </div>
                <hr>
              </li>
            
              <li>
                <h2>
                  <a class="post-link" href="/2016/12/11/swift_X_Initialization_Deinitialization/">Swift3.0_X_构造过程和析构过程 </a>
                </h2>
                <div class="label">
                    <div class="label-card">
                        <i class="fa fa-calendar"></i>2016-12-11
                    </div>
                    <div class="label-card">
                        <i class="fa fa-user"></i>3行代码
                        
                    </div>
                    <div class="label-card">
                        
                    </div>

                    <div class="label-card">
                    


<!-- <span class="point">•</span> -->
<span class="categories">
  <i class="fa fa-th-list"></i>
  
    
        <a href="/category/#Swift3.0" title="Category: Swift3.0" rel="category">Swift3.0</a>
    
  

  <!-- <span class="point">•</span> -->
</span>


                    </div>

                    <div class="label-card">
                    
<!-- <span class="point">•</span> -->
<span class="pageTag">
  <i class="fa fa-tags"></i>
  
    
        <a href="/tag/#Swift3.0" title="Tag: Swift3.0" rel="tag">Swift3.0</a>
    
  

</span>

                    </div>
                </div>
                <div class="excerpt">
                    <ul id="markdown-toc">
  <li><a href="#section" id="markdown-toc-section">构造过程</a>    <ul>
      <li><a href="#section-1" id="markdown-toc-section-1">存储属性的初始赋值</a></li>
      <li><a href="#section-2" id="markdown-toc-section-2">自定义构造过程</a></li>
      <li><a href="#section-3" id="markdown-toc-section-3">默认构造器</a></li>
    </ul>
  </li>
</ul>

<h1 id="section">构造过程</h1>

<ul>
  <li>构造过程是使用类、结构体或枚举类型的实例之前的准备过程；</li>
  <li>通过定义构造器来实现构造过程，这些构造器可以看做是用来创建特定类型新实例的特殊方法；</li>
  <li>与OC中的构造器不同，Swift的构造器无需返回值，它们的主要任务是保证新实例在第一次使用前完成正确的初始化；</li>
  <li>类的实例也可以通过定义析构器在实例释放之前执行特定的清除工作</li>
</ul>

<h3 id="section-1">存储属性的初始赋值</h3>

<ul>
  <li>类和结构体在创建实例时，必须为所有存储型属性设置合适的初始值；</li>
  <li>可以在构造器中为存储型属性赋初值，也可以在定义属性时为其设置默认值；</li>
  <li>当为存储型属性设置默认值或者在构造器中为其赋值时，它们的值是被直接设置的，不会触发任何属性观察者</li>
</ul>

<p>1、构造器</p>

<p>以关键字init命名：</p>
<div class="language-swift highlighter-rouge"><pre class="highlight"><code><span class="nf">init</span><span class="p">()</span> <span class="p">{</span>
    <span class="c1">// 在此处执行构造过程</span>
<span class="p">}</span>
</code></pre>
</div>

<p>案例：</p>

<p>这个结构体定义了一个不带参数的构造器init，并在里面将存储型属性temperature的值初始化为32.0</p>
<div class="language-swift highlighter-rouge"><pre class="highlight"><code><span class="c1">// 保存华氏温度的结构体Fahrenheit</span>
<span class="kd">struct</span> <span class="kt">Fahrenheit</span> <span class="p">{</span>
    <span class="k">var</span> <span class="nv">temperature</span><span class="p">:</span> <span class="kt">Double</span>
    <span class="nf">init</span><span class="p">()</span> <span class="p">{</span>
        <span class="n">temperature</span> <span class="o">=</span> <span class="mf">32.0</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="k">var</span> <span class="nv">f</span> <span class="o">=</span> <span class="kt">Fahrenheit</span><span class="p">()</span>
<span class="nf">print</span><span class="p">(</span><span class="s">"The default temperature is </span><span class="se">\(</span><span class="n">f</span><span class="o">.</span><span class="n">temperature</span><span class="se">)</span><span class="s">° Fahrenheit"</span><span class="p">)</span>
<span class="c1">// 打印 "The default temperature is 32.0° Fahrenheit”</span>
</code></pre>
</div>

<p>2、默认属性值</p>

<p>如前所述，可以在构造器中为存储型属性设置初始值。同样，也可以在属性声明时为其设置默认值</p>

<p>注意：如果一个属性总是使用相同的初始值，那么为其设置一个默认值比每次都在构造器中赋值要好。两种方法的效果是一样的，只不过使用默认值让属性的初始化和声明结合得更紧密。使用默认值能让构造器更简洁、更清晰，且能通过默认值自动推导出属性的类型；同时，它也能充分利用默认构造器、构造器继承等特性，后续章节将讲到。</p>
<div class="language-swift highlighter-rouge"><pre class="highlight"><code><span class="c1">// 可以使用更简单的方式在定义结构体Fahrenheit时为属性temperature设置默认值：</span>
<span class="kd">struct</span> <span class="kt">Fahrenheit</span> <span class="p">{</span>
    <span class="k">var</span> <span class="nv">temperature</span> <span class="o">=</span> <span class="mf">32.0</span>
<span class="p">}</span>
</code></pre>
</div>

<h3 id="section-2">自定义构造过程</h3>

<p>可以通过输入参数和可选类型的属性来自定义构造过程，也可以在构造过程中修改常量属性。</p>

<p>1、构造参数：</p>

<p>自定义构造过程时，可以在定义中提供构造参数，指定所需值的类型和名字。</p>

<div class="language-swift highlighter-rouge"><pre class="highlight"><code><span class="c1">// 面例子中定义了一个包含摄氏度温度的结构体Celsius。它定义了两个不同的构造器：init(fromFahrenheit:)和init(fromKelvin:)，二者分别通过接受不同温标下的温度值来创建新的实例：</span>

<span class="kd">struct</span> <span class="kt">Celsius</span> <span class="p">{</span>
    <span class="k">var</span> <span class="nv">temperatureInCelsius</span><span class="p">:</span> <span class="kt">Double</span>
    <span class="c1">// 构造参数，其外部名字为fromFahrenheit,内部名字为fahrenheit</span>
    <span class="nf">init</span><span class="p">(</span><span class="n">fromFahrenheit</span> <span class="nv">fahrenheit</span><span class="p">:</span> <span class="kt">Double</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">temperatureInCelsius</span> <span class="o">=</span> <span class="p">(</span><span class="n">fahrenheit</span> <span class="o">-</span> <span class="mf">32.0</span><span class="p">)</span> <span class="o">/</span> <span class="mf">1.8</span>
    <span class="p">}</span>
    <span class="c1">// 构造参数，其外部名字为fromKelvin，内部名字为kelvin</span>
    <span class="nf">init</span><span class="p">(</span><span class="n">fromKelvin</span> <span class="nv">kelvin</span><span class="p">:</span> <span class="kt">Double</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">temperatureInCelsius</span> <span class="o">=</span> <span class="n">kelvin</span> <span class="o">-</span> <span class="mf">273.15</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="k">let</span> <span class="nv">boilingPointOfWater</span> <span class="o">=</span> <span class="kt">Celsius</span><span class="p">(</span><span class="nv">fromFahrenheit</span><span class="p">:</span> <span class="mf">212.0</span><span class="p">)</span>
<span class="c1">// boilingPointOfWater.temperatureInCelsius 是 100.0</span>
<span class="k">let</span> <span class="nv">freezingPointOfWater</span> <span class="o">=</span> <span class="kt">Celsius</span><span class="p">(</span><span class="nv">fromKelvin</span><span class="p">:</span> <span class="mf">273.15</span><span class="p">)</span>
<span class="c1">// freezingPointOfWater.temperatureInCelsius 是 0.0</span>
</code></pre>
</div>

<p>2、参数的内部名称和外部名称：</p>

<p>跟函数和方法参数相同，构造参数也拥有一个在构造器内部使用的参数名字和一个在调用构造器时使用的外部参数名字。</p>

<p>当中有多个构造器时，需要通过外部名称来识别不同的构造器：在调用构造器时，主要通过构造器中的参数名和类型来确定应该被调用的构造器。正因为参数如此重要，如果你在定义构造器时没有提供参数的外部名字，Swift 会为构造器的每个参数自动生成一个跟内部名字相同的外部名。</p>

<p>以下例子中定义了一个结构体Color，它包含了三个常量：red、green和blue。这些属性可以存储0.0到1.0之间的值，用来指示颜色中红、绿、蓝成分的含量。</p>
<div class="language-swift highlighter-rouge"><pre class="highlight"><code><span class="c1">// Color提供了一个构造器，其中包含三个Double类型的构造参数。Color也可以提供第二个构造器，它只包含名为white的Double类型的参数，它被用于给上述三个构造参数赋予同样的值。</span>

<span class="kd">struct</span> <span class="kt">Color</span> <span class="p">{</span>
    <span class="k">let</span> <span class="nv">red</span><span class="p">,</span> <span class="n">green</span><span class="p">,</span> <span class="nv">blue</span><span class="p">:</span> <span class="kt">Double</span>
    <span class="nf">init</span><span class="p">(</span><span class="nv">red</span><span class="p">:</span> <span class="kt">Double</span><span class="p">,</span> <span class="nv">green</span><span class="p">:</span> <span class="kt">Double</span><span class="p">,</span> <span class="nv">blue</span><span class="p">:</span> <span class="kt">Double</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">self</span><span class="o">.</span><span class="n">red</span>   <span class="o">=</span> <span class="n">red</span>
        <span class="k">self</span><span class="o">.</span><span class="n">green</span> <span class="o">=</span> <span class="n">green</span>
        <span class="k">self</span><span class="o">.</span><span class="n">blue</span>  <span class="o">=</span> <span class="n">blue</span>
    <span class="p">}</span>
    <span class="nf">init</span><span class="p">(</span><span class="nv">white</span><span class="p">:</span> <span class="kt">Double</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">red</span>   <span class="o">=</span> <span class="n">white</span>
        <span class="n">green</span> <span class="o">=</span> <span class="n">white</span>
        <span class="n">blue</span>  <span class="o">=</span> <span class="n">white</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre>
</div>

<p>两种构造器都能用于创建一个新的Color实例，你需要为构造器每个外部参数传值：</p>

<div class="language-swift highlighter-rouge"><pre class="highlight"><code><span class="k">let</span> <span class="nv">magenta</span> <span class="o">=</span> <span class="kt">Color</span><span class="p">(</span><span class="nv">red</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">,</span> <span class="nv">green</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span> <span class="nv">blue</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">)</span>
<span class="k">let</span> <span class="nv">halfGray</span> <span class="o">=</span> <span class="kt">Color</span><span class="p">(</span><span class="nv">white</span><span class="p">:</span> <span class="mf">0.5</span><span class="p">)</span>
</code></pre>
</div>
<p>注意，如果不通过外部参数名字传值，你是没法调用这个构造器的。只要构造器定义了某个外部参数名，你就必须使用它，忽略它将导致编译错误：</p>

<div class="language-swift highlighter-rouge"><pre class="highlight"><code><span class="k">let</span> <span class="nv">veryGreen</span> <span class="o">=</span> <span class="kt">Color</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span>
<span class="c1">// 报编译时错误，需要外部名称</span>
</code></pre>
</div>

<p>3、不带外部名的构造器参数：</p>

<p>如果你不希望为构造器的某个参数提供外部名字，你可以使用下划线(_)来显式描述它的外部名，以此重写上面所说的默认行为。</p>
<div class="language-swift highlighter-rouge"><pre class="highlight"><code><span class="n">下面是之前Celsius例子的扩展</span><span class="err">，</span><span class="n">跟之前相比添加了一个带有Double类型参数的构造器</span><span class="err">，</span><span class="n">其外部名用_代替</span><span class="err">：</span>

<span class="kd">struct</span> <span class="kt">Celsius</span> <span class="p">{</span>
    <span class="k">var</span> <span class="nv">temperatureInCelsius</span><span class="p">:</span> <span class="kt">Double</span>
    <span class="nf">init</span><span class="p">(</span><span class="n">fromFahrenheit</span> <span class="nv">fahrenheit</span><span class="p">:</span> <span class="kt">Double</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">temperatureInCelsius</span> <span class="o">=</span> <span class="p">(</span><span class="n">fahrenheit</span> <span class="o">-</span> <span class="mf">32.0</span><span class="p">)</span> <span class="o">/</span> <span class="mf">1.8</span>
    <span class="p">}</span>
    <span class="nf">init</span><span class="p">(</span><span class="n">fromKelvin</span> <span class="nv">kelvin</span><span class="p">:</span> <span class="kt">Double</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">temperatureInCelsius</span> <span class="o">=</span> <span class="n">kelvin</span> <span class="o">-</span> <span class="mf">273.15</span>
    <span class="p">}</span>
    <span class="nf">init</span><span class="p">(</span><span class="n">_</span> <span class="nv">celsius</span><span class="p">:</span> <span class="kt">Double</span><span class="p">){</span>
        <span class="n">temperatureInCelsius</span> <span class="o">=</span> <span class="n">celsius</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="k">let</span> <span class="nv">bodyTemperature</span> <span class="o">=</span> <span class="kt">Celsius</span><span class="p">(</span><span class="mf">37.0</span><span class="p">)</span>
<span class="c1">// bodyTemperature.temperatureInCelsius 为 37.0</span>
<span class="c1">// 调用Celsius(37.0)意图明确，不需要外部参数名称。</span>
</code></pre>
</div>

<p>4、可选属性类型</p>

<p>如果定制的类型包含一个逻辑上允许取值为空的存储型属性——无论是因为它无法在初始化时赋值，还是因为它在之后某个时间点可以赋值为空——你都需要将它定义为可选类型。可选类型的属性将自动初始化为nil，表示这个属性是有意在初始化时设置为空的。</p>

<p>下面例子中定义了类SurveyQuestion，它包含一个可选字符串属性response：</p>
<div class="language-swift highlighter-rouge"><pre class="highlight"><code><span class="kd">class</span> <span class="kt">SurveyQuestion</span> <span class="p">{</span>
    <span class="k">var</span> <span class="nv">text</span><span class="p">:</span> <span class="kt">String</span>
    <span class="k">var</span> <span class="nv">response</span><span class="p">:</span> <span class="kt">String</span><span class="p">?</span>
    <span class="nf">init</span><span class="p">(</span><span class="nv">text</span><span class="p">:</span> <span class="kt">String</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">self</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="n">text</span>
    <span class="p">}</span>
    <span class="kd">func</span> <span class="nf">ask</span><span class="p">()</span> <span class="p">{</span>
        <span class="nf">print</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="k">let</span> <span class="nv">cheeseQuestion</span> <span class="o">=</span> <span class="kt">SurveyQuestion</span><span class="p">(</span><span class="nv">text</span><span class="p">:</span> <span class="s">"Do you like cheese?"</span><span class="p">)</span>
<span class="n">cheeseQuestion</span><span class="o">.</span><span class="nf">ask</span><span class="p">()</span>
<span class="c1">// 打印 "Do you like cheese?"</span>
<span class="n">cheeseQuestion</span><span class="o">.</span><span class="n">response</span> <span class="o">=</span> <span class="s">"Yes, I do like cheese."</span>

<span class="c1">// 调查问题的答案在回答前是无法确定的，因此我们将属性response声明为String?类型，或者说是可选字符串类型。当SurveyQuestion实例化时，它将自动赋值为nil，表明此字符串暂时还没有值。</span>
</code></pre>
</div>

<p>5、构造过程中常量属性的修改</p>

<p>你可以在构造过程中的任意时间点给常量属性指定一个值，只要在构造过程结束时是一个确定的值。一旦常量属性被赋值，它将永远不可更改。</p>

<p>注意：对于类的实例来说，它的常量属性只能在定义它的类的构造过程中修改；不能在子类中修改。</p>

<h3 id="section-3">默认构造器</h3>

<p>如果结构体或类的所有属性都有默认值，同时没有自定义的构造器，那么 Swift 会给这些结构体或类提供一个默认构造器。这个默认构造器将简单地创建一个所有属性值都设置为默认值的实例。</p>

<p>案例:下面例子中创建了一个类ShoppingListItem，它封装了购物清单中的某一物品的属性：名字（name）、数量（quantity）和购买状态 purchase state：</p>
<div class="language-swift highlighter-rouge"><pre class="highlight"><code><span class="kd">class</span> <span class="kt">ShoppingListItem</span> <span class="p">{</span>
    <span class="k">var</span> <span class="nv">name</span><span class="p">:</span> <span class="kt">String</span><span class="p">?</span>
    <span class="k">var</span> <span class="nv">quantity</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="k">var</span> <span class="nv">purchased</span> <span class="o">=</span> <span class="kc">false</span>
<span class="p">}</span>
<span class="k">var</span> <span class="nv">item</span> <span class="o">=</span> <span class="kt">ShoppingListItem</span><span class="p">()</span>
</code></pre>
</div>
<p>由于ShoppingListItem类中的所有属性都有默认值，且它是没有父类的基类，它将自动获得一个可以为所有属性设置默认值的默认构造器（尽管代码中没有显式为name属性设置默认值，但由于name是可选字符串类型，它将默认设置为nil）。上面例子中使用默认构造器创造了一个ShoppingListItem类的实例（使用ShoppingListItem()形式的构造器语法），并将其赋值给变量item。</p>

<p>2、结构体的逐一成员构造器</p>

<p>除了上面提到的默认构造器，如果结构体没有提供自定义的构造器，它们将自动获得一个逐一成员构造器，即使结构体的存储型属性没有默认值。</p>

<p>逐一成员构造器是用来初始化结构体新实例里成员属性的快捷方法。我们在调用逐一成员构造器时，通过与成员属性名相同的参数名进行传值来完成对成员属性的初始赋值。</p>

<div class="language-swift highlighter-rouge"><pre class="highlight"><code><span class="c1">// 结构体Size自动获得了一个逐一成员构造器init(width:height:)。你可以用它来为Size创建新的实例：</span>

<span class="kd">struct</span> <span class="kt">Size</span> <span class="p">{</span>
    <span class="k">var</span> <span class="nv">width</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">height</span> <span class="o">=</span> <span class="mf">0.0</span>
<span class="p">}</span>
<span class="k">let</span> <span class="nv">twoByTwo</span> <span class="o">=</span> <span class="kt">Size</span><span class="p">(</span><span class="nv">width</span><span class="p">:</span> <span class="mf">2.0</span><span class="p">,</span> <span class="nv">height</span><span class="p">:</span> <span class="mf">2.0</span><span class="p">)</span>
</code></pre>
</div>


                </div>
                <div class="read-all">
                    <a  href="/2016/12/11/swift_X_Initialization_Deinitialization/"><i class="fa fa-newspaper-o"></i>Read All</a>
                </div>
                <hr>
              </li>
            
        </ul>



        <!-- Pagination links -->
        <div class="pagination">
          
            <span class="previous disable"><i class="fa fa-angle-double-left"></i></span>
            <span class="previous disable"><i class="fa fa-angle-left"></i></span>
          
          <span class="page_number ">1/7</span>
          
            <a href="/page2" class="next"><i class="fa fa-angle-right"></i></a>
            <a href="/page7" class="next"><i class="fa fa-angle-double-right"></i></a>
          
        </div>
    </div>
    <!-- <button class="anchor"><i class="fa fa-anchor"></i></button> -->
    <div class="right">
        <div class="wrap">
            <div class="side">
                <div>
                    <i class="fa fa-pencil-square-o" aria-hidden="true"></i>
                    最新文章
                </div>
                <ul class="content-ul" recent>
                    
                        <li><a href="/2017/02/08/AD-jenkins/"> 持续集成系列 - CI + Jenkins的魔法世界</a></li>
                    
                        <li><a href="/2017/02/07/AD-Fastlane/"> 持续集成系列 - Fastlane的黑魔法:自动打包编译上传 AppStore</a></li>
                    
                        <li><a href="/2017/01/23/AD-XCTest/">持续集成系列 - 测试: XCTest</a></li>
                    
                        <li><a href="/2017/01/13/Travis-CI/">持续集成系列 - Github中的魔法工具:Travis CI</a></li>
                    
                        <li><a href="/2017/01/08/SDiffuseMenu/">Swift 版 AwesomeMenu 的改写之旅:SDiffuseMenu</a></li>
                    
                        <li><a href="/2016/12/11/swift_X_Initialization_Deinitialization/">Swift3.0_X_构造过程和析构过程 </a></li>
                    
                        <li><a href="/2016/12/10/swift_IX_Methods_Subscripts_Inheritance/">Swift3.0_IX_方法、下标和继承 </a></li>
                    
                        <li><a href="/2016/12/08/swift_VIII_Enumerations_Classes_Structures_Properties/">Swift3.0_VIII_枚举、类、结构体、属性</a></li>
                    
                        <li><a href="/2016/12/07/swift_VII_Closures/">Swift3.0_VII_闭包</a></li>
                    
                        <li><a href="/2016/12/05/swift_VI_Functions/">Swift3.0_VI_函数</a></li>
                    
                </ul>
            </div>

            <!-- Content -->
            <div class="side ">
                <div>
                    <i class="fa fa-th-list"></i>
                    分类
                </div>
                <ul class="content-ul" cate>
                    
                    <li>
                        <a href="/category/#OS_X" class="categories-list-item" cate="OS_X">
                            <span class="name">
                                OS_X
                            </span>
                            <span class="badge">2</span>
                        </a>
                    </li>
                    
                    <li>
                        <a href="/category/#Objective-C" class="categories-list-item" cate="Objective-C">
                            <span class="name">
                                Objective-C
                            </span>
                            <span class="badge">5</span>
                        </a>
                    </li>
                    
                    <li>
                        <a href="/category/#Reverse" class="categories-list-item" cate="Reverse">
                            <span class="name">
                                Reverse
                            </span>
                            <span class="badge">9</span>
                        </a>
                    </li>
                    
                    <li>
                        <a href="/category/#AD" class="categories-list-item" cate="AD">
                            <span class="name">
                                AD
                            </span>
                            <span class="badge">4</span>
                        </a>
                    </li>
                    
                    <li>
                        <a href="/category/#tips" class="categories-list-item" cate="tips">
                            <span class="name">
                                tips
                            </span>
                            <span class="badge">1</span>
                        </a>
                    </li>
                    
                    <li>
                        <a href="/category/#python" class="categories-list-item" cate="python">
                            <span class="name">
                                python
                            </span>
                            <span class="badge">1</span>
                        </a>
                    </li>
                    
                    <li>
                        <a href="/category/#Swift3.0" class="categories-list-item" cate="Swift3.0">
                            <span class="name">
                                Swift3.0
                            </span>
                            <span class="badge">11</span>
                        </a>
                    </li>
                    
                    <li>
                        <a href="/category/#CI" class="categories-list-item" cate="CI">
                            <span class="name">
                                CI
                            </span>
                            <span class="badge">4</span>
                        </a>
                    </li>
                    
                </ul>
            </div>
            <!-- 其他div框放到这里 -->
            <div class="side">
                <div>
                    <i class="fa fa-tags"></i>
                    Tags
                </div>
                <div class="tags-cloud">
                    
                    
                    
                    

                    

                    
                      
                      
                      
                      
                      
                      <a href="/tag/#apache" style="font-size: 9pt; color: #999;">apache</a>
                    
                      
                      
                      
                      
                      
                      <a href="/tag/#WKWebView、Native与JS、缓存、NSURLProtocol" style="font-size: 9pt; color: #999;">WKWebView、Native与JS、缓存、NSURLProtocol</a>
                    
                      
                      
                      
                      
                      
                      <a href="/tag/#Charles" style="font-size: 9pt; color: #999;">Charles</a>
                    
                      
                      
                      
                      
                      
                      <a href="/tag/#Reveal" style="font-size: 9pt; color: #999;">Reveal</a>
                    
                      
                      
                      
                      
                      
                      <a href="/tag/#iOSOpenDev" style="font-size: 9pt; color: #999;">iOSOpenDev</a>
                    
                      
                      
                      
                      
                      
                      <a href="/tag/#block" style="font-size: 9pt; color: #999;">block</a>
                    
                      
                      
                      
                      
                      
                      <a href="/tag/#NSURLProtocol" style="font-size: 9pt; color: #999;">NSURLProtocol</a>
                    
                      
                      
                      
                      
                      
                      <a href="/tag/#缓存" style="font-size: 10pt; color: #888;">缓存</a>
                    
                      
                      
                      
                      
                      
                      <a href="/tag/#NSURLCache" style="font-size: 9pt; color: #999;">NSURLCache</a>
                    
                      
                      
                      
                      
                      
                      <a href="/tag/#SecureCRT" style="font-size: 9pt; color: #999;">SecureCRT</a>
                    
                      
                      
                      
                      
                      
                      <a href="/tag/#博客" style="font-size: 9pt; color: #999;">博客</a>
                    
                      
                      
                      
                      
                      
                      <a href="/tag/#jekyll" style="font-size: 9pt; color: #999;">jekyll</a>
                    
                      
                      
                      
                      
                      
                      <a href="/tag/#sublime" style="font-size: 9pt; color: #999;">sublime</a>
                    
                      
                      
                      
                      
                      
                      <a href="/tag/#环境变量" style="font-size: 9pt; color: #999;">环境变量</a>
                    
                      
                      
                      
                      
                      
                      <a href="/tag/#mac_tips" style="font-size: 9pt; color: #999;">mac_tips</a>
                    
                      
                      
                      
                      
                      
                      <a href="/tag/#Sublime" style="font-size: 10pt; color: #888;">Sublime</a>
                    
                      
                      
                      
                      
                      
                      <a href="/tag/#iOS逆向" style="font-size: 9pt; color: #999;">iOS逆向</a>
                    
                      
                      
                      
                      
                      
                      <a href="/tag/#class_dump" style="font-size: 9pt; color: #999;">class_dump</a>
                    
                      
                      
                      
                      
                      
                      <a href="/tag/#Theos" style="font-size: 10pt; color: #888;">Theos</a>
                    
                      
                      
                      
                      
                      
                      <a href="/tag/#Logos" style="font-size: 9pt; color: #999;">Logos</a>
                    
                      
                      
                      
                      
                      
                      <a href="/tag/#iOS基础" style="font-size: 9pt; color: #999;">iOS基础</a>
                    
                      
                      
                      
                      
                      
                      <a href="/tag/#IDA、iFunBox、dyld_decache" style="font-size: 9pt; color: #999;">IDA、iFunBox、dyld_decache</a>
                    
                      
                      
                      
                      
                      
                      <a href="/tag/#iOS逆向工具集" style="font-size: 9pt; color: #999;">iOS逆向工具集</a>
                    
                      
                      
                      
                      
                      
                      <a href="/tag/#iOS逆向理论基础" style="font-size: 9pt; color: #999;">iOS逆向理论基础</a>
                    
                      
                      
                      
                      
                      
                      <a href="/tag/#脚本" style="font-size: 9pt; color: #999;">脚本</a>
                    
                      
                      
                      
                      
                      
                      <a href="/tag/#python" style="font-size: 9pt; color: #999;">python</a>
                    
                      
                      
                      
                      
                      
                      <a href="/tag/#Swift3.0" style="font-size: 18pt; color: #000;">Swift3.0</a>
                    
                      
                      
                      
                      
                      
                      <a href="/tag/#SDiffuseMenu" style="font-size: 9pt; color: #999;">SDiffuseMenu</a>
                    
                      
                      
                      
                      
                      
                      <a href="/tag/#Animation" style="font-size: 9pt; color: #999;">Animation</a>
                    
                      
                      
                      
                      
                      
                      <a href="/tag/#Github" style="font-size: 9pt; color: #999;">Github</a>
                    
                      
                      
                      
                      
                      
                      <a href="/tag/#Travis-CI" style="font-size: 9pt; color: #999;">Travis-CI</a>
                    
                      
                      
                      
                      
                      
                      <a href="/tag/#XCTest" style="font-size: 9pt; color: #999;">XCTest</a>
                    
                      
                      
                      
                      
                      
                      <a href="/tag/#fastlane" style="font-size: 10pt; color: #888;">fastlane</a>
                    
                      
                      
                      
                      
                      
                      <a href="/tag/#CI" style="font-size: 9pt; color: #999;">CI</a>
                    
                </div>
            </div>

            <!-- <div class="side">
                <div>
                    <i class="fa fa-external-link"></i>
                    Links
                </div>
                <ul  class="content-ul">

                </ul>
            </div> -->
        </div>
    </div>
</div>
<!-- <script src="/js/scroll.min.js " charset="utf-8"></script> -->
<!-- <script src="/js/pageContent.js " charset="utf-8"></script> -->


    <footer class="site-footer">


    <div class="wrapper">

        <p class="description">
             3行代码的技术博客 
        </p>
        <p class="contact">
            Contact me at:  
            <a href="mailto:mythziven@gmail.com" title="email"><i class="fa fa-envelope-o" aria-hidden="true"></i></a>   -->
<!--            <a href="mailto:mythziven@gmail.com" title="email"><i class="fa fa-envelope-o" aria-hidden="true"></i></a>-->
<!--            <a href="mailto:mythziven@gmail.com" title="email"><i class="fa fa-envelope-o" aria-hidden="true"></i></a>        -->


        </p>
        <p>
            本站总访问量<span id="busuanzi_value_site_pv"></span>次，本站访客数<span id="busuanzi_value_site_uv"></span>人次，本文总阅读量<span id="busuanzi_value_page_pv"></span>次
        </p>
        <p class="power">
        
            <span>
                Site powered by <a href="https://jekyllrb.com/">Jekyll</a> & <a href="https://pages.github.com/">Github Pages</a>.
            </span>

          <!--   <span>
                Theme designed by <a href="https://github.com/mythkiven">MyKiven</a>.
            </span> -->

        </p>
    </div>
</footer>
<script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>

    <div class="back-to-top">
    <a href="#top" class="scroll">
        <i class="fa fa-arrow-up" aria-hidden="true"></i>
    </a>
</div>

    <script src=" /js/main.js " charset="utf-8"></script>
    <script src=" /js/scroll.min.js " charset="utf-8"></script>
  </body>

</html>
