<!DOCTYPE html>
<html>

  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <title>3行代码</title>
    <meta name="description" content="">

    <link rel="shortcut icon" href="/favicon.ico?" type="image/x-icon">
    <link rel="icon" href="/favicon.ico?" type="image/x-icon">
    <link rel="stylesheet" href="/css/fontawesome/css/font-awesome.min.css ">
    <link rel="stylesheet" href="/css/main.css ">
    <link rel="canonical" href="http://localhost:4000/page4/">
    <link rel="alternate" type="application/rss+xml" title="3行代码" href="http://localhost:4000/feed.xml ">


<script>
    // 百度统计代码
    var _hmt = _hmt || [];
    (function() {
     var hm = document.createElement("script");
     hm.src = "//hm.baidu.com/hm.js?d9432112fb859bf7276f8399641fb0c5";
     var s = document.getElementsByTagName("script")[0];
     s.parentNode.insertBefore(hm, s);
     })();
    </script>




    <script>
    // google analytics
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-85978943-1', 'auto');
      ga('send', 'pageview');

    </script>

</head>


  <body>

    <header id="top">
    <div class="wrapper">
        <a href="/" class="brand">3行代码</a>
        <small>技术博客</small>
        <button id="headerMenu" class="menu"><i class="fa fa-bars"></i></button>
        <nav id="headerNav">
            <ul>
                
                <li>
                    
                    <a href="/">
                    
                        <i class="fa fa-home"></i>Home
                    </a>
                </li>


                
                    
                    <li>
                        
                        <a href="/archive/">
                        
                            <i class="fa fa-archive"></i>Archives
                        </a>
                    </li>
                    
                
                    
                    <li>
                        
                        <a href="/category/">
                        
                            <i class="fa fa-th-list"></i>Categories
                        </a>
                    </li>
                    
                
                    
                    <li>
                        
                        <a href="/tag/">
                        
                            <i class="fa fa-tags"></i>Tags
                        </a>
                    </li>
                    
                
                    
                    <li>
                        
                        <a href="/collection/">
                        
                            <i class="fa fa-bookmark"></i>Collections
                        </a>
                    </li>
                    
                
                    
                    <li>
                        
                        <a href="/about/">
                        
                            <i class="fa fa-heart"></i>About
                        </a>
                    </li>
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
            </ul>
        </nav>
    </div>
</header>


        <div class="page clearfix" index>
    <div class="left">
        <h1>Welcome to 3code.info!</h1>
        <small>记录生活</small>
        <hr>
        <ul>
            
              <li>
                <h2>
                  <a class="post-link" href="/2016/11/06/5_IDA-iFunBox-other/">iOS逆向系列5_IDA/iFunBox/other</a>
                </h2>
                <div class="label">
                    <div class="label-card">
                        <i class="fa fa-calendar"></i>2016-11-06
                    </div>
                    <div class="label-card">
                        <i class="fa fa-user"></i>3行代码
                        
                    </div>
                    <div class="label-card">
                        
                    </div>

                    <div class="label-card">
                    


<!-- <span class="point">•</span> -->
<span class="categories">
  <i class="fa fa-th-list"></i>
  
    
        <a href="/category/#Reverse" title="Category: Reverse" rel="category">Reverse</a>
    
  

  <!-- <span class="point">•</span> -->
</span>


                    </div>

                    <div class="label-card">
                    
<!-- <span class="point">•</span> -->
<span class="pageTag">
  <i class="fa fa-tags"></i>
  
    
        <a href="/tag/#IDA、iFunBox、dyld_decache" title="Tag: IDA、iFunBox、dyld_decache" rel="tag">IDA、iFunBox、dyld_decache</a>
    
  

</span>

                    </div>
                </div>
                <div class="excerpt">
                    <ul id="markdown-toc">
  <li><a href="#section" id="markdown-toc-section">1、简介</a></li>
  <li><a href="#section-1" id="markdown-toc-section-1">2、安装</a>    <ul>
      <li><a href="#section-2" id="markdown-toc-section-2">2.1 安装</a></li>
      <li><a href="#ida" id="markdown-toc-ida">2.2 IDA使用说明</a></li>
      <li><a href="#main-window" id="markdown-toc-main-window">2.3 Main window</a></li>
    </ul>
  </li>
  <li><a href="#ifunbox" id="markdown-toc-ifunbox">3、iFunBox</a></li>
  <li><a href="#dylddecache" id="markdown-toc-dylddecache">4 dyld_decache</a></li>
</ul>

<p><strong>待整理</strong></p>

<h2 id="section">1、简介</h2>

<p>即使你以前没有从事过iOS逆向工程相关的工作，也一定听说过IDA（The Interactive Disassembler）的鼎鼎大名。而对于绝大多数接触过逆向工程的人来说，IDA三个字则是如雷贯耳，它乃逆向工程中最负盛名的神器之一。如果说class-dump能够帮我们罗列出要分析的点，那IDA就能进一步帮我们把这些点铺成面。</p>

<p>笼统地说，IDA是一个支持Windows、Linux和Mac OS X的多平台反汇编器/调试器，它的功能非常强大，以至于连官方都不能给出一个详尽的功能列表。</p>

<p>IDA的正式版是收费的，但其作者也是程序员出身，深知我们生活不易，所以慷慨地提供了一个免费的试用版，对于逆向工程初学者来说，已完全够用了。</p>

<h2 id="section-1">2、安装</h2>

<h5 id="section-2">2.1 安装</h5>

<p>IDA的下载和安装十分方便，具体可参考：<a href="https://www.hex-rays.com/products/ida/support/download.shtml">https://www.hex-rays.com/products/ida/support/download.shtml</a></p>

<h5 id="ida">2.2 IDA使用说明</h5>

<p>启动之后，在该界面中，不用繁琐地在菜单里点击“打开文件”，然后一个目录一个目录地去翻找，只需把要分析的文件拖进IDA的灰色区域就行了。</p>

<p>有一个地方需要注意：对于一些fat binary（指的是为了兼容不同架构的处理器，而把多种指令集糅合到一个binary）来说
<img src="https://ooo.0o0.ooo/2016/11/01/581869117b6b0.jpeg" alt="" /></p>

<p>上图最上面的白框内会出现多个Mach-O文件供我们选择。需要我们识别设备对应的ARM信息，例如笔者的iPhone 5对应的是ARMv7s。如果设备的ARM没有出现在这些选项中，就选那个向下兼容的选项，即如果选项里有ARMv7S，就选它；否则选ARMv7。
这里笔者选择了ARMv7S，然后点击“OK”，此时 会连续弹出好几个窗口，一路点击“Yes”和“OK”就可以了。
之后就进入如下界面：
<img src="https://ooo.0o0.ooo/2016/11/01/58186a17dab43.jpeg" alt="" /></p>

<p>在上边的界面中，你会看到上方的进度条不断滚动，下方的Output window也会打印出对文件的分析进度。当进度条的主色调变成蓝色（IDA界面上的颜色在黑白印刷页上看不出来，请谅解），Output window中显示“The initial autoanalysis has been finished.”时，表示IDA的初始分析已完成。</p>

<p>在初学阶段，由于主要用IDA作静态分析，基本用不上Output window，所以在开始分析之前，可以先关掉“Output window。</p>

<p>Functions window中的Objective-C函数与class-dump导出的内容吻合。除了Objective-C函数外，IDA还将所有subroutine罗列了出来，这是class-dump做不到的。class-dump导出的内容都是Objective-C函数名，可读性高，容易上手，是iOS逆向工程初学者的乐园；subroutine的名称只是一个代号，没有明显含义，分析难度大，大多数初学者看到这里就打了退堂鼓。但是，iOS的底层是用C和C++实现的，编译之后生成的大都是subroutine，class-dump拿它没辙，只能使用IDA这样的工具。要想深层次挖掘iOS中最有趣的部分，掌握IDA的用法是必经之路。</p>

<h5 id="main-window">2.3 Main window</h5>

<p>绝大多数没有用过IDA的iOS开发者，包括笔者，在第一次看见初始分析完成后的Main window时都懵了——这都是些什么玩意儿？这是人类文字吗？还是把IDA关了，刷会儿微博压压惊吧。这跟很多工程师在写第一行代码时不知如何下手的感觉很类似。其实，跟写代码时需要定义一个入口函数一样，在逆向工程里，也需要找到自己感兴趣的入口函数。在Functions window中双击这个入口函数，使得Main window跳转到函数体，然后用鼠标选中Main window，按一下空格，界面会瞬间变清爽，可读性一下就强了起来。</p>

<p>。。。</p>

<h2 id="ifunbox">3、iFunBox</h2>

<p>iFunBox 是一款老牌iOS文件管理工具，可以非常方便地操作iOS中的文件。 iFunBox的使用并不复杂，我们主要用到的是它的文件传输功能。有一点需要注意的是，越狱iOS必须安装“Apple File Conduit 2” ，简称AFC2，这样iFunBox才能够浏览iOS全系统文件，而且这也是接下来大部分操作的先决条件。</p>

<h2 id="dylddecache">4 dyld_decache</h2>

<p>安装了iFunBox和AFC2之后，不少读者会迫不及待地开始浏览iOS文件系统，看看这个封闭平台的表面下到底暗藏了多少玄机。相信大家很快就会发现一个问题：“/System/Library/Frameworks/”、“/System/Library/PrivateFrameworks/”等目录下，怎么没有库文件？</p>

<p>从iOS 3.1开始，包括frameworks在内的许多库文件被存进了一个大cache里，这个cache文件位于“/System/Library/Caches/com.apple.dyld/dyld_shared_cache_armx”（名为dyld_shared_cache_armv7、dyld_shared_cache_armv7s或dyld_shared_cache_arm64），可以使用KennyTM开发的dyld_decache将其中的二进制文件提取出来。这样做的好处是确保分析的文件来自本机，在使用Mac工具集与iOS工具集分析同一目标时，OSX与iOS上分析出的指令和地址等数据是完全吻合的，避免了出现驴唇不对马嘴的低级错误。有关这个cache的进一步介绍，可以参阅DHowett的博客http://blog.howett.net/).</p>

<p>使用dyld_decache之前，要将“/System/Library/Caches/com.apple.dyld/dyld_shared_cache_armx”用iFunBox（不能用scp）从iOS拷贝到OSX中。然后从https://github.com/downloads/kennytm/Miscellaneous/dyld_decache[v0.1c].bz2下载dyld_decache。解压之后赋予其可执行权限，如下：</p>

<div class="highlighter-rouge"><pre class="highlight"><code>snakeninnysiMac:~ snakeninny$ chmod +x /path/to/dyld_decache\[v0.1c\]
</code></pre>
</div>

<p>然后开始提取二进制文件，如下：</p>

<div class="highlighter-rouge"><pre class="highlight"><code>snakeninnysiMac:~ snakeninny$ /path/to/dyld_decache\[v0.1c\] -o /where/to/store/decached/binaries/ /path/to/dyld_shared_cache_armx
  0/877: Dumping '/System/Library/AccessibilityBundles/AXSpeechImplementation.bundle/AXSpeechImplementation'...
  1/877: Dumping '/System/Library/AccessibilityBundles/AccessibilitySettingsLoader.bundle/AccessibilitySettingsLoader'...
  2/877: Dumping '/System/Library/AccessibilityBundles/AccountsUI.axbundle/AccountsUI'...
……
</code></pre>
</div>

<p>提取出的所有二进制文件都存放在了“/where/to/store/decached/binaries/”下。值得一提的是，逆向工程需要分析的二进制文件现在散落在OSX和iOS两个系统中，不方便查找，建议利用下一章提到的scp工具把iOS文件系统拷贝一份存在OSX里。</p>


                </div>
                <div class="read-all">
                    <a  href="/2016/11/06/5_IDA-iFunBox-other/"><i class="fa fa-newspaper-o"></i>Read All</a>
                </div>
                <hr>
              </li>
            
              <li>
                <h2>
                  <a class="post-link" href="/2016/11/05/IOS_Adopt/"> 一道面试题里藏的IOS世界</a>
                </h2>
                <div class="label">
                    <div class="label-card">
                        <i class="fa fa-calendar"></i>2016-11-05
                    </div>
                    <div class="label-card">
                        <i class="fa fa-user"></i>3行代码
                        
                    </div>
                    <div class="label-card">
                        
                    </div>

                    <div class="label-card">
                    


<!-- <span class="point">•</span> -->
<span class="categories">
  <i class="fa fa-th-list"></i>
  
    
        <a href="/category/#Objective-C" title="Category: Objective-C" rel="category">Objective-C</a>
    
  

  <!-- <span class="point">•</span> -->
</span>


                    </div>

                    <div class="label-card">
                    
<!-- <span class="point">•</span> -->
<span class="pageTag">
  <i class="fa fa-tags"></i>
  
    
        <a href="/tag/#iOS基础" title="Tag: iOS基础" rel="tag">iOS基础</a>
    
  

</span>

                    </div>
                </div>
                <div class="excerpt">
                    <ul id="markdown-toc">
  <li><a href="#section" id="markdown-toc-section">前序</a></li>
  <li><a href="#section-1" id="markdown-toc-section-1">解析</a>    <ul>
      <li><a href="#section-2" id="markdown-toc-section-2">1、枚举</a>        <ul>
          <li><a href="#section-3" id="markdown-toc-section-3">1.1 定义规范的枚举</a></li>
          <li><a href="#section-4" id="markdown-toc-section-4">1.2 定义规范的枚举内容</a></li>
          <li><a href="#section-5" id="markdown-toc-section-5">1.3 枚举的深入</a></li>
          <li><a href="#section-6" id="markdown-toc-section-6">1.4 优化后的写法</a></li>
        </ul>
      </li>
    </ul>
  </li>
  <li><a href="#section-7" id="markdown-toc-section-7">2、属性</a>    <ul>
      <li><a href="#section-8" id="markdown-toc-section-8">属性的修饰符</a></li>
      <li><a href="#age-" id="markdown-toc-age-">2.1、age属性 类型的选择</a></li>
      <li><a href="#section-9" id="markdown-toc-section-9">2.2、属性的内存管理</a></li>
      <li><a href="#protocolproperty" id="markdown-toc-protocolproperty">2.3、在@protocol中使用@property：</a></li>
      <li><a href="#synthesizedynamic" id="markdown-toc-synthesizedynamic">2.5、属性相关的@synthesize和@dynamic</a></li>
    </ul>
  </li>
</ul>

<p><img src="https://ooo.0o0.ooo/2016/11/05/581daad679042.png" alt="" /></p>

<p>上边这张图是前段时间网上比较火的一套面试题中的。这套题来源是 目前就职于百度的孙源。</p>

<h2 id="section">前序</h2>

<p>会有开发者，看这道题目时会觉着没有啥太大毛病，实际中他们也可能就是这样写的。</p>

<p>其实在github上会经常看到这样类似的代码，特别是在一些小demo里很常见。之所以忽略其中的问题，主要是因为没有认识到规范的写法，以及这种写法可能引起的问题。扯远点就是，一个人的编码语言认知水平会极大的影响他的编码行为。然而认知水平和学习的途径有莫大的关系。</p>

<p>前几个月，我们公司招聘移动开人员，本人也面试不少android和ios的开发者，发现一个很普遍的问题：代码不规范。不论是刚从培训学校里刚出来的，还是已经5~6年经验的开发者。当提到代码的规范时，大多回答的就是驼峰式命名法，甚至有位”资深的”求职者向我”普及现今业界的普遍形式”:其实代码规范与否并不重要，对多数中小创业公司而言,重要的是快速上线，及时迭代，占有市场。话是不错，也道出了像我们这种在风口创业公司的基本路线，就是及早入场，拿到牌照，占有市场。但最终我也没有通过他的面试。理由是:工作经验丰富(开发过Symbian,android,iOS)但不适合做开发(因android\iOS不资深。我们要招聘资深的android，懂点iOS，创业公司嘛，iOS和android分的不是很清，是活都干)。</p>

<p>上边扯远了，代码的规范与否，最初的学习途径和形式固然重要，更重要的是在后期的工作中，是否较为全面系统的从官方提供的资料中进行相关学习。可能有人觉得不重要，但是在我看来，这是一名合格开发者的必经之路。你所用的语言、规则，都是人家定的,即便能开发出可用的app，那也未必合格，特别是项目逐渐做大之后，简单的模式，不规范的代码所带来的隐患就会逐渐呈现出来。</p>

<p><strong>下边首先会解析问题，并就部分内容深入解析，如有疑问还请留言相告</strong></p>

<h2 id="section-1">解析</h2>

<!-- 这里先推荐官方的写法：[传送门](https://developer.apple.com/library/content/releasenotes/ObjectiveC/ModernizationObjC/AdoptingModernObjective-C/AdoptingModernObjective-C.html#//apple_ref/doc/uid/TP40014150-CH1-SW4) -->

<h3 id="section-2">1、枚举</h3>

<p>问题点：</p>

<p>1、题目中写枚举是使用C的风格；
2、枚举定义的不规范；
3、枚举的内容不严谨。</p>

<h5 id="section-3">1.1 定义规范的枚举</h5>

<p>官方文档中，enum 建议使用 NS_ENUM 和 NS_OPTIONS 宏来定义枚举类型。
    NS_ENUM枚举项的值为NSInteger，定义通用的枚举；
    NS_OPTIONS枚举项的值为NSUInteger，定义位移枚举。
一般开发者可能用不到后者，但如果进入到UIKit的头文件里，就会看到很多这种书写格式。</p>

<p>enum 中驼峰命名法和下划线命名法的使用：枚举类型的命名规则和函数的命名规则相同：命名时使用驼峰命名法，勿同时使用下划线命名法。</p>

<h5 id="section-4">1.2 定义规范的枚举内容</h5>

<p>试题的model实际使用场景不清楚，这里将该枚举场景放宽到生活中：
那么除了男性，女性，实际上还应该有包括：内心男性的女性，以及内心女性的男性，以及无性，以及其他未知的性别(考虑未知的特殊情况。当然下边的枚举针对不同的行业场景，可能要进行调整)</p>

<h4 id="section-5">1.3 枚举的深入</h4>

<p>这两个宏的定义在Foundation.framework的NSObjCRuntime.h中：</p>
<div class="highlighter-rouge"><pre class="highlight"><code>#if (__cplusplus &amp;&amp; __cplusplus &gt;= 201103L &amp;&amp; (__has_extension(cxx_strong_enums) || __has_feature(objc_fixed_enum))) || (!__cplusplus &amp;&amp; __has_feature(objc_fixed_enum))  
#define NS_ENUM(_type, _name) enum _name : _type _name; enum _name : _type  
#if (__cplusplus)  
#define NS_OPTIONS(_type, _name) _type _name; enum : _type  
#else  
#define NS_OPTIONS(_type, _name) enum _name : _type _name; enum _name : _type  
#endif  
#else  
#define NS_ENUM(_type, _name) _type _name; enum  
#define NS_OPTIONS(_type, _name) _type _name; enum  
#endif  
</code></pre>
</div>
<p>其实上述的写法，等价于：</p>

<div class="highlighter-rouge"><pre class="highlight"><code>typedef enum JUserGender : NSInteger JUserGender;  
enum JUserGender : NSInteger {  }
</code></pre>
</div>

<p>从枚举定义来看，NS_ENUM和NS_OPTIONS本质是一样的，仅仅从字面上来区分其用途。NS_ENUM是通用情况，NS_OPTIONS一般用来定义具有位移或特点的情况。</p>

<h4 id="section-6">1.4 优化后的写法</h4>

<div class="highlighter-rouge"><pre class="highlight"><code>typedef NS_ENUM(NSInteger, JUserGender) {
    JUserGenderUnknown,
    JUserGenderMale,
    JUserGenderGay,
    JUserGenderFemale,
    JUserGenderLesbian,
    JUserGenderNeuter
};
</code></pre>
</div>

<h2 id="section-7">2、属性</h2>

<p>** @property本质是: @property = ivar + getter + setter;**</p>

<p>也就是说，属性=ivar（实例变量）+ 存取方法。它作为 OC的一项特性，主要的作用就在于封装对象中的数据。 OC 对象通常会把其所需要的数据保存为各种实例变量。</p>

<h4 id="section-8">属性的修饰符</h4>

<p>原子性 — nonatomic 特质
(不声明nonatomic，编译器就默认使用同步锁保证其原子性atomic，从而保证其线程安全。但如果真的是多个线程同时操作该属性，最好采用其它手段保证属性thread safety)</p>

<p>读/写权限 — readwrite(读写)、readonly (只读)</p>

<p>内存管理语义—assign、strong、 weak、unsafe_unretained、copy</p>

<p>方法名—getter=<name> 、setter=<name></name></name></p>

<p><strong>下边分别解说</strong></p>

<h4 id="age-">2.1、age属性 类型的选择</h4>

<p>age 属性的类型：应避免使用基本类型，建议使用 Foundation 数据类型，对应关系如下：</p>

<div class="highlighter-rouge"><pre class="highlight"><code>int -&gt; NSInteger
unsigned -&gt; NSUInteger
float -&gt; CGFloat 同时考虑到 age 的特点，以及出于32/64 bit的考虑应使用 NSUInteger。
</code></pre>
</div>

<h4 id="section-9">2.2、属性的内存管理</h4>

<p>详见官方文档 <a href="https://developer.apple.com/library/content/documentation/Cocoa/Conceptual/ProgrammingWithObjectiveC/WorkingwithBlocks/WorkingwithBlocks.html#//apple_ref/doc/uid/TP40011210-CH8-SW12">传送门</a></p>

<p><strong>1、weak VS assign</strong></p>

<p>使用weak的情形：
1、在 ARC 中,可能出现循环引用时,往往要通过weak来解决,比如: delegate代理属性
2、自身已经强引用,此时也会使用weak,比如:自定义IBOutlet控件属性一般使用 weak；(也可使用strong)
..
相同：
weak义为“非拥有关系”，设置方法既不保留新值，也不释放旧值(此同assign)， 然而对象销毁时，属性值也会清空(assign 的set只会执行针对CGFloat、NSlnteger等简单的赋值操作），
weak必须用于OC对象(assigin可以用非OC对象)。</p>

<p><strong>2、runtime中的weak原理：</strong>
runtime中实现weak的原理是：runtime对注册的类进行布局，weak对象会放入一个hash表中。把weak指的对象内存地址作为key，当此对象的引用计数为0时dealloc，假如weak指向的对象内存地址是a，那么就会以a为键，在这个weak表中搜索，找到所有以a为键的weak对象，从而设置为nil。</p>

<p><strong>3、copy</strong></p>

<p>3.1、copy复制出来是不可变的,所以可变属性不建议用copy:</p>

<p>@property (copy) NSMutableArray *array;
这里使用copy结果导致属性是不可变的。同时这里使用了atomic会影响性能</p>

<p>3.2、NSArray等经常使用copy关键字:
因为他们有对应的可变类型：NSMutableArray，他们之间可能进行赋值操作，为确保对象中的字符串值不会无意间变动，应该在设置新属性值时拷贝一份。</p>

<p>3.3、block 也经常使用 copy 关键字
具体原因见官方文档：<a href="https://developer.apple.com/library/content/documentation/Cocoa/Conceptual/ProgrammingWithObjectiveC/WorkingwithBlocks/WorkingwithBlocks.html#//apple_ref/doc/uid/TP40011210-CH8-SW12">传送门</a>
block 使用copy是从MRC遗留下来的“传统”,在MRC中,方法内部的block是在栈区的,使用copy 可以把它放到堆区。在 ARC中不强制。</p>

<p>3.4、copy修饰自定义类
如果自定义的对象分为可变与不可变版本，那么就要同时实现 NSCopying 与 NSMutableCopying 协议。针对实际可能出现的复杂情况，实现主要代码如下：</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="c1">// .h文件
</span>   <span class="k">typedef</span> <span class="nf">NS_ENUM</span><span class="p">(</span><span class="n">NSInteger</span><span class="p">,</span> <span class="n">JUserGender</span><span class="p">)</span> <span class="p">{</span>
       <span class="n">JUserGenderUnknown</span><span class="p">,</span>
       <span class="n">JUserGenderMale</span><span class="p">,</span>
       <span class="n">JUserGenderGay</span><span class="p">,</span>
       <span class="n">JUserGenderFemale</span><span class="p">,</span>
       <span class="n">JUserGenderLesbian</span><span class="p">,</span>
       <span class="n">JUserGenderNeuter</span>
   <span class="p">};</span>

  <span class="k">@interface</span> <span class="nc">JUser</span> <span class="p">:</span> <span class="nc">NSObject</span><span class="o">&lt;</span><span class="n">NSCopying</span><span class="o">&gt;</span>

  <span class="k">@property</span> <span class="p">(</span><span class="n">nonatomic</span><span class="p">,</span> <span class="n">readonly</span><span class="p">,</span> <span class="n">copy</span><span class="p">)</span>      <span class="n">NSString</span>    <span class="o">*</span><span class="n">name</span><span class="p">;</span>
  <span class="k">@property</span> <span class="p">(</span><span class="n">nonatomic</span><span class="p">,</span> <span class="n">readonly</span><span class="p">,</span> <span class="n">assign</span><span class="p">)</span>    <span class="n">NSUInteger</span>  <span class="n">age</span><span class="p">;</span>
  <span class="k">@property</span> <span class="p">(</span><span class="n">nonatomic</span><span class="p">,</span> <span class="n">readwrite</span><span class="p">,</span> <span class="n">assign</span><span class="p">)</span>   <span class="n">JUserGender</span> <span class="n">sex</span><span class="p">;</span>

  <span class="k">-</span> <span class="p">(</span><span class="n">instancetype</span><span class="p">)</span><span class="nf">initWithName</span><span class="p">:(</span><span class="n">NSString</span> <span class="o">*</span><span class="p">)</span><span class="nv">name</span> <span class="nf">age</span><span class="p">:(</span><span class="n">NSUInteger</span><span class="p">)</span><span class="nv">age</span> <span class="nf">sex</span><span class="p">:(</span><span class="n">JUserGender</span><span class="p">)</span><span class="nv">sex</span><span class="p">;</span>
  <span class="k">+</span> <span class="p">(</span><span class="n">instancetype</span><span class="p">)</span><span class="nf">userWithName</span><span class="p">:(</span><span class="n">NSString</span> <span class="o">*</span><span class="p">)</span><span class="nv">name</span> <span class="nf">age</span><span class="p">:(</span><span class="n">NSUInteger</span><span class="p">)</span><span class="nv">age</span> <span class="nf">sex</span><span class="p">:(</span><span class="n">JUserGender</span><span class="p">)</span><span class="nv">sex</span><span class="p">;</span>
<span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">addFriend</span><span class="p">:(</span><span class="n">JUserGender</span> <span class="o">*</span><span class="p">)</span><span class="nv">user</span><span class="p">;</span>
<span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">removeFriend</span><span class="p">:(</span><span class="n">JUserGender</span> <span class="o">*</span><span class="p">)</span><span class="nv">user</span><span class="p">;</span>
<span class="k">@end</span>

<span class="c1">// .m文件
</span>
<span class="k">@implementation</span> <span class="nc">JUser</span> <span class="p">{</span>
    <span class="n">NSMutableSet</span> <span class="o">*</span><span class="n">_friends</span><span class="p">;</span>
<span class="p">}</span>

<span class="o">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="n">setName</span><span class="o">:</span><span class="p">(</span><span class="n">NSString</span> <span class="o">*</span><span class="p">)</span><span class="n">name</span> <span class="p">{</span>
    <span class="n">_name</span> <span class="o">=</span> <span class="p">[</span><span class="n">name</span> <span class="nf">copy</span><span class="p">];</span>
<span class="p">}</span>

<span class="o">-</span> <span class="p">(</span><span class="n">instancetype</span><span class="p">)</span><span class="n">initWithName</span><span class="o">:</span><span class="p">(</span><span class="n">NSString</span> <span class="o">*</span><span class="p">)</span><span class="n">name</span>
                         <span class="n">age</span><span class="o">:</span><span class="p">(</span><span class="n">NSUInteger</span><span class="p">)</span><span class="n">age</span>
                         <span class="n">sex</span><span class="o">:</span><span class="p">(</span><span class="n">JUserGender</span><span class="p">)</span><span class="n">sex</span> <span class="p">{</span>
    <span class="k">if</span><span class="p">(</span><span class="n">self</span> <span class="o">=</span> <span class="p">[</span><span class="n">super</span> <span class="nf">init</span><span class="p">])</span> <span class="p">{</span>
        <span class="n">_name</span> <span class="o">=</span> <span class="p">[</span><span class="n">name</span> <span class="nf">copy</span><span class="p">];</span>
        <span class="n">_age</span> <span class="o">=</span> <span class="n">age</span><span class="p">;</span>
        <span class="n">_sex</span> <span class="o">=</span> <span class="n">sex</span><span class="p">;</span>
        <span class="n">_friends</span> <span class="o">=</span> <span class="p">[[</span><span class="n">NSMutableSet</span> <span class="nf">alloc</span><span class="p">]</span> <span class="nf">init</span><span class="p">];</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">self</span><span class="p">;</span>
<span class="p">}</span>

<span class="o">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="n">addFriend</span><span class="o">:</span><span class="p">(</span><span class="n">JUserGender</span> <span class="o">*</span><span class="p">)</span><span class="n">user</span> <span class="p">{</span>
    <span class="p">[</span><span class="n">_friends</span> <span class="nf">addObject</span><span class="p">:</span><span class="n">user</span><span class="p">];</span>
<span class="p">}</span>

<span class="o">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="n">removeFriend</span><span class="o">:</span><span class="p">(</span><span class="n">JUserGender</span> <span class="o">*</span><span class="p">)</span><span class="n">user</span> <span class="p">{</span>
    <span class="p">[</span><span class="n">_friends</span> <span class="nf">removeObject</span><span class="p">:</span><span class="n">user</span><span class="p">];</span>
<span class="p">}</span>

<span class="o">-</span> <span class="p">(</span><span class="n">id</span><span class="p">)</span><span class="n">copyWithZone</span><span class="o">:</span><span class="p">(</span><span class="n">NSZone</span> <span class="o">*</span><span class="p">)</span><span class="n">zone</span> <span class="p">{</span>
    <span class="n">CYLUser</span> <span class="o">*</span><span class="n">copy</span> <span class="o">=</span> <span class="p">[[[</span><span class="n">self</span> <span class="nf">class</span><span class="p">]</span> <span class="nf">allocWithZone</span><span class="p">:</span><span class="n">zone</span><span class="p">]</span>
                     <span class="nf">initWithName</span><span class="p">:</span><span class="n">_name</span>
                     <span class="nf">age</span><span class="p">:</span><span class="n">_age</span>
                     <span class="n">sex</span><span class="o">:</span><span class="n">_sex</span><span class="p">];</span>
    <span class="n">copy</span><span class="o">-&gt;</span><span class="n">_friends</span> <span class="o">=</span> <span class="p">[</span><span class="n">_friends</span> <span class="nf">mutableCopy</span><span class="p">];</span>
    <span class="k">return</span> <span class="n">copy</span><span class="p">;</span>
<span class="p">}</span>

<span class="o">-</span> <span class="p">(</span><span class="n">id</span><span class="p">)</span><span class="n">deepCopy</span> <span class="p">{</span>
    <span class="n">JUser</span> <span class="o">*</span><span class="n">copy</span> <span class="o">=</span> <span class="p">[[[</span><span class="n">self</span> <span class="nf">class</span><span class="p">]</span> <span class="nf">allocWithZone</span><span class="p">:</span><span class="n">zone</span><span class="p">]</span>
                     <span class="nf">initWithName</span><span class="p">:</span><span class="n">_name</span>
                     <span class="nf">age</span><span class="p">:</span><span class="n">_age</span>
                     <span class="n">sex</span><span class="o">:</span><span class="n">_sex</span><span class="p">];</span>
    <span class="n">copy</span><span class="o">-&gt;</span><span class="n">_friends</span> <span class="o">=</span> <span class="p">[[</span><span class="n">NSMutableSet</span> <span class="nf">alloc</span><span class="p">]</span> <span class="nf">initWithSet</span><span class="p">:</span><span class="n">_friends</span>
                                             <span class="nf">copyItems</span><span class="p">:</span><span class="nb">YES</span><span class="p">];</span>
    <span class="k">return</span> <span class="n">copy</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">@end</span>
</code></pre>
</div>

<h4 id="protocolproperty">2.3、在@protocol中使用@property：</h4>

<p>需要借助运行时：
objc_setAssociatedObject
objc_getAssociatedObject</p>

<h4 id="synthesizedynamic">2.5、属性相关的@synthesize和@dynamic</h4>

<p>如果@synthesize和@dynamic都没写，那么默认的就是@syntheszie var = _var;</p>

<p>@synthesize：没有手动实现setter、getter，编译器会自动为你加上这两个方法。除此之外，可以在类的.m文件中，通过@synthesize指定实例变量的名字:
@implementation Juser
@synthesize name = _myName; 
@end 
那么就使用了别名_myName来代替name</p>

<p>@dynamic：告诉编译器属性的setter与getter方法由用户自己实现，不自动生成。</p>


                </div>
                <div class="read-all">
                    <a  href="/2016/11/05/IOS_Adopt/"><i class="fa fa-newspaper-o"></i>Read All</a>
                </div>
                <hr>
              </li>
            
              <li>
                <h2>
                  <a class="post-link" href="/2016/11/04/3_Theos_-fourFile/">iOS逆向系列3_Theos_file简介及Logos基本语法</a>
                </h2>
                <div class="label">
                    <div class="label-card">
                        <i class="fa fa-calendar"></i>2016-11-04
                    </div>
                    <div class="label-card">
                        <i class="fa fa-user"></i>3行代码
                        
                    </div>
                    <div class="label-card">
                        
                    </div>

                    <div class="label-card">
                    


<!-- <span class="point">•</span> -->
<span class="categories">
  <i class="fa fa-th-list"></i>
  
    
        <a href="/category/#Reverse" title="Category: Reverse" rel="category">Reverse</a>
    
  

  <!-- <span class="point">•</span> -->
</span>


                    </div>

                    <div class="label-card">
                    
<!-- <span class="point">•</span> -->
<span class="pageTag">
  <i class="fa fa-tags"></i>
  
    
        <a href="/tag/#Theos" title="Tag: Theos" rel="tag">Theos</a>&nbsp;
    
        <a href="/tag/#Logos" title="Tag: Logos" rel="tag">Logos</a>
    
  

</span>

                    </div>
                </div>
                <div class="excerpt">
                    <ul id="markdown-toc">
  <li><a href="#section" id="markdown-toc-section">1、说明</a></li>
  <li><a href="#makefile" id="markdown-toc-makefile">2、Makefile</a>    <ul>
      <li><a href="#section-1" id="markdown-toc-section-1">2.1 基本配置</a></li>
      <li><a href="#section-2" id="markdown-toc-section-2">2.2 指定处理器架构</a></li>
      <li><a href="#sdk" id="markdown-toc-sdk">2.3 指定SDK版本</a></li>
      <li><a href="#framework" id="markdown-toc-framework">2.4 导入framework</a></li>
      <li><a href="#mach-omach-o-object" id="markdown-toc-mach-omach-o-object">2.5 链接Mach-O对象（Mach-O object）</a></li>
    </ul>
  </li>
</ul>

<p><strong>待整理</strong></p>

<p>在iosOpenDev之前，很多ios插件都使用theos编译开发，现在使用theos开发的人也不在少数。theos 有自己的模板用于开发一系列的插件程序，所以在早期开发的插件中基本上都是使用theos。
怎样安装theos，在前边的文章已有介绍：<a href="">传送门</a></p>

<h2 id="section">1、说明</h2>
<p>使用theos创建工程：projectBy3code。文件夹内有四个文件：
projectBy3code.plist、Makefile、Tweak.xm、control 下面分别介绍这四个文件</p>

<p>参考教程：</p>

<p>Logos 语法
<a href="http://iphonedevwiki.net/index.php/Logos">http://iphonedevwiki.net/index.php/Logos</a></p>

<p>Makefile
<a href="http://www.gnu.org/software/make/manual/html_node/Makefiles.html">http://www.gnu.org/software/make/manual/html_node/Makefiles.html</a></p>

<p>debian的官网
<a href="http://www.debian.org/doc/debian-policy/ch-controlfields.html">http://www.debian.org/doc/debian-policy/ch-controlfields.html</a></p>

<h2 id="makefile">2、Makefile</h2>

<h5 id="section-1">2.1 基本配置</h5>

<p>Makefile文件指定工程用到的文件、框架、库等信息。projectBy3code的Makefile内容以及解释如下：</p>

<div class="highlighter-rouge"><pre class="highlight"><code>#固定写法:系统变量，不要更改。
#告诉theOS在编译脚本中包括共同的make命令，避免做重复的make编译工作
include $(THEOS)/makefiles/common.mk

#tweak的名字，即用Theos创建工程时指定的“Project Name”，跟control文件中的“Name”字段对应，不要更改。
TWEAK_NAME = projectBy3code

#tweak包含的源文件（不包括头文件），多个文件间以空格分隔，如： projectBy3code_FILES = Tweak.xm Hook.xm New.x ObjC.m ObjC++.mm.头文件是可以按需修改的。
#这里是需要编译的文件列表，注意：不要把头文件添加到这里。如果你要添加一个新的.m或者.mm文件到项目中，确保在这里添加新的文件的名称，否则将不会建立编译连接。
projectBy3code_FILES = Tweak.xm

#根据不同的Theos工程类型，通过include命令指定不同的.mk文件；在逆向工程初级阶段，我们开发的一般是Application、Tweak和Tool三种类型的程序，它们对应的.mk文件分别是application.mk、tweak.mk和tool.mk，可以按需更改。	
include $(THEOS_MAKE_PATH)/tweak.mk

#tweak安装之后杀掉SpringBoard进程，好让CydiaSubstrate在进程启动时加载对应的dylib。
after-install::
		install.exec "killall -9 SpringBoard; killall -9 Instantiating; killall -9 iphone/tweak; killall -9 in; killall -9 projectBy3code/..."
</code></pre>
</div>

<p>是不是非常简单？Makefile里的默认内容确实非常简单，如何指定SDK版本？怎么导入framework？lib文件在哪里链接？，面包会有的，牛奶也会有的。下面介绍：</p>

<h5 id="section-2">2.2 指定处理器架构</h5>

<p><strong>这里不需要明确的指出，可以不加这一条！！原因是5s使用的64位处理器，不能用armv7指令集，所以需要在Makefile里将armv7更改为arm64，因此不要加，可能得不偿失.除非明确，否则不要加如下代码</strong></p>

<div class="highlighter-rouge"><pre class="highlight"><code>ARCHS = armv7 arm64
</code></pre>
</div>

<p>上面的语句在表示不同的处理器架构，采用arm64架构的App不兼容armv7/armv7s架构，必须适配arm64架构的dylib。
You shouldn’t need to explicitly set ARCHS unless you have a very good reason. Theos will always ensure it is set to an appropriate value for your SDK and deployment targets.</p>

<h5 id="sdk">2.3 指定SDK版本</h5>

<p>默认是：iphone:clang:latest:latest。意即meaning to build for iOS, using clang, with the latest SDK version, deploying to support iOS versions matching the SDK version, or newer。</p>

<p>SDK可以放在xcode的包路径里面，或者最好的是放在theos里，然后设置路径即可。
方法如下：
 you should edit ~/.theosrc (which probably doesn’t exist, so create it) and insert something along the lines of:</p>

<p>SDKVERSION = 9.3
SYSROOT = $(THEOS)/sdks/iPhoneOS9.3.sdk</p>

<p>TARGET = iphone::9.2:9.0</p>

<p>Which indicates that you are building for iOS, using SDK 9.2, and intending to support iOS 9.0 and newer.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>TARGET = iphone:latest:8.0
</code></pre>
</div>

<p>比如：TARGET = iphone:8.1:8.0
   上面的语句即指定采用8.1版本的SDK，且发布对象为iOS 8.0及以上版本。也可以把“Base SDK”设置为“latest”，指定以Xcode附带的最新版本SDK编译，如：TARGET = iphone:latest:8.0</p>

<h5 id="framework">2.4 导入framework</h5>
<p>这里包括你想用到框架的名称</p>

<div class="highlighter-rouge"><pre class="highlight"><code>projectBy3code_FRAMEWORKS =  UIKit CoreTelephony CoreAudio
</code></pre>
</div>

<p>例如：projectBy3code_FRAMEWORKS = UIKit CoreTelephony CoreAudio
上面的语句所展示的功能没什么多说的，但既然是tweak开发，很多朋友关注的应该是如何导入private framework吧？很简单，用下面的语句即可：</p>

<div class="highlighter-rouge"><pre class="highlight"><code>projectBy3code_PRIVATE_FRAMEWORKS = AppSupport ChatKit IMCore 例如：projectBy3code_PRIVATE_FRAMEWORKS = AppSupport ChatKit IMCore
</code></pre>
</div>

<p>虽然只是多了个“PRIVATE”，但有一点要注意：private framework是AppStore开发所不允许使用的，它的内容在每个iOS版本之间可能发生变化，在导入之前，一定要确定导入的private framework确实存在。举一个例子，如果你的tweak打算兼容iOS 7和iOS 8两个版本，那么Makefile可写成如下内容：</p>

<div class="highlighter-rouge"><pre class="highlight"><code>ARCHS = armv7 arm64
TARGET = iphone:latest:7.0
include theos/makefiles/common.mk
TWEAK_NAME = projectBy3code
projectBy3code_FILES = Tweak.xm
projectBy3code_PRIVATE_FRAMEWORK = BaseBoard
include $(THEOS_MAKE_PATH)/tweak.mk
after-install::
      install.exec "killall -9 SpringBoard"
</code></pre>
</div>
<p>上面的语句可以成功编译和链接，并不会报错。但是，因为BaseBoard这个private framework只存在于8.0及以上版本的SDK里，在iOS 7里是没有的，所以这个tweak在iOS 7中会因找不到framework而无法正常工作。这种情况可以通过弱链接（谷歌搜索“makefile weak linking”）或dlopen()、dlsym()和dlclose()系列函数动态调用private framework来解决。</p>

<h5 id="mach-omach-o-object">2.5 链接Mach-O对象（Mach-O object）</h5>

<div class="highlighter-rouge"><pre class="highlight"><code>projectBy3code_LDFLAGS = -lx
</code></pre>
</div>

<p>Theos采用GNU Linker来链接Mach-O对象，包括.dylib、.a和.o。在Terminal中输入“man ld”，定位到“-lx”部分，它是这么写的：</p>

<div class="highlighter-rouge"><pre class="highlight"><code>“-lx This option tells the linker to search for libx.dylib or libx.a in the library search path.If string x is of the form y.o,then that file is searched for in the “same places,but without prepending`lib’or appending`.a’or`.dylib’to the filename.”
</code></pre>
</div>

<p>大致意思是说，-lx代表链接libx.a或libx.dylib，即给“x”加上“lib”的前缀，以及“.a”或“.dylib”的后缀；如果x是“y.o”的形式，则直接链接y.o，不加任何前缀或后缀。iOS支持链接的Mach-O对象全是以“libx.dylib”和“y.o”形式命名的，完全兼容GNU Linker。“这样，链接Mach-O对象就很方便了。例如，要链接libsqlite3.0.dylib、libz.dylib和dylib1.o，像下面这么写就可以了：</p>

<div class="highlighter-rouge"><pre class="highlight"><code>projectBy3code_LDFLAGS = -lz –lsqlite3.0 –dylib1.o
</code></pre>
</div>

<p>稍后还有一个字段需要介绍，但一般来说，Makefile中定义了以上字段就已经完全够用了；更详细的Makefile介绍，可以参阅<a href="http://www.gnu.org/software/make/manual/html_node/Makefiles.html">http://www.gnu.org/software/make/manual/html_node/Makefiles.html</a></p>


                </div>
                <div class="read-all">
                    <a  href="/2016/11/04/3_Theos_-fourFile/"><i class="fa fa-newspaper-o"></i>Read All</a>
                </div>
                <hr>
              </li>
            
              <li>
                <h2>
                  <a class="post-link" href="/2016/11/02/2_Theos_-install&run/">iOS逆向系列2_Theos_安装编译打包运行</a>
                </h2>
                <div class="label">
                    <div class="label-card">
                        <i class="fa fa-calendar"></i>2016-11-02
                    </div>
                    <div class="label-card">
                        <i class="fa fa-user"></i>3行代码
                        
                    </div>
                    <div class="label-card">
                        
                    </div>

                    <div class="label-card">
                    


<!-- <span class="point">•</span> -->
<span class="categories">
  <i class="fa fa-th-list"></i>
  
    
        <a href="/category/#Reverse" title="Category: Reverse" rel="category">Reverse</a>
    
  

  <!-- <span class="point">•</span> -->
</span>


                    </div>

                    <div class="label-card">
                    
<!-- <span class="point">•</span> -->
<span class="pageTag">
  <i class="fa fa-tags"></i>
  
    
        <a href="/tag/#Theos" title="Tag: Theos" rel="tag">Theos</a>
    
  

</span>

                    </div>
                </div>
                <div class="excerpt">
                    <ul id="markdown-toc">
  <li><a href="#section" id="markdown-toc-section">1、说明</a></li>
  <li><a href="#theos" id="markdown-toc-theos">2、Theos简介</a></li>
  <li><a href="#theos-1" id="markdown-toc-theos-1">3、安装Theos</a></li>
</ul>

<p><strong>待整理</strong></p>

<p>在iosOpenDev之前，很多ios插件都使用theos编译开发，现在使用theos开发的人也不在少数。theos 有自己的模板用于开发一系列的插件程序，所以在早期开发的插件中基本上都是使用theos。</p>

<h2 id="section">1、说明</h2>
<p>使用theos创建工程：projectBy3code。文件夹内有四个文件：
projectBy3code.plist、Makefile、Tweak.xm、control 下面分别介绍这四个文件</p>

<p>参考教程：</p>

<p>Logos 语法
<a href="http://iphonedevwiki.net/index.php/Logos">http://iphonedevwiki.net/index.php/Logos</a></p>

<p>Makefile
<a href="http://www.gnu.org/software/make/manual/html_node/Makefiles.html">http://www.gnu.org/software/make/manual/html_node/Makefiles.html</a></p>

<p>debian的官网
<a href="http://www.debian.org/doc/debian-policy/ch-controlfields.html">http://www.debian.org/doc/debian-policy/ch-controlfields.html</a></p>

<p>debian:
<a href="http://www.debian.org/doc/debian-policy">http://www.debian.org/doc/debian-policy</a></p>

<p>Theos安装:
<a href="https://github.com/theos/theos/wiki/Installation">https://github.com/theos/theos/wiki/Installation</a></p>

<h2 id="theos">2、Theos简介</h2>

<p>Theos是一个越狱开发工具包，由iOS越狱界知名人士Dustin Howett 开发并分享到GitHub上。Theos与其他越狱开发工具相比，最大的特点就是简单：下载安装简单、Logos语法简单、编译发布简单，可以让使用者把精力都放在开发工作上去。</p>

<p>值得一提的是，越狱开发中常用的另一工具iOSOpenDev是整合在Xcode里的，熟悉Xcode的朋友可能会对它更感兴趣。但逆向工程接触底层知识较多，很多东西无法自动化，因此推荐使用整合度并不算高的Theos，当你手动完成一个又一个练习时，对逆向工程的理解一定会更深。</p>

<p><strong>下文与theos相关的内容，最好以官方为准，内容都在不断的更新中。比如安装这块，可以参考https://github.com/theos/theos/wiki/Installation</strong></p>

<p><strong>其实很多的问题，与其百度google，不如直接查看Issues，不少问题在里面都有靠谱的答案</strong></p>

<h2 id="theos-1">3、安装Theos</h2>

<p>首先需要的环境和工具如下：</p>

<ul>
  <li>curl</li>
  <li>git</li>
  <li>make</li>
  <li>openssh</li>
  <li>perl</li>
  <li>rsync</li>
  <li>dpkg (port or homebrew install on Mac OS X)</li>
  <li>python (if on Windows)</li>
</ul>

<p>没有的就用 brew install **</p>


                </div>
                <div class="read-all">
                    <a  href="/2016/11/02/2_Theos_-install&run/"><i class="fa fa-newspaper-o"></i>Read All</a>
                </div>
                <hr>
              </li>
            
              <li>
                <h2>
                  <a class="post-link" href="/2016/11/02/1_Class_dump/">iOS逆向系列1_Class_dump</a>
                </h2>
                <div class="label">
                    <div class="label-card">
                        <i class="fa fa-calendar"></i>2016-11-02
                    </div>
                    <div class="label-card">
                        <i class="fa fa-user"></i>3行代码
                        
                    </div>
                    <div class="label-card">
                        
                    </div>

                    <div class="label-card">
                    


<!-- <span class="point">•</span> -->
<span class="categories">
  <i class="fa fa-th-list"></i>
  
    
        <a href="/category/#Reverse" title="Category: Reverse" rel="category">Reverse</a>
    
  

  <!-- <span class="point">•</span> -->
</span>


                    </div>

                    <div class="label-card">
                    
<!-- <span class="point">•</span> -->
<span class="pageTag">
  <i class="fa fa-tags"></i>
  
    
        <a href="/tag/#class_dump" title="Tag: class_dump" rel="tag">class_dump</a>
    
  

</span>

                    </div>
                </div>
                <div class="excerpt">
                    <ul id="markdown-toc">
  <li><a href="#section" id="markdown-toc-section">1、概述</a></li>
  <li><a href="#section-1" id="markdown-toc-section-1">2、安装</a>    <ul>
      <li><a href="#section-2" id="markdown-toc-section-2">2.1 设置环境变量:</a></li>
    </ul>
  </li>
</ul>

<p><strong>待整理</strong></p>

<h2 id="section">1、概述</h2>

<p>class-dump，顾名思义，就是用来dump目标对象的class信息的工具。它利用Objective-C语言的runtime特性，将存储在Mach-O文件中的头文件信息提取出来，并生成对应的.h文件。</p>

<h2 id="section-1">2、安装</h2>

<p>class-dump的用法比较简单，首先去<a href="http://stevenygard.com/projects/class-dump">http://stevenygard.com/projects/class-dump</a>下载最新版的class-dump。</p>

<p>然后操作如下：</p>

<h5 id="section-2">2.1 设置环境变量:</h5>

<ul>
  <li>
    <p>打开Terminal，输入$mkdir ~/bin，在当前用户根目录下创建一个bin目录；</p>
  </li>
  <li>
    <p>把class-dump给拷贝到这个目录里，并赋予其可执行权限：$ mv /path/to/class-dump ~/bin $chmod +x ~/bin/class-dump；</p>
  </li>
  <li>
    <p>打开~/.bash_profile文件：$vi ~/.bash_profile，在文件最上方加一行：export PATH=$HOME/bin/:$PATH，然后保存并退出（在英文输入法中依次按下esc和:（shift + ;，即冒号），然后输入wq，回车即可）；</p>
  </li>
  <li>
    <p>在Terminal中执行$source ~/.bash_profile；</p>
  </li>
  <li>
    <p>上面的操作把~/bin路径给加入了环境变量.之后，就可以正常使用了。</p>
  </li>
  <li>
    <p>class-dump的对象是Mach-O格式的二进制文件，如Framework的库文件和App的可执行文件。</p>
  </li>
</ul>

<p>下面以支付宝为例，来看看class-dump的完整流程。</p>

<p>1.定位App的可执行文件</p>

<p>首先把带class-dump的App拷贝到OSX中，笔者放在了“/Users/Test ”下。然后在Terminal中进入App所在的目录，并用Xcode自带的plutil工具查看Info.plist中的“CFBundleExecutable”字段，如下：</p>

<div class="highlighter-rouge"><pre class="highlight"><code>$ cd /Users/Test/AlipayWallet9.9.5_/Payload/AlipayWallet.app
$ plutil -p Info.plist | grep CFBundleExecutable
"CFBundleExecutable" =&gt; "AlipayWallet"
</code></pre>
</div>

<p>当前目录下的“AlipayWallet”就是App的可执行文件。</p>

<p>2.class-dump可执行文件</p>

<p>把AlipayWallet的头文件class-dump到“/Users/Test/TEST/Header”下，并将头文件内容按名字排序，命令如下：</p>

<div class="highlighter-rouge"><pre class="highlight"><code>$ class-dump -S -s -H AlipayWallet -o /Users/Test/TEST/Header
</code></pre>
</div>

<p>结果是：
-APPstore里面的app都只有一个文件：CDStructures.h 而且里面是空的(appstore处理过)
-【直接使用xcode打包的我们自己的ipa】头文件基本全部都展示出来了</p>

<p>透过这些头文件，闭源App的程序架构就能初现端倪了，经验丰富的开发人员可以从中了解非常多的信息，这些信息是iOS逆向工程的基础。不过现在的App工程越来越大，而且还在不停地引用第三方代码，因此经常会发现class-dump出来了成百上千个头文件，虽然靠人工及经验一点点地分析是很好的练习方式，但过程实在太复杂，让人头大。在后面的章节，将通过各种工具逐步缩小目标范围，最后精准地定位目标函数。</p>

<p>值得注意的是，从AppStore下载的App都是经过加密的，可执行文件被加上了一层“壳”，就像是一颗硬硬的核桃，class-dump应付不了这样的文件。你想想，我们试图用class-dump这样一个镊子来取肉，别说解馋，没把镊子夹坏就算不错啦！此时使用class-dump看上去会“失效”。</p>


                </div>
                <div class="read-all">
                    <a  href="/2016/11/02/1_Class_dump/"><i class="fa fa-newspaper-o"></i>Read All</a>
                </div>
                <hr>
              </li>
            
              <li>
                <h2>
                  <a class="post-link" href="/2016/11/01/0_Reverse_Enginner/">iOS逆向系列_综述</a>
                </h2>
                <div class="label">
                    <div class="label-card">
                        <i class="fa fa-calendar"></i>2016-11-01
                    </div>
                    <div class="label-card">
                        <i class="fa fa-user"></i>3行代码
                        
                    </div>
                    <div class="label-card">
                        
                    </div>

                    <div class="label-card">
                    


<!-- <span class="point">•</span> -->
<span class="categories">
  <i class="fa fa-th-list"></i>
  
    
        <a href="/category/#Reverse" title="Category: Reverse" rel="category">Reverse</a>
    
  

  <!-- <span class="point">•</span> -->
</span>


                    </div>

                    <div class="label-card">
                    
<!-- <span class="point">•</span> -->
<span class="pageTag">
  <i class="fa fa-tags"></i>
  
    
        <a href="/tag/#iOS逆向" title="Tag: iOS逆向" rel="tag">iOS逆向</a>
    
  

</span>

                    </div>
                </div>
                <div class="excerpt">
                    <ul id="markdown-toc">
  <li><a href="#section" id="markdown-toc-section">前言</a></li>
  <li><a href="#section-1" id="markdown-toc-section-1">1、概述</a>    <ul>
      <li><a href="#section-2" id="markdown-toc-section-2">1.1、逆向分为 系统分析+代码分析：</a></li>
      <li><a href="#section-3" id="markdown-toc-section-3">1.2、分析工具：</a></li>
    </ul>
  </li>
</ul>

<h2 id="section">前言</h2>

<p><strong>待整理</strong></p>

<p>未越狱的iOS是个封闭的黑盒子，直到evad3rs、盘古、太极等团队把iOS越狱之后，这个黑盒子才被打开，神秘的iOS得以完整地展现在我们面前。</p>

<p>因为权限极低，来自App Store的普通App（以下简称StoreApp）不能访问自身目录以外的绝大多数文件。而iOS一旦越狱，来自Cydia的App就可以拥有比StoreApp更高的权限，从而访问全系统文件；来自Cydia的iFile即是iOS上一个老牌的第三方文件管理App。</p>

<p>iOS逆向工程，主要作用是：</p>

<p>1、借鉴他人app:想开发IM类APP可以根据竞争对手选择去逆向哪一家的APP，然对手的app整体构架和设计思路对于我们的开发是很有益处的。</p>

<p>2、安全等级鉴定:通过逆向去判别一款软件的安全等级。</p>

<h2 id="section-1">1、概述</h2>

<h5 id="section-2">1.1、逆向分为 系统分析+代码分析：</h5>

<p>1.1.1 系统分析：</p>

<p>要从整体上观察目标程序的行为特征、文件的组织架构、设计思路，从而为我们做代码分析做准备。</p>

<p>1.1.2 二进制代码分析：</p>

<p>进入代码分析阶段，则要把软件的核心代码还原出来，最终达到我们的目的。</p>

<p>1.1.3</p>

<p>通过逆向工程，可以推导出某个App的设计思路、内部算法和实现细节，但这是一个非常复杂的过程，可以说是一种解构再重组的艺术。想让自己的逆向工程水平达到艺术的高度，需要对软件开发、硬件原理和iOS系统有透彻的理解。</p>

<h5 id="section-3">1.2、分析工具：</h5>

<p>相对于正向开发，逆向工程使用的工具并不那么“智能”，很多工作需要我们手工完成。只有对工具的熟练使用，才能够极大地提高逆向工程的效率。iOS逆向工程的工具可以分为四大类：监测工具、反汇编工具（disassembler）、调试工具（debugger）,以及开发工具 。</p>

<p>1.2.1 监测工具</p>

<p>在iOS逆向工程中，起到嗅探、监测、记录目标程序行为的工具统称为监测工具。这些工具通常可以记录并显示目标程序的某些操作，如UI变化、网络活动、文件访问等。iOS逆向常用的监测工具有Reveal(UI变化)、snoop-it、introspy等。</p>

<p>1.2.2 反汇编工具</p>

<p>从UI层面切入代码层面后，就要用到反汇编工具来梳理代码了。反汇编工具把二进制文件作为输入，经过处理后输出这个文件的汇编代码；在iOS逆向工程中，常用的反汇编工具主要是IDA和Hopper。
作为老牌反汇编工具，IDA是逆向工程中最常用的利器之一。它支持Windows、Linux、OSX平台和多种处理器架构。Hopper是一款近年面世的反汇编工具，它主要针对的是苹果系操作系统。下文主要使用IDA</p>

<p>1.2.3 调试工具</p>

<p>iOS开发者对调试工具应该不陌生，在App开发中，少不了在Xcode中调试代码。我们可以在某一行代码上设置断点，使进程能够停止在那一行代码上，并实时显示进程当前的状态。在iOS逆向工程中，用到的调试工具主要是LLDB。</p>

<p>1.2.4 开发工具</p>

<p>从UI层面切入代码层面，用反汇编工具和调试工具分析过二进制文件后，就可以整理分析结果，用开发工具写程序了。对于App开发者来说，Xcode是最常用的开发工具。但是我们一旦将战场从AppStore转移到越狱iOS，开发工具的种类就得到了扩充，不但有基于Xcode的iOSOpenDev，还有偏命令行的Theos。从个人体验来说，Theos是让笔者最为兴奋的开发工具，在知道Theos之前，笔者感觉自己一直都被限制在AppStore中，直到掌握了Theos的用法，才突破了AppStore，完整地认识了整个iOS系统。这里主要以Theos作为开发工具 。</p>

<p>之后系列文章将按照如下的几大块来进行：</p>

<p>OSX 工具集：dump、Theos、Reveal、IDA、iFunBox、dyld_decache</p>

<p>IOS 工具集：CydiaSubstrate、Cycript、LLDB与debugserver、dumpdecrypted、OpenSSH、usbmuxd、iFile、MTerminal、syslogd to/var/log/syslog</p>

<p>理论篇：OC理论基础、ARM汇编相关的理论基础、</p>

<p>实战篇：</p>


                </div>
                <div class="read-all">
                    <a  href="/2016/11/01/0_Reverse_Enginner/"><i class="fa fa-newspaper-o"></i>Read All</a>
                </div>
                <hr>
              </li>
            
        </ul>



        <!-- Pagination links -->
        <div class="pagination">
          
            <a href="/index.html" class="previous"><i class="fa fa-angle-double-left"></i></a>
            <a href="/page3" class="previous"><i class="fa fa-angle-left"></i></a>
          
          <span class="page_number ">4/7</span>
          
            <a href="/page5" class="next"><i class="fa fa-angle-right"></i></a>
            <a href="/page7" class="next"><i class="fa fa-angle-double-right"></i></a>
          
        </div>
    </div>
    <!-- <button class="anchor"><i class="fa fa-anchor"></i></button> -->
    <div class="right">
        <div class="wrap">
            <div class="side">
                <div>
                    <i class="fa fa-pencil-square-o" aria-hidden="true"></i>
                    最新文章
                </div>
                <ul class="content-ul" recent>
                    
                        <li><a href="/2017/02/08/AD-jenkins/"> 持续集成系列 - CI + Jenkins的魔法世界</a></li>
                    
                        <li><a href="/2017/02/07/AD-Fastlane/"> 持续集成系列 - Fastlane的黑魔法:自动打包编译上传 AppStore</a></li>
                    
                        <li><a href="/2017/01/23/AD-XCTest/">持续集成系列 - 测试: XCTest</a></li>
                    
                        <li><a href="/2017/01/13/Travis-CI/">持续集成系列 - Github中的魔法工具:Travis CI</a></li>
                    
                        <li><a href="/2017/01/08/SDiffuseMenu/">Swift 版 AwesomeMenu 的改写之旅:SDiffuseMenu</a></li>
                    
                        <li><a href="/2016/12/11/swift_X_Initialization_Deinitialization/">Swift3.0_X_构造过程和析构过程 </a></li>
                    
                        <li><a href="/2016/12/10/swift_IX_Methods_Subscripts_Inheritance/">Swift3.0_IX_方法、下标和继承 </a></li>
                    
                        <li><a href="/2016/12/08/swift_VIII_Enumerations_Classes_Structures_Properties/">Swift3.0_VIII_枚举、类、结构体、属性</a></li>
                    
                        <li><a href="/2016/12/07/swift_VII_Closures/">Swift3.0_VII_闭包</a></li>
                    
                        <li><a href="/2016/12/05/swift_VI_Functions/">Swift3.0_VI_函数</a></li>
                    
                </ul>
            </div>

            <!-- Content -->
            <div class="side ">
                <div>
                    <i class="fa fa-th-list"></i>
                    分类
                </div>
                <ul class="content-ul" cate>
                    
                    <li>
                        <a href="/category/#OS_X" class="categories-list-item" cate="OS_X">
                            <span class="name">
                                OS_X
                            </span>
                            <span class="badge">2</span>
                        </a>
                    </li>
                    
                    <li>
                        <a href="/category/#Objective-C" class="categories-list-item" cate="Objective-C">
                            <span class="name">
                                Objective-C
                            </span>
                            <span class="badge">5</span>
                        </a>
                    </li>
                    
                    <li>
                        <a href="/category/#Reverse" class="categories-list-item" cate="Reverse">
                            <span class="name">
                                Reverse
                            </span>
                            <span class="badge">9</span>
                        </a>
                    </li>
                    
                    <li>
                        <a href="/category/#AD" class="categories-list-item" cate="AD">
                            <span class="name">
                                AD
                            </span>
                            <span class="badge">4</span>
                        </a>
                    </li>
                    
                    <li>
                        <a href="/category/#tips" class="categories-list-item" cate="tips">
                            <span class="name">
                                tips
                            </span>
                            <span class="badge">1</span>
                        </a>
                    </li>
                    
                    <li>
                        <a href="/category/#python" class="categories-list-item" cate="python">
                            <span class="name">
                                python
                            </span>
                            <span class="badge">1</span>
                        </a>
                    </li>
                    
                    <li>
                        <a href="/category/#Swift3.0" class="categories-list-item" cate="Swift3.0">
                            <span class="name">
                                Swift3.0
                            </span>
                            <span class="badge">11</span>
                        </a>
                    </li>
                    
                    <li>
                        <a href="/category/#CI" class="categories-list-item" cate="CI">
                            <span class="name">
                                CI
                            </span>
                            <span class="badge">4</span>
                        </a>
                    </li>
                    
                </ul>
            </div>
            <!-- 其他div框放到这里 -->
            <div class="side">
                <div>
                    <i class="fa fa-tags"></i>
                    Tags
                </div>
                <div class="tags-cloud">
                    
                    
                    
                    

                    

                    
                      
                      
                      
                      
                      
                      <a href="/tag/#apache" style="font-size: 9pt; color: #999;">apache</a>
                    
                      
                      
                      
                      
                      
                      <a href="/tag/#WKWebView、Native与JS、缓存、NSURLProtocol" style="font-size: 9pt; color: #999;">WKWebView、Native与JS、缓存、NSURLProtocol</a>
                    
                      
                      
                      
                      
                      
                      <a href="/tag/#Charles" style="font-size: 9pt; color: #999;">Charles</a>
                    
                      
                      
                      
                      
                      
                      <a href="/tag/#Reveal" style="font-size: 9pt; color: #999;">Reveal</a>
                    
                      
                      
                      
                      
                      
                      <a href="/tag/#iOSOpenDev" style="font-size: 9pt; color: #999;">iOSOpenDev</a>
                    
                      
                      
                      
                      
                      
                      <a href="/tag/#block" style="font-size: 9pt; color: #999;">block</a>
                    
                      
                      
                      
                      
                      
                      <a href="/tag/#NSURLProtocol" style="font-size: 9pt; color: #999;">NSURLProtocol</a>
                    
                      
                      
                      
                      
                      
                      <a href="/tag/#缓存" style="font-size: 10pt; color: #888;">缓存</a>
                    
                      
                      
                      
                      
                      
                      <a href="/tag/#NSURLCache" style="font-size: 9pt; color: #999;">NSURLCache</a>
                    
                      
                      
                      
                      
                      
                      <a href="/tag/#SecureCRT" style="font-size: 9pt; color: #999;">SecureCRT</a>
                    
                      
                      
                      
                      
                      
                      <a href="/tag/#博客" style="font-size: 9pt; color: #999;">博客</a>
                    
                      
                      
                      
                      
                      
                      <a href="/tag/#jekyll" style="font-size: 9pt; color: #999;">jekyll</a>
                    
                      
                      
                      
                      
                      
                      <a href="/tag/#sublime" style="font-size: 9pt; color: #999;">sublime</a>
                    
                      
                      
                      
                      
                      
                      <a href="/tag/#环境变量" style="font-size: 9pt; color: #999;">环境变量</a>
                    
                      
                      
                      
                      
                      
                      <a href="/tag/#mac_tips" style="font-size: 9pt; color: #999;">mac_tips</a>
                    
                      
                      
                      
                      
                      
                      <a href="/tag/#Sublime" style="font-size: 10pt; color: #888;">Sublime</a>
                    
                      
                      
                      
                      
                      
                      <a href="/tag/#iOS逆向" style="font-size: 9pt; color: #999;">iOS逆向</a>
                    
                      
                      
                      
                      
                      
                      <a href="/tag/#class_dump" style="font-size: 9pt; color: #999;">class_dump</a>
                    
                      
                      
                      
                      
                      
                      <a href="/tag/#Theos" style="font-size: 10pt; color: #888;">Theos</a>
                    
                      
                      
                      
                      
                      
                      <a href="/tag/#Logos" style="font-size: 9pt; color: #999;">Logos</a>
                    
                      
                      
                      
                      
                      
                      <a href="/tag/#iOS基础" style="font-size: 9pt; color: #999;">iOS基础</a>
                    
                      
                      
                      
                      
                      
                      <a href="/tag/#IDA、iFunBox、dyld_decache" style="font-size: 9pt; color: #999;">IDA、iFunBox、dyld_decache</a>
                    
                      
                      
                      
                      
                      
                      <a href="/tag/#iOS逆向工具集" style="font-size: 9pt; color: #999;">iOS逆向工具集</a>
                    
                      
                      
                      
                      
                      
                      <a href="/tag/#iOS逆向理论基础" style="font-size: 9pt; color: #999;">iOS逆向理论基础</a>
                    
                      
                      
                      
                      
                      
                      <a href="/tag/#脚本" style="font-size: 9pt; color: #999;">脚本</a>
                    
                      
                      
                      
                      
                      
                      <a href="/tag/#python" style="font-size: 9pt; color: #999;">python</a>
                    
                      
                      
                      
                      
                      
                      <a href="/tag/#Swift3.0" style="font-size: 18pt; color: #000;">Swift3.0</a>
                    
                      
                      
                      
                      
                      
                      <a href="/tag/#SDiffuseMenu" style="font-size: 9pt; color: #999;">SDiffuseMenu</a>
                    
                      
                      
                      
                      
                      
                      <a href="/tag/#Animation" style="font-size: 9pt; color: #999;">Animation</a>
                    
                      
                      
                      
                      
                      
                      <a href="/tag/#Github" style="font-size: 9pt; color: #999;">Github</a>
                    
                      
                      
                      
                      
                      
                      <a href="/tag/#Travis-CI" style="font-size: 9pt; color: #999;">Travis-CI</a>
                    
                      
                      
                      
                      
                      
                      <a href="/tag/#XCTest" style="font-size: 9pt; color: #999;">XCTest</a>
                    
                      
                      
                      
                      
                      
                      <a href="/tag/#fastlane" style="font-size: 10pt; color: #888;">fastlane</a>
                    
                      
                      
                      
                      
                      
                      <a href="/tag/#CI" style="font-size: 9pt; color: #999;">CI</a>
                    
                </div>
            </div>

            <!-- <div class="side">
                <div>
                    <i class="fa fa-external-link"></i>
                    Links
                </div>
                <ul  class="content-ul">

                </ul>
            </div> -->
        </div>
    </div>
</div>
<!-- <script src="/js/scroll.min.js " charset="utf-8"></script> -->
<!-- <script src="/js/pageContent.js " charset="utf-8"></script> -->


    <footer class="site-footer">


    <div class="wrapper">

        <p class="description">
             3行代码的技术博客 
        </p>
        <p class="contact">
            Contact me at:  
            <a href="mailto:mythziven@gmail.com" title="email"><i class="fa fa-envelope-o" aria-hidden="true"></i></a>   -->
<!--            <a href="mailto:mythziven@gmail.com" title="email"><i class="fa fa-envelope-o" aria-hidden="true"></i></a>-->
<!--            <a href="mailto:mythziven@gmail.com" title="email"><i class="fa fa-envelope-o" aria-hidden="true"></i></a>        -->


        </p>
        <p>
            本站总访问量<span id="busuanzi_value_site_pv"></span>次，本站访客数<span id="busuanzi_value_site_uv"></span>人次，本文总阅读量<span id="busuanzi_value_page_pv"></span>次
        </p>
        <p class="power">
        
            <span>
                Site powered by <a href="https://jekyllrb.com/">Jekyll</a> & <a href="https://pages.github.com/">Github Pages</a>.
            </span>

          <!--   <span>
                Theme designed by <a href="https://github.com/mythkiven">MyKiven</a>.
            </span> -->

        </p>
    </div>
</footer>
<script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>

    <div class="back-to-top">
    <a href="#top" class="scroll">
        <i class="fa fa-arrow-up" aria-hidden="true"></i>
    </a>
</div>

    <script src=" /js/main.js " charset="utf-8"></script>
    <script src=" /js/scroll.min.js " charset="utf-8"></script>
  </body>

</html>
