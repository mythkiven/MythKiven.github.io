<!DOCTYPE html>
<html>

  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <title>3行代码</title>
    <meta name="description" content="">

    <link rel="shortcut icon" href="/favicon.ico?" type="image/x-icon">
    <link rel="icon" href="/favicon.ico?" type="image/x-icon">
    <link rel="stylesheet" href="/css/fontawesome/css/font-awesome.min.css ">
    <link rel="stylesheet" href="/css/main.css ">
    <link rel="canonical" href="http://localhost:4000/page5/">
    <link rel="alternate" type="application/rss+xml" title="3行代码" href="http://localhost:4000/feed.xml ">


<script>
    // 百度统计代码
    var _hmt = _hmt || [];
    (function() {
     var hm = document.createElement("script");
     hm.src = "//hm.baidu.com/hm.js?d9432112fb859bf7276f8399641fb0c5";
     var s = document.getElementsByTagName("script")[0];
     s.parentNode.insertBefore(hm, s);
     })();
    </script>




    <script>
    // google analytics
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-85978943-1', 'auto');
      ga('send', 'pageview');

    </script>

</head>


  <body>

    <header id="top">
    <div class="wrapper">
        <a href="/" class="brand">3行代码</a>
        <small>技术博客</small>
        <button id="headerMenu" class="menu"><i class="fa fa-bars"></i></button>
        <nav id="headerNav">
            <ul>
                
                <li>
                    
                    <a href="/">
                    
                        <i class="fa fa-home"></i>Home
                    </a>
                </li>


                
                    
                    <li>
                        
                        <a href="/archive/">
                        
                            <i class="fa fa-archive"></i>Archives
                        </a>
                    </li>
                    
                
                    
                    <li>
                        
                        <a href="/category/">
                        
                            <i class="fa fa-th-list"></i>Categories
                        </a>
                    </li>
                    
                
                    
                    <li>
                        
                        <a href="/tag/">
                        
                            <i class="fa fa-tags"></i>Tags
                        </a>
                    </li>
                    
                
                    
                    <li>
                        
                        <a href="/collection/">
                        
                            <i class="fa fa-bookmark"></i>Collections
                        </a>
                    </li>
                    
                
                    
                    <li>
                        
                        <a href="/about/">
                        
                            <i class="fa fa-heart"></i>About
                        </a>
                    </li>
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
            </ul>
        </nav>
    </div>
</header>


        <div class="page clearfix" index>
    <div class="left">
        <h1>Welcome to 3code.info!</h1>
        <small>记录生活</small>
        <hr>
        <ul>
            
              <li>
                <h2>
                  <a class="post-link" href="/2016/05/18/tree/">使用 tree 形展示目录结构</a>
                </h2>
                <div class="label">
                    <div class="label-card">
                        <i class="fa fa-calendar"></i>2016-05-18
                    </div>
                    <div class="label-card">
                        <i class="fa fa-user"></i>3行代码
                        
                    </div>
                    <div class="label-card">
                        
                    </div>

                    <div class="label-card">
                    


<!-- <span class="point">•</span> -->
<span class="categories">
  <i class="fa fa-th-list"></i>
  
    
        <a href="/category/#tips" title="Category: tips" rel="category">tips</a>
    
  

  <!-- <span class="point">•</span> -->
</span>


                    </div>

                    <div class="label-card">
                    
<!-- <span class="point">•</span> -->
<span class="pageTag">
  <i class="fa fa-tags"></i>
  
    
        <a href="/tag/#mac_tips" title="Tag: mac_tips" rel="tag">mac_tips</a>
    
  

</span>

                    </div>
                </div>
                <div class="excerpt">
                    
<p>其实也蛮简单的,一行命令即可:</p>

<div class="language-c highlighter-rouge"><pre class="highlight"><code><span class="n">find</span> <span class="p">.</span> <span class="o">-</span><span class="n">print</span> <span class="o">|</span> <span class="n">sed</span> <span class="o">-</span><span class="n">e</span> <span class="err">'</span><span class="n">s</span><span class="p">;[</span><span class="o">^/</span><span class="p">]</span><span class="err">*/</span><span class="p">;</span><span class="o">|</span><span class="n">____</span><span class="p">;</span><span class="n">g</span><span class="p">;</span><span class="n">s</span><span class="p">;</span><span class="n">____</span><span class="o">|</span><span class="p">;</span> <span class="o">|</span><span class="p">;</span><span class="n">g</span><span class="err">'</span>
</code></pre>
</div>

<p>但是每次都这么输,就有点吃力,最好是简化为使用一个命令, tree 即可达到一行命令的效果.</p>

<p>也就是使用别名的形式:使用  alias 指定别名的方法</p>


                </div>
                <div class="read-all">
                    <a  href="/2016/05/18/tree/"><i class="fa fa-newspaper-o"></i>Read All</a>
                </div>
                <hr>
              </li>
            
              <li>
                <h2>
                  <a class="post-link" href="/2016/04/30/deployEnvironmentVariable/">OS X 部署环境变量</a>
                </h2>
                <div class="label">
                    <div class="label-card">
                        <i class="fa fa-calendar"></i>2016-04-30
                    </div>
                    <div class="label-card">
                        <i class="fa fa-user"></i>3code
                        
                    </div>
                    <div class="label-card">
                        
                    </div>

                    <div class="label-card">
                    


<!-- <span class="point">•</span> -->
<span class="categories">
  <i class="fa fa-th-list"></i>
  
    
        <a href="/category/#OS_X" title="Category: OS_X" rel="category">OS_X</a>
    
  

  <!-- <span class="point">•</span> -->
</span>


                    </div>

                    <div class="label-card">
                    
<!-- <span class="point">•</span> -->
<span class="pageTag">
  <i class="fa fa-tags"></i>
  
    
        <a href="/tag/#sublime" title="Tag: sublime" rel="tag">sublime</a>&nbsp;
    
        <a href="/tag/#环境变量" title="Tag: 环境变量" rel="tag">环境变量</a>
    
  

</span>

                    </div>
                </div>
                <div class="excerpt">
                    <ul id="markdown-toc">
  <li><a href="#section" id="markdown-toc-section">1、设置环境变量</a>    <ul>
      <li><a href="#shell" id="markdown-toc-shell">1.1 查看本机使用的Shell</a></li>
      <li><a href="#mac" id="markdown-toc-mac">1.2 Mac可配置环境变量的位置</a></li>
      <li><a href="#path" id="markdown-toc-path">1.3 设置PATH的语法：</a></li>
    </ul>
  </li>
  <li><a href="#sublime" id="markdown-toc-sublime">2、实战 配置sublime的环境变量</a></li>
</ul>

<h2 id="section">1、设置环境变量</h2>

<h5 id="shell">1.1 查看本机使用的Shell</h5>

<div class="highlighter-rouge"><pre class="highlight"><code>$ echo $SHELL
# 输出的是：csh或者是tcsh，就是C Shell。
# 输出的是：bash，sh，zsh，就是Bourne Shell的一个变种。
</code></pre>
</div>
<p>如果是Bourne Shell。
那么你可以把你要添加的环境变量添加到你主目录下面的.profile或者.bash_profile，如果存在没有关系添加进去即可，如果没有生成一个。</p>

<h5 id="mac">1.2 Mac可配置环境变量的位置</h5>

<p>Mac系统的环境变量，加载顺序为：</p>

<ul>
  <li>1、/etc/profile 全局公有配置，系统级别启动加载。【不建议修改】</li>
  <li>2、/etc/paths 可以全局修改配置，系统级别启动加载。添加path一行一个路径</li>
</ul>

<p>以上不管是哪个用户，登录时都会读取该文件。下面几个是当前用户级的环境变量，按照从前往后的顺序读取。如果~/.bash_profile文件存在，则后面的几个文件就会被忽略不读了，如果~/.bash_profile文件不存在，才会以此类推读取后面的文件</p>

<ul>
  <li>3、~/.bash_profile  一般在这个文件中添加用户级环境变量。每个用户都可使用该文件输入专用于自己使用的shell信息,当用户登录时,该文件仅仅执行一次!</li>
  <li>4、~/.bash_login</li>
  <li>5、~/.profile</li>
</ul>

<p>其他：</p>

<ul>
  <li>~/.bashrc没有上述规则，它是bash shell打开的时候载入的。</li>
  <li>/etc/bashrc 一般在这个文件中添加系统级环境变量，全局（公有）配置，bash shell执行时，不管是何种方式，都会读取此文件。</li>
</ul>

<h5 id="path">1.3 设置PATH的语法：</h5>

<div class="highlighter-rouge"><pre class="highlight"><code>export PATH=$PATH:&lt;PATH 1&gt;:&lt;PATH 2&gt;:&lt;PATH 3&gt;:------:&lt;PATH N&gt;
</code></pre>
</div>

<h2 id="sublime">2、实战 配置sublime的环境变量</h2>

<p>如果是sublime 2 则应该通过下面命令可以打开subl:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>$ open /Applications/Sublime\ Text\ 2.app/Contents/SharedSupport/bin/subl
</code></pre>
</div>

<p>然后我们在/usr/local/bin 里面做一个软连接：</p>

<div class="highlighter-rouge"><pre class="highlight"><code>$ ln -s /Applications/Sublime\ Text\ 2.app/Contents/SharedSupport/bin/subl /usr/local/bin/sublime
</code></pre>
</div>

<p>最后加入环境变量：</p>

<div class="highlighter-rouge"><pre class="highlight"><code>$ open ~/.bash_profile
# 添加如下代码：
export PATH=/usr/local/bin:$PATH
</code></pre>
</div>

<p>想立即生效请运行：</p>

<div class="highlighter-rouge"><pre class="highlight"><code>$ source ~/.bash_profile
</code></pre>
</div>
<p>OK，可以通过终端操控subl了！</p>

                </div>
                <div class="read-all">
                    <a  href="/2016/04/30/deployEnvironmentVariable/"><i class="fa fa-newspaper-o"></i>Read All</a>
                </div>
                <hr>
              </li>
            
              <li>
                <h2>
                  <a class="post-link" href="/2016/04/16/CreateAGithubBlog/">静态页面博客:jekyll+GitHubPages</a>
                </h2>
                <div class="label">
                    <div class="label-card">
                        <i class="fa fa-calendar"></i>2016-04-16
                    </div>
                    <div class="label-card">
                        <i class="fa fa-user"></i>3code
                        
                    </div>
                    <div class="label-card">
                        
                    </div>

                    <div class="label-card">
                    


<!-- <span class="point">•</span> -->
<span class="categories">
  <i class="fa fa-th-list"></i>
  
    
        <a href="/category/#AD" title="Category: AD" rel="category">AD</a>
    
  

  <!-- <span class="point">•</span> -->
</span>


                    </div>

                    <div class="label-card">
                    
<!-- <span class="point">•</span> -->
<span class="pageTag">
  <i class="fa fa-tags"></i>
  
    
        <a href="/tag/#博客" title="Tag: 博客" rel="tag">博客</a>&nbsp;
    
        <a href="/tag/#jekyll" title="Tag: jekyll" rel="tag">jekyll</a>
    
  

</span>

                    </div>
                </div>
                <div class="excerpt">
                    <ul id="markdown-toc">
  <li><a href="#section" id="markdown-toc-section">说明</a></li>
  <li><a href="#gitgithub" id="markdown-toc-gitgithub">1、git\github</a>    <ul>
      <li><a href="#github" id="markdown-toc-github">1.1 github知识普及：</a></li>
      <li><a href="#git" id="markdown-toc-git">1.2  注册下载Git客户端</a></li>
      <li><a href="#githubpages" id="markdown-toc-githubpages">1.3 在github上创建Pages：</a></li>
    </ul>
  </li>
</ul>

<p>前段时间一朋友想开个独立博客，问我有没有好的教程参考，以前弄博客时写过流程，这又重新整理了下发上来。Mac上想建博客的可以参考下。</p>

<p><img src="https://ooo.0o0.ooo/2016/10/21/5809801186a24.jpg" alt="" /></p>

<h2 id="section">说明</h2>
<p>1、以下系统基于OS X EI;</p>

<p>2、免费主机：github + 静态制作：jekyll</p>

<h2 id="gitgithub">1、git\github</h2>

<h4 id="github">1.1 github知识普及：</h4>

<p>githubPages 是基于github开源库的，所有博客的内容源码都是可以被其他人看到的，敏感数据不能放在pages上。在提交github时需要注意。</p>

<p>个人Pages页面 实际上是存在GitHubPages的开源库中，需要使用用户名来命名这个库，比如 mythkiven.github.io。可以在master分支上构建和发布你的 GitHub Pages 网页。通过Automatic Page Generator 可以自动的构建一个页面。当用户 Pages 构建完之后，打开http(s)://mythkiven.github.io就可以正常使用了。</p>

<h4 id="git">1.2  注册下载Git客户端</h4>

<p>注册Github账号；由于需要一个本地端来进行git操作，最好使用命令行，客户端的话推荐：SourceTree。或者用github自带的客户端。</p>

<h4 id="githubpages">1.3 在github上创建Pages：</h4>

<p><a href="https://pages.github.com/">参考官方页面提示</a></p>


                </div>
                <div class="read-all">
                    <a  href="/2016/04/16/CreateAGithubBlog/"><i class="fa fa-newspaper-o"></i>Read All</a>
                </div>
                <hr>
              </li>
            
              <li>
                <h2>
                  <a class="post-link" href="/2015/10/30/SecureCRT/">SecureCRT小教程</a>
                </h2>
                <div class="label">
                    <div class="label-card">
                        <i class="fa fa-calendar"></i>2015-10-30
                    </div>
                    <div class="label-card">
                        <i class="fa fa-user"></i>3行代码
                        
                    </div>
                    <div class="label-card">
                        
                    </div>

                    <div class="label-card">
                    


<!-- <span class="point">•</span> -->
<span class="categories">
  <i class="fa fa-th-list"></i>
  
    
        <a href="/category/#AD" title="Category: AD" rel="category">AD</a>
    
  

  <!-- <span class="point">•</span> -->
</span>


                    </div>

                    <div class="label-card">
                    
<!-- <span class="point">•</span> -->
<span class="pageTag">
  <i class="fa fa-tags"></i>
  
    
        <a href="/tag/#SecureCRT" title="Tag: SecureCRT" rel="tag">SecureCRT</a>
    
  

</span>

                    </div>
                </div>
                <div class="excerpt">
                    <ul id="markdown-toc">
  <li><a href="#section" id="markdown-toc-section">安装</a></li>
  <li><a href="#section-1" id="markdown-toc-section-1">配置</a></li>
  <li><a href="#section-2" id="markdown-toc-section-2">使用</a></li>
  <li><a href="#section-3" id="markdown-toc-section-3">后记</a></li>
</ul>

<p>在window上可以通过Xshell调试网络、查看服务器日志，在Mac上没有Xshell的，最好的替换方案就是：SecureCRT。</p>

<h4 id="section">安装</h4>

<p>google安装</p>

<h4 id="section-1">配置</h4>

<p>设置UTF8：
Options—&gt;session Options—&gt;Appearance 点选设置UTF8，如下图:</p>

<p><img src="https://ooo.0o0.ooo/2016/12/02/584148ea55d87.png" alt="" /></p>

<p>设置链接：
<img src="https://ooo.0o0.ooo/2016/12/02/584149554189b.png" alt="" />
<img src="https://ooo.0o0.ooo/2016/12/02/5841498e5ab3d.png" alt="" /></p>

<h4 id="section-2">使用</h4>

<p>和终端差不多，及时展示当前的请求日志(crt-root.log)使用命令：
 # tail -f crt-root.log</p>

<p>实际效果如下：可以及时查看服务器日志啦：</p>

<p><img src="https://ooo.0o0.ooo/2016/12/02/584149b24a478.png" alt="" /></p>

<h4 id="section-3">后记</h4>

<p>一个人开发真的很屌啊，所有的工具都会用。</p>


                </div>
                <div class="read-all">
                    <a  href="/2015/10/30/SecureCRT/"><i class="fa fa-newspaper-o"></i>Read All</a>
                </div>
                <hr>
              </li>
            
              <li>
                <h2>
                  <a class="post-link" href="/2015/10/15/NSURLCache/">NSURLCache缓存的那些事</a>
                </h2>
                <div class="label">
                    <div class="label-card">
                        <i class="fa fa-calendar"></i>2015-10-15
                    </div>
                    <div class="label-card">
                        <i class="fa fa-user"></i>3行代码
                        
                    </div>
                    <div class="label-card">
                        
                    </div>

                    <div class="label-card">
                    


<!-- <span class="point">•</span> -->
<span class="categories">
  <i class="fa fa-th-list"></i>
  
    
        <a href="/category/#Objective-C" title="Category: Objective-C" rel="category">Objective-C</a>
    
  

  <!-- <span class="point">•</span> -->
</span>


                    </div>

                    <div class="label-card">
                    
<!-- <span class="point">•</span> -->
<span class="pageTag">
  <i class="fa fa-tags"></i>
  
    
        <a href="/tag/#NSURLCache" title="Tag: NSURLCache" rel="tag">NSURLCache</a>&nbsp;
    
        <a href="/tag/#缓存" title="Tag: 缓存" rel="tag">缓存</a>
    
  

</span>

                    </div>
                </div>
                <div class="excerpt">
                    <ul id="markdown-toc">
  <li><a href="#section" id="markdown-toc-section">基础篇</a>    <ul>
      <li><a href="#section-1" id="markdown-toc-section-1">1、扫盲普及</a></li>
      <li><a href="#get-" id="markdown-toc-get-">2、基础：GET 缓存</a></li>
      <li><a href="#post-" id="markdown-toc-post-">3、进阶：POST 缓存</a></li>
      <li><a href="#nsurlcache" id="markdown-toc-nsurlcache">4、进阶：自定义缓存策略的NSURLCache</a></li>
    </ul>
  </li>
  <li><a href="#section-2" id="markdown-toc-section-2">进阶篇</a>    <ul>
      <li><a href="#useprotocolcachepolicy---" id="markdown-toc-useprotocolcachepolicy---">1、UseProtocolCachePolicy - 默认缓存的机制</a></li>
      <li><a href="#section-3" id="markdown-toc-section-3">2、缓存高清图片</a></li>
    </ul>
  </li>
</ul>

<p>不少的开源项目的网络缓存都是自己家的轮子(譬如AFN俩独立缓存模块：AFAFImagecache (处理image)、NSURLCache(默认URL缓存))，我们现在的项目并未涉及到太复杂的缓存需求，自己造轮子不划算直接用系统的NSURLCache就OK。</p>

<p>在使用中也遇到不少坑：</p>

<ul>
  <li>响应内容过大，不会被缓存；</li>
  <li>Transfer-Encoding: Chunked  分块传输也会导致不缓存。</li>
  <li>…</li>
</ul>

<p>目前在协助子公司开发的一个项目里涉及到各种HTML5中的离线存储需求，实际用的是NSURLProtocol+NSURLCache，根据场景，用两套缓存的方案。对NSURLProtocol感兴趣的可以浏览我的另一篇关于NSURLProtocol的blog。</p>

<h3 id="section">基础篇</h3>

<h4 id="section-1">1、扫盲普及</h4>

<p>1、在iOS中，可以使用NSURLCache类缓存数据，iOS 5之前只支持内存缓存；从iOS 5开始同时支持内存缓存和硬盘缓存；iOS6.0开始，支持HTTPS缓存。</p>

<p>2、缓存分为:内存缓存\硬盘缓存。从app运行角度来说：如果程序没有退出，那么会使用内存中的缓存，如果已经退出重启，则使用硬盘缓存(读取到内存中)。</p>

<p>3、NSURLCache不支持Post请求的缓存处理，GET默认缓存：由于GET请求一般用来查询数据，POST请求一般是发大量数据给服务器处理。因此一般只对GET请求进行缓存，而不对POST请求进行缓存。</p>

<p>4、使用前提：</p>

<ul>
  <li>经常更新：不能用缓存；</li>
  <li>一成不变：果断用缓存；</li>
  <li>偶尔更新：可以定期更改缓存策略或者清除缓存</li>
  <li>GET网络请求、webview页面：果断缓存；</li>
  <li>App离线缓存功能等</li>
</ul>

<p>5、使用也很简单，几行代码搞定：</p>

<div class="highlighter-rouge"><pre class="highlight"><code>// 1 修改默认的缓存空间：
- (BOOL)application:(UIApplication *)application
didFinishLaunchingWithOptions:(NSDictionary *)launchOptions{
  NSURLCache *URLCache = [[NSURLCache alloc] initWithMemoryCapacity:4 * 1024 * 1024diskCapacity:20 * 1024 * 1024 diskPath:nil];
  [NSURLCache setSharedURLCache:URLCache];
}
// 2 设置缓存策略：
request.cachePolicy = NSURLRequestReturnCacheDataElseLoad;
OK，搞定。
</code></pre>
</div>
<p>如果不想使用缓存，上边数值设置0即可。</p>

<p>6、缓存的有效性，下文会提到，服务器返回的数据需要一个有效期，过期有效期就得更新本地的缓存。</p>

<h4 id="get-">2、基础：GET 缓存</h4>

<p>1、基本用法:</p>
<div class="highlighter-rouge"><pre class="highlight"><code>
（1）获得全局缓存对象 NSURLCache *cache = [NSURLCache sharedURLCache]; 
（2）设置内存缓存的最大容量（字节为单位，默认为512KB）- (void)setMemoryCapacity:
（3）设置硬盘缓存的最大容量（字节为单位，默认为10M）- (void)setDiskCapacity:
（4）硬盘缓存的位置：沙盒/Library/Caches
（5）取得某个请求的缓存- (NSCachedURLResponse *)cachedResponseForRequest:
（6）清除某个请求的缓存- (void)removeCachedResponseForRequest:
（7）清除所有的缓存- (void)removeAllCachedResponses;
</code></pre>
</div>

<p>2、缓存</p>
<div class="highlighter-rouge"><pre class="highlight"><code>
    // 1.创建请求
    NSURL *url = [NSURL URLWithString:@"GET"];
    NSMutableURLRequest *request = [NSMutableURLRequest requestWithURL:url];
    request.cachePolicy = NSURLRequestReturnCacheDataElseLoad;
    
    // 2.根据request检测缓存  
    NSURLCache *cache = [NSURLCache sharedURLCache];
    NSCachedURLResponse *response = [cache cachedResponseForRequest:request];
    if (response) {
        NSLog(@"已经有缓存:%@",response.data);
        // 判断时间，超时就移除缓存
    } else {
        NSLog(@"暂无缓存,开启请求");
        [NSURLConnection sendAsynchronousRequest:request queue:[NSOperationQueue mainQueue] completionHandler:^(NSURLResponse *response, NSData *data, NSError *connectionError) {
         if (data) {
            NSDictionary *dict = [NSJSONSerialization JSONObjectWithData:data options:NSJSONReadingMutableLeaves error:nil];
             NSLog(@"%@", dict);
         }
    }];
    }
    
    
</code></pre>
</div>

<h4 id="post-">3、进阶：POST 缓存</h4>

<p>POST 实现缓存需要自己手动实现，如下解说：</p>

<div class="highlighter-rouge"><pre class="highlight"><code>
// 读取缓存
+ (id)getCacheResponseWithURL:(NSString *)url params:(NSDictionary *)params {
    id cacheData = nil;
    if (url) {
        // 指定目录
        NSString *directoryPath = DIRECTORYPATH;
        // url+param确定唯一路径
        NSString *originString = [NSString stringWithFormat:@"%@+%@",url,params];

        NSString *path = [directoryPath stringByAppendingPathComponent:[self md5:originString]];
        NSData *data = [[NSFileManager defaultManager] contentsAtPath:path];
        if (data) {
            cacheData = [NSJSONSerialization JSONObjectWithData:data options:NSJSONReadingMutableContainers error:nil];
        }
    }
    return cacheData;
}
// 写入缓存
+ (void)cacheResponseObject:(id)responseObject request:(NSURLRequest *)request params:(NSDictionary *)params {
    if (request &amp;&amp; responseObject &amp;&amp; ![responseObject isKindOfClass:[NSNull class]]) {
        NSString *directoryPath = DIRECTORYPATH;
        NSError *error = nil;
        if (![[NSFileManager defaultManager] fileExistsAtPath:directoryPath isDirectory:nil]) {
            [[NSFileManager defaultManager] createDirectoryAtPath:directoryPath
                                      withIntermediateDirectories:YES
                                                       attributes:nil
                                                            error:&amp;error];
        }

        NSString *originString = [NSString stringWithFormat:@"%@+%@",request.URL.absoluteString,params];

        NSString *path = [directoryPath stringByAppendingPathComponent:[self md5:originString]];
        NSDictionary *dict = (NSDictionary *)responseObject;

        NSData *data = nil;
        if ([dict isKindOfClass:[NSData class]]) {
            data = responseObject;
        } else {
            data = [NSJSONSerialization dataWithJSONObject:dict
                                                   options:NSJSONWritingPrettyPrinted
                                                     error:&amp;error];
        }
        if (data &amp;&amp; error == nil) {
            [[NSFileManager defaultManager] createFileAtPath:path contents:data attributes:nil];
        }
    }
}
// 加密
+ (NSString *)md5:(NSString *)string {
    if (string == nil || [string length] == 0) {
        return nil;
    }
    unsigned char digest[CC_MD5_DIGEST_LENGTH], i;
    CC_MD5([string UTF8String], (int)[string lengthOfBytesUsingEncoding:NSUTF8StringEncoding], digest);
    NSMutableString *ms = [NSMutableString string];

    for (i = 0; i &lt; CC_MD5_DIGEST_LENGTH; i++) {
        [ms appendFormat:@"%02x", (int)(digest[i])];
    }

    return [ms copy];
}
</code></pre>
</div>

<h4 id="nsurlcache">4、进阶：自定义缓存策略的NSURLCache</h4>

<p>思路如下：</p>

<ul>
  <li>1、网络请求开始时，首先会判断沙盒中是否存在缓存数据；[没有直接请求]</li>
  <li>2、如果有，判断是否过期；没过期则使用本地数据。[过期则删除缓存，直接请求]</li>
  <li>3、请求URL
代码如下：</li>
</ul>

<div class="highlighter-rouge"><pre class="highlight"><code>
// 判断是否为GET
-(NSCachedURLResponse *)cachedResponseForRequest:(NSURLRequest*)request{
    if ([request.HTTPMethod compare:@"GET"] != NSOrderedSame) {
        return [super cachedResponseForRequest:request];
    }
    return [self customResponseForRequest:request];
}

// 加密
-(NSString *)getFileName:(NSString *)url{
    return [url getMd5_32Bit];
}

-(NSString *)getOtherInfoName:(NSString *)url{
    return [[NSString stringWithFormat:@"%@-otherInfo",url] getMd5_32Bit];
}
- (NSString *)cacheFilePath:(NSString *)fileName{
    NSString *filePath = [NSString stringWithFormat:@"URLCache/%@",fileName];
    NSString *path = kFilePathAtCachWithName(filePath);
    NSFileManager *fileManager = [NSFileManager defaultManager];
    BOOL isDir;
    if([fileManager fileExistsAtPath:path isDirectory:&amp;isDir] &amp;&amp; isDir) {
    } else{
         [fileManager createDirectoryAtPath:path withIntermediateDirectories:YES attributes:nil error:nil];
    }
    return path;
}

-(NSCachedURLResponse*)customResponseForRequest:(NSURLRequest*)request{
    ​NSString *url = request.URL.absoluteString;//请求的链接
    
    // URL MD5 后作为缓存文件名。这里取出MD5后的文件名
    NSString*fileName = [self getFileName:url];
    // 缓存信息的文件名 @"%@-otherInfo",url
    NSString*otherInfoName = [self getOtherInfoName:url];
    // 创建/获取 缓存的目录路径
    NSString*filePath = [self cacheFilePath:fileName];
    // 缓存信息字典路径
    NSString*otherInfoPath = [self cacheFilePath:otherInfoName];
    
    ​NSFileManager *fileManger = [NSFileManager defaultManager];
    //当文件存在的时候
    if ([fileManger fileExistsAtPath:filePath]) {
        NSDate*date = [NSDate date];
        BOOL isOverdue = YES;
        NSDictionary *dicInfo = [NSDictionary dictionaryWithContentsOfFile:otherInfoPath];
        // 过期与否？
        if(self.catchTime &gt; 0 &amp;&amp; dicInfo) {
            NSDate*createDate = dicInfo[kTimeKey];
            double createTime = [date timeIntervalSinceDate:createDate];
            if (createTime &lt; self.catchTime) {
                isOverdue = NO;
        }}
        //没有过期 加载缓存数据
        if (!isOverdue) {
            NSLog(@"访问缓存数据..");
            NSData *data = [NSData dataWithContentsOfFile:filePath];
            NSURLResponse *response = [[NSURLResponse alloc] initWithURL:request.URL MIMEType:dicInfo[kMIMETypeKey] expectedContentLength:data.lengthtextEncodingName:dicInfo[kTextEncodingNameKey]];
            NSCachedURLResponse *cacheResponse = [[NSCachedURLResponsealloc] initWithResponse:response data:data];
            return cacheResponse;
            
        }else{//已经过期，删除数据
            [fileManger removeItemAtPath :filePath error:nil];
            [fileManger removeItemAtPath :otherInfoPath error:nil];
        }
    }
    
    BOOL isExsit = [[self.dicResponse objectForKey:url] boolValue];
    if (!isExsit) {
        [self .dicResponse setObject:@(YES) forKey:url];
        NSLog(@"网络请求数据...");
        __block NSCachedURLResponse *cacheResponse = nil;
        [NSURLConnection sendAsynchronousRequest:request queue:[[NSOperationQueue alloc] init] completionHandler:^(NSURLResponse*response, NSData *data, NSError *connectionError) {
            //移除请求记录
            [self.dicResponse removeObjectForKey:url];
            if (data &amp;&amp; response) {
                NSMutableDictionary *dicInfo = [NSMutableDictionarydictionary];
                [dicInfo setObject :[NSDate date] forKey:kTimeKey];
                [dicInfo setObject :kUnNilStr(response.MIMEType) forKey:kMIMETypeKey];
                [dicInfo setObject :kUnNilStr(response.textEncodingName) forKey:kTextEncodingNameKey];
                BOOL state = [data writeToFile:filePath atomically:NO];
                NSLog(@"%d",state);
                [dicInfo writeToFile :otherInfoPath atomically:YES];
                cacheResponse = [[NSCachedURLResponse alloc] initWithResponse:response data:data];
            }
        }];
        return cacheResponse;
    }else{
        NSLog(@"该请求已存在");
    }
    return nil;
    
}

</code></pre>
</div>
<h2 id="section-2">进阶篇</h2>

<h4 id="useprotocolcachepolicy---">1、UseProtocolCachePolicy - 默认缓存的机制</h4>

<p>1、首先从apple提供的一个缓存策略的枚举说起：</p>
<div class="highlighter-rouge"><pre class="highlight"><code>
typedef NS_ENUM(NSUInteger, NSURLRequestCachePolicy)
{
    // 默认值：按照HTTP协议进行缓存
    NSURLRequestUseProtocolCachePolicy = 0, 
    // 非缓存模式：不使用缓存数据，无论是否有本地缓存
    NSURLRequestReloadIgnoringLocalCacheData = 1,
    // 缓存模式：无论缓存是否过期都是用缓存，没有缓存就进行网络请求
    NSURLRequestReturnCacheDataElseLoad = 2,
    // 离线模式：无论缓存是否过期都是用缓存，没有缓存也不会进行网络请求
    NSURLRequestReturnCacheDataDontLoad = 3,

    NSURLRequestReloadIgnoringCacheData = NSURLRequestReloadIgnoringLocalCacheData,
    NSURLRequestReloadIgnoringLocalAndRemoteCacheData = 4, // Unimplemented
    NSURLRequestReloadRevalidatingCacheData = 5, // Unimplemented
};
</code></pre>
</div>
<p>这个枚举大家应该很熟悉，创建request时经常用到的。这里我进行了分类，主要是4类。其余3个排除。这里除了默认值，其他3个模式都很容易理解，下面以QQ空间的web页面拦截为例说明默认值是如何实现的：</p>

<p>2、拦截QQ WebView的请求
首先在webview上加载QQ空间页面，然后拦截webview上QQ空间登录的response，部分Header字段如下：</p>
<div class="highlighter-rouge"><pre class="highlight"><code>
HTTP/1.1 200 OK
Content-Type    application/x-javascript
Server  QZHTTP-2.38.20
Content-Encoding    gzip
Cache-Control   public; max-age=86400
Proxy-Connection    Keep-alive
</code></pre>
</div>
<p>注意：这里的Cache-Control是我们的目标字段。</p>

<p>3、Cache-Control</p>

<p>这个字段用于指定该次整个请求中的缓存机制。常见的取值有public、private、no-cache、max-age、must-revalidate等，默认为private。QQ空间的Cache-Control解读如下：</p>

<ul>
  <li>public : 所有内容都将被缓存(客户端和代理服务器都可缓存)；</li>
  <li>max-age=86400 : 缓存的内容将在86400秒后失效, 这个选项只在HTTP 1.1可用。</li>
</ul>

<p>4、Cache位置</p>

<p>对于webview而言，缓存的数据默认在Library/Caches里。如下所示(ssh连接iphone)</p>
<div class="highlighter-rouge"><pre class="highlight"><code>
# ls
Documents/  Library/  tmp/
# cd Library/ &amp;&amp; ls
2222/  Caches/  Cookies/  Preferences/  WebKit/
# cd Caches/ &amp;&amp; ls

Databases.db                         http_ui.ptlogin2.qq.com_0.localstorage
Snapshots/                           https_auth.alipay.com_0.localstorage
com.apple.WebKit.Networking/         https_passport.jd.com_0/
com.apple.WebKit.WebContent/         https_passport.jd.com_0.localstorage
http_h5.m.taobao.com_0.localstorage  
[截取部分缓存数据]
</code></pre>
</div>

<p>那在app收到response之后，会根据Cache-Control字段，选择缓存的内容以及缓存的时间，而这些缓存的机制则是由服务器端定义。</p>

<h4 id="section-3">2、缓存高清图片</h4>

<p>经常会见到小图点开之后显示高清图片，那实现的一种方式就是:提前缓存高清图片,功能的实现要基于SDWebImage内部缓存的相关接口。</p>

<p>操作如下：拦截response，然后以url为key，数据为value，先缓存起来，在查看大图的时候，直接加载缓存的图片
代码如下：</p>
<div class="highlighter-rouge"><pre class="highlight"><code>
- (void)storeCachedResponse:(NSCachedURLResponse *)cachedResponse forRequest:(NSURLRequest *)request {
    [super storeCachedResponse:cachedResponse forRequest:request];
    NSString *mimeType = cachedResponse.response.MIMEType;

    if ([mimeType hasPrefix:@"image"]) {
        NSString *url = request.URL.absoluteString;
        NSLog(@"cache url:%@", url);

        SDImageCache *cache = [SDImageCache sharedImageCache];
        [cache storeImage:[UIImage imageWithData:cachedResponse.data] forKey:url toDisk:NO];
    }

}
</code></pre>
</div>
<p>但是注意，这种方法需要URL固定，如果Referer到其他站就会有问题了。</p>

<p>最佳的方案是使用NSURLProtocol解决。详细的可以参考我的NSURLProtocol博文。
如下：</p>

<div class="highlighter-rouge"><pre class="highlight"><code>
- (void)startLoading {
    NSURLSession *session = [NSURLSession sharedSession];
    NSMutableURLRequest *request = [self.request mutableCopy];
    [NSURLProtocol setProperty:@(YES) forKey:kProtocolHandledKey inRequest:request];
    __weak typeof(self) weakSelf = self;
    self.sessionTask = [session dataTaskWithRequest:request completionHandler:^(NSData *data, NSURLResponse *response, NSError *error) {
        if (error) {
            return;
        }
        NSString *mimeType = response.MIMEType;
        if ([mimeType hasPrefix:@"image"]) {
            NSString *url = weakSelf.request.URL.absoluteString;
            SDImageCache *cache = [SDImageCache sharedImageCache];
            [cache storeImage:[UIImage imageWithData:data] forKey:url toDisk:NO];
        }
        [weakSelf.client URLProtocol:weakSelf didReceiveResponse:response cacheStoragePolicy:NSURLCacheStorageAllowedInMemoryOnly];
        [weakSelf.client URLProtocol:weakSelf didLoadData:data];
        [weakSelf.client URLProtocolDidFinishLoading:weakSelf];
    }];
    [self.task resume];
}
- (void)stopLoading {
    [self.sessionTask cancel];
    self.sessionTask = nil;
}

</code></pre>
</div>

<p>我们使用了自定义的NSURLProtocol对所有http(s)请求进行了拦截，并在资源加载完成的时候进行对mime-type的判断，如果是image，那我们就以请求的URL为key，把请求得到的数据转换为UIImage存入SDImageCache中。</p>


                </div>
                <div class="read-all">
                    <a  href="/2015/10/15/NSURLCache/"><i class="fa fa-newspaper-o"></i>Read All</a>
                </div>
                <hr>
              </li>
            
              <li>
                <h2>
                  <a class="post-link" href="/2015/10/15/NSURLProtocol/">NSURLProtocol小教程</a>
                </h2>
                <div class="label">
                    <div class="label-card">
                        <i class="fa fa-calendar"></i>2015-10-15
                    </div>
                    <div class="label-card">
                        <i class="fa fa-user"></i>3行代码
                        
                    </div>
                    <div class="label-card">
                        
                    </div>

                    <div class="label-card">
                    


<!-- <span class="point">•</span> -->
<span class="categories">
  <i class="fa fa-th-list"></i>
  
    
        <a href="/category/#Objective-C" title="Category: Objective-C" rel="category">Objective-C</a>
    
  

  <!-- <span class="point">•</span> -->
</span>


                    </div>

                    <div class="label-card">
                    
<!-- <span class="point">•</span> -->
<span class="pageTag">
  <i class="fa fa-tags"></i>
  
    
        <a href="/tag/#NSURLProtocol" title="Tag: NSURLProtocol" rel="tag">NSURLProtocol</a>&nbsp;
    
        <a href="/tag/#缓存" title="Tag: 缓存" rel="tag">缓存</a>
    
  

</span>

                    </div>
                </div>
                <div class="excerpt">
                    <ul id="markdown-toc">
  <li><a href="#section" id="markdown-toc-section">1、基本使用</a>    <ul>
      <li><a href="#section-1" id="markdown-toc-section-1">1、注册</a></li>
      <li><a href="#section-2" id="markdown-toc-section-2">2、实现方法</a></li>
      <li><a href="#section-3" id="markdown-toc-section-3">3、坑</a></li>
      <li><a href="#request" id="markdown-toc-request">4、修改request请求头</a></li>
      <li><a href="#requesturl" id="markdown-toc-requesturl">5、request.URL重定向</a></li>
      <li><a href="#nsurlprotocolclient" id="markdown-toc-nsurlprotocolclient">6、NSURLProtocolClient</a></li>
    </ul>
  </li>
  <li><a href="#nsurlprotocolnsurlsession" id="markdown-toc-nsurlprotocolnsurlsession">2、NSURLProtocol拦截NSURLSession</a></li>
</ul>

<p>iOS里面总有一些比较神秘，但也总是充满惊喜的API，譬如本博客持续更新的:NSURLProtocol。</p>

<p>NSURLProtocol并不是protocol而是一个虚拟类。使用的话需要实例化一个子类来操作，在这个子类中，可以实现如下的功能:</p>

<ul>
  <li>重定向网络请求</li>
  <li>忽略网络请求，使用本地缓存</li>
  <li>自定义网络请求的返回结果</li>
  <li>全局的网络请求设置</li>
</ul>

<p>注意:</p>
<ul>
  <li>NSURLProtocol只能拦截 NSURLConnection、NSURLSession 和 UIWebView 中的请求，无法拦截WKWebView中发出的网络请求。</li>
  <li>可以注册多个NSURLProtocol的子类，注册多个NSURLProtocol子类会逆序去执行，也就是先注册的子类后执行。</li>
  <li>AFN\SDWebImage等开始使用NSURLSession，需要注意其中潜在的坑</li>
  <li>UIWebView本身是有缓存的，基于NSURLCache来实现</li>
</ul>

<p>如下是URL Loading System的组织图，本文只是简单的介绍下NSURLProtocol。</p>

<p><img src="https://developer.apple.com/library/content/documentation/Cocoa/Conceptual/URLLoadingSystem/Art/nsobject_hierarchy_2x.png" alt="" /></p>

<h2 id="section">1、基本使用</h2>

<h4 id="section-1">1、注册</h4>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="o">-</span> <span class="o">(</span><span class="n">BOOL</span><span class="o">)</span><span class="nl">application:</span><span class="o">(</span><span class="n">UIApplication</span> <span class="o">*)</span><span class="n">application</span> <span class="nl">didFinishLaunchingWithOptions:</span><span class="o">(</span><span class="n">NSDictionary</span> <span class="o">*)</span><span class="n">launchOptions</span> <span class="o">{</span>
    <span class="o">[</span><span class="n">NSURLProtocol</span> <span class="nl">registerClass:</span><span class="o">[</span><span class="n">CodeURLProtocol</span> <span class="kd">class</span><span class="err">]];</span>
    <span class="nc">return</span> <span class="n">YES</span><span class="o">;</span>
<span class="o">}</span>
</code></pre>
</div>
<h4 id="section-2">2、实现方法</h4>

<p>// 1、每有一个请求的时候都会调用这个方法，如果返回YES就代表这个request需要被处理，反之就是不需要被处理。</p>
<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="kd">static</span> <span class="n">NSString</span> <span class="o">*</span> <span class="kd">const</span> <span class="n">protocolKey</span> <span class="o">=</span> <span class="err">@</span><span class="s">"protocolKey"</span><span class="o">;</span>

<span class="o">+</span> <span class="o">(</span><span class="n">BOOL</span><span class="o">)</span><span class="nl">canInitWithRequest:</span><span class="o">(</span><span class="n">NSURLRequest</span> <span class="o">*)</span><span class="n">request</span> <span class="o">{</span>
    <span class="c1">//防止无限循环，因为一个请求在被拦截处理过程中，也会发起一个请求，这样又会走到这里</span>
    <span class="k">if</span> <span class="o">([</span><span class="n">NSURLProtocol</span> <span class="nl">propertyForKey:</span><span class="n">protocolKey</span> <span class="nl">inRequest:</span><span class="n">request</span><span class="o">])</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">NO</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="c1">// 对https请求做相关处理</span>
    <span class="n">NSString</span> <span class="o">*</span><span class="n">scheme</span> <span class="o">=</span> <span class="o">[[</span><span class="n">request</span> <span class="n">URL</span><span class="o">]</span> <span class="n">scheme</span><span class="o">];</span>
    <span class="k">if</span> <span class="o">([</span><span class="n">scheme</span> <span class="nl">caseInsensitiveCompare:</span><span class="err">@</span><span class="s">"https"</span><span class="o">]</span> <span class="o">==</span> <span class="n">NSOrderedSame</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">YES</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="k">return</span> <span class="n">NO</span><span class="o">;</span>
<span class="o">}</span>
</code></pre>
</div>

<p>// 2、这个方法返回request，可以修改request</p>
<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="o">+</span> <span class="o">(</span><span class="n">NSURLRequest</span> <span class="o">*)</span><span class="nl">canonicalRequestForRequest:</span><span class="o">(</span><span class="n">NSURLRequest</span> <span class="o">*)</span><span class="n">request</span> <span class="o">{</span>
    <span class="k">return</span> <span class="n">request</span><span class="o">;</span>
<span class="o">}</span>
</code></pre>
</div>

<p>// 3、这个方法用于处理被拦截的request，从而处理请求头、重定向、缓存等</p>
<div class="language-js highlighter-rouge"><pre class="highlight"><code><span class="o">-</span> <span class="p">(</span><span class="k">void</span><span class="p">)</span><span class="nx">startLoading</span> <span class="p">{</span>

<span class="p">}</span>
</code></pre>
</div>

<p>// 4、停止请求</p>
<div class="language-js highlighter-rouge"><pre class="highlight"><code><span class="o">-</span> <span class="p">(</span><span class="k">void</span><span class="p">)</span> <span class="nx">stopLoading</span> <span class="p">{</span>

<span class="p">}</span>
</code></pre>
</div>
<h4 id="section-3">3、坑</h4>
<p>不做解释，遇到的人都懂：</p>
<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="k">if</span> <span class="o">([</span><span class="n">NSURLProtocol</span> <span class="nl">propertyForKey:</span><span class="n">protocolKey</span> <span class="nl">inRequest:</span><span class="n">request</span><span class="o">])</span> <span class="o">{</span>
    <span class="k">return</span> <span class="n">NO</span><span class="o">;</span>
<span class="o">}</span>
<span class="o">[</span><span class="n">NSURLProtocol</span> <span class="nl">setProperty:</span><span class="err">@</span><span class="o">(</span><span class="n">YES</span><span class="o">)</span> <span class="nl">forKey:</span><span class="n">protocolKey</span> <span class="nl">inRequest:</span><span class="n">request</span><span class="o">];</span>
</code></pre>
</div>

<h4 id="request">4、修改request请求头</h4>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="o">-</span> <span class="o">(</span><span class="kt">void</span><span class="o">)</span><span class="n">startLoading</span> <span class="o">{</span>
    <span class="n">NSMutableURLRequest</span> <span class="o">*</span><span class="n">request</span> <span class="o">=</span> <span class="o">[</span><span class="n">self</span><span class="o">.</span><span class="na">request</span> <span class="n">mutableCopy</span><span class="o">];</span>
    <span class="c1">//给请求头添加一个请求体</span>
    <span class="n">NSMutableDictionary</span> <span class="o">*</span><span class="n">headers</span> <span class="o">=</span> <span class="o">[</span><span class="n">request</span><span class="o">.</span><span class="na">allHTTPHeaderFields</span> <span class="n">mutableCopy</span><span class="o">];</span>
    <span class="o">[</span><span class="n">headers</span> <span class="nl">setObject:</span><span class="err">@</span><span class="s">"3code.info"</span> <span class="nl">forKey:</span><span class="err">@</span><span class="s">"key"</span><span class="o">];</span>
    <span class="n">request</span><span class="o">.</span><span class="na">allHTTPHeaderFields</span> <span class="o">=</span> <span class="n">headers</span><span class="o">;</span>
    <span class="o">[</span><span class="n">NSURLProtocol</span> <span class="nl">setProperty:</span><span class="err">@</span><span class="o">(</span><span class="n">YES</span><span class="o">)</span> <span class="nl">forKey:</span><span class="n">protocolKey</span> <span class="nl">inRequest:</span><span class="n">request</span><span class="o">];</span>
    <span class="c1">//.....然后使用NSURLSession发送request</span>
<span class="o">}</span>
</code></pre>
</div>
<h4 id="requesturl">5、request.URL重定向</h4>
<p>将请求重定向到3code.info</p>
<div class="language-java highlighter-rouge"><pre class="highlight"><code>
<span class="o">-</span> <span class="o">(</span><span class="kt">void</span><span class="o">)</span><span class="n">startLoading</span> <span class="o">{</span>
    <span class="n">NSMutableURLRequest</span> <span class="o">*</span><span class="n">request</span> <span class="o">=</span> <span class="o">[</span><span class="n">self</span><span class="o">.</span><span class="na">request</span> <span class="n">mutableCopy</span><span class="o">];</span>
    <span class="c1">//request改为访问3code.info了</span>
    <span class="n">request</span><span class="o">.</span><span class="na">URL</span> <span class="o">=</span> <span class="o">[</span><span class="n">NSURL</span> <span class="nl">URLWithString:</span><span class="err">@</span><span class="s">"http://www.3code.info"</span><span class="o">];</span>
    <span class="o">[</span><span class="n">NSURLProtocol</span> <span class="nl">setProperty:</span><span class="err">@</span><span class="o">(</span><span class="n">YES</span><span class="o">)</span> <span class="nl">forKey:</span><span class="n">protocolKey</span> <span class="nl">inRequest:</span><span class="n">request</span><span class="o">];</span>
    <span class="c1">//使用NSURLSession继续把重定向的request发送出去</span>
    <span class="n">NSURLSessionConfiguration</span> <span class="o">*</span><span class="n">config</span> <span class="o">=</span> <span class="o">[</span><span class="n">NSURLSessionConfiguration</span> <span class="n">ephemeralSessionConfiguration</span><span class="o">];</span>
    <span class="n">NSOperationQueue</span> <span class="o">*</span><span class="n">mainQueue</span> <span class="o">=</span> <span class="o">[</span><span class="n">NSOperationQueue</span> <span class="n">mainQueue</span><span class="o">];</span>
    <span class="n">NSURLSession</span> <span class="o">*</span><span class="n">session</span> <span class="o">=</span> <span class="o">[</span><span class="n">NSURLSession</span> <span class="nl">sessionWithConfiguration:</span><span class="n">config</span> <span class="nl">delegate:</span><span class="n">self</span> <span class="nl">delegateQueue:</span><span class="n">mainQueue</span><span class="o">];</span>
    <span class="n">NSURLSessionDataTask</span> <span class="o">*</span><span class="n">task</span> <span class="o">=</span> <span class="o">[</span><span class="n">session</span> <span class="nl">dataTaskWithRequest:</span><span class="n">request</span><span class="o">];</span>
    <span class="o">[</span><span class="n">task</span> <span class="n">resume</span><span class="o">];</span>
<span class="o">}</span>
</code></pre>
</div>
<h4 id="nsurlprotocolclient">6、NSURLProtocolClient</h4>

<p>webview中发送一个request，在这里拦截后使用NSURLSession重新发request。那webview是收不到response的。这里就要做一个处理，每一个NSURLProtocol的子类都有一个client对象来处理response。写法用下边这个就行，比较固定的。(保留了以前的NSURLConnection)</p>

<p>本次更新：</p>
<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="o">-(</span><span class="kt">void</span><span class="o">)</span><span class="nl">URLSession:</span><span class="o">(</span><span class="n">NSURLSession</span> <span class="o">*)</span><span class="n">session</span> <span class="nl">task:</span><span class="o">(</span><span class="n">NSURLSessionTask</span> <span class="o">*)</span><span class="n">task</span> <span class="nl">didCompleteWithError:</span><span class="o">(</span><span class="n">NSError</span> <span class="o">*)</span><span class="n">error</span> <span class="o">{</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">error</span><span class="o">)</span> <span class="o">{</span>
        <span class="o">[</span><span class="n">self</span><span class="o">.</span><span class="na">client</span> <span class="nl">URLProtocol:</span><span class="n">self</span> <span class="nl">didFailWithError:</span><span class="n">error</span><span class="o">];</span>
    <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
        <span class="o">[</span><span class="n">self</span><span class="o">.</span><span class="na">client</span> <span class="nl">URLProtocolDidFinishLoading:</span><span class="n">self</span><span class="o">];</span>
    <span class="o">}</span>
<span class="o">}</span>
<span class="o">-(</span><span class="kt">void</span><span class="o">)</span><span class="nl">URLSession:</span><span class="o">(</span><span class="n">NSURLSession</span> <span class="o">*)</span><span class="n">session</span> <span class="nl">dataTask:</span><span class="o">(</span><span class="n">NSURLSessionDataTask</span> <span class="o">*)</span><span class="n">dataTask</span> <span class="nl">didReceiveResponse:</span><span class="o">(</span><span class="n">NSURLResponse</span> <span class="o">*)</span><span class="n">response</span> <span class="nl">completionHandler:</span><span class="o">(</span><span class="kt">void</span> <span class="o">(^)(</span><span class="n">NSURLSessionResponseDisposition</span><span class="o">))</span><span class="n">completionHandler</span> <span class="o">{</span>
    <span class="o">[</span><span class="n">self</span><span class="o">.</span><span class="na">client</span> <span class="nl">URLProtocol:</span><span class="n">self</span> <span class="nl">didReceiveResponse:</span><span class="n">response</span> <span class="nl">cacheStoragePolicy:</span><span class="n">NSURLCacheStorageNotAllowed</span><span class="o">];</span>
    <span class="n">completionHandler</span><span class="o">(</span><span class="n">NSURLSessionResponseAllow</span><span class="o">);</span>
<span class="o">}</span>
<span class="o">-(</span><span class="kt">void</span><span class="o">)</span><span class="nl">URLSession:</span><span class="o">(</span><span class="n">NSURLSession</span> <span class="o">*)</span><span class="n">session</span> <span class="nl">dataTask:</span><span class="o">(</span><span class="n">NSURLSessionDataTask</span> <span class="o">*)</span><span class="n">dataTask</span> <span class="nl">didReceiveData:</span><span class="o">(</span><span class="n">NSData</span> <span class="o">*)</span><span class="n">data</span> <span class="o">{</span>
    <span class="o">[</span><span class="n">self</span><span class="o">.</span><span class="na">client</span> <span class="nl">URLProtocol:</span><span class="n">self</span> <span class="nl">didLoadData:</span><span class="n">data</span><span class="o">];</span>
<span class="o">}</span>
<span class="o">-</span> <span class="o">(</span><span class="kt">void</span><span class="o">)</span><span class="nl">URLSession:</span><span class="o">(</span><span class="n">NSURLSession</span> <span class="o">*)</span><span class="n">session</span> <span class="nl">dataTask:</span><span class="o">(</span><span class="n">NSURLSessionDataTask</span> <span class="o">*)</span><span class="n">dataTask</span> <span class="nl">willCacheResponse:</span><span class="o">(</span><span class="n">NSCachedURLResponse</span> <span class="o">*)</span><span class="n">proposedResponse</span> <span class="nl">completionHandler:</span><span class="o">(</span><span class="kt">void</span> <span class="o">(^)(</span><span class="n">NSCachedURLResponse</span> <span class="o">*</span><span class="n">cachedResponse</span><span class="o">))</span><span class="n">completionHandler</span> <span class="o">{</span>
    <span class="n">completionHandler</span><span class="o">(</span><span class="n">proposedResponse</span><span class="o">);</span>
<span class="o">}</span>
</code></pre>
</div>
<p>NSURLConnection：</p>
<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="o">-</span> <span class="o">(</span><span class="kt">void</span><span class="o">)</span> <span class="nl">connection:</span><span class="o">(</span><span class="n">NSURLConnection</span> <span class="o">*)</span><span class="n">connection</span> <span class="nl">didReceiveResponse:</span><span class="o">(</span><span class="n">NSURLResponse</span> <span class="o">*)</span><span class="n">response</span> <span class="o">{</span>
    <span class="o">[</span><span class="n">self</span><span class="o">.</span><span class="na">client</span> <span class="nl">URLProtocol:</span><span class="n">self</span> <span class="nl">didReceiveResponse:</span><span class="n">response</span> <span class="nl">cacheStoragePolicy:</span><span class="n">NSURLCacheStorageNotAllowed</span><span class="o">];</span>
<span class="o">}</span>
<span class="o">-</span> <span class="o">(</span><span class="kt">void</span><span class="o">)</span> <span class="nl">connection:</span><span class="o">(</span><span class="n">NSURLConnection</span> <span class="o">*)</span><span class="n">connection</span> <span class="nl">didReceiveData:</span><span class="o">(</span><span class="n">NSData</span> <span class="o">*)</span><span class="n">data</span> <span class="o">{</span>
    <span class="o">[</span><span class="n">self</span><span class="o">.</span><span class="na">client</span> <span class="nl">URLProtocol:</span><span class="n">self</span> <span class="nl">didLoadData:</span><span class="n">data</span><span class="o">];</span>
<span class="o">}</span>
<span class="o">-</span> <span class="o">(</span><span class="kt">void</span><span class="o">)</span> <span class="nl">connectionDidFinishLoading:</span><span class="o">(</span><span class="n">NSURLConnection</span> <span class="o">*)</span><span class="n">connection</span> <span class="o">{</span>
    <span class="o">[</span><span class="n">self</span><span class="o">.</span><span class="na">client</span> <span class="nl">URLProtocolDidFinishLoading:</span><span class="n">self</span><span class="o">];</span>
<span class="o">}</span>
<span class="o">-</span> <span class="o">(</span><span class="kt">void</span><span class="o">)</span><span class="nl">connection:</span><span class="o">(</span><span class="n">NSURLConnection</span> <span class="o">*)</span><span class="n">connection</span> <span class="nl">didFailWithError:</span><span class="o">(</span><span class="n">NSError</span> <span class="o">*)</span><span class="n">error</span> <span class="o">{</span>
    <span class="o">[</span><span class="n">self</span><span class="o">.</span><span class="na">client</span> <span class="nl">URLProtocol:</span><span class="n">self</span> <span class="nl">didFailWithError:</span><span class="n">error</span><span class="o">];</span>
<span class="o">}</span>
</code></pre>
</div>

<h2 id="nsurlprotocolnsurlsession">2、NSURLProtocol拦截NSURLSession</h2>

<p>上一期的项目有个需求，就是在移动网络下，不进行高清图片，视频等下载操作。其中遇到的问题就是拦截NSURLSession。这里简化为如下实现。</p>

<p>思路：使用NSURLProtocol拦截所有的request，过滤耗流量的request。并做处理。其实蛮简单的，但是AFNetwork、SDWebImageCache等三方库并未拦截。原因是NSURLSession。</p>
<div class="language-java highlighter-rouge"><pre class="highlight"><code>
<span class="o">+</span> <span class="o">(</span><span class="n">BOOL</span><span class="o">)</span><span class="nl">canInitWithRequest:</span><span class="o">(</span><span class="n">NSURLRequest</span> <span class="o">*)</span><span class="n">request</span> <span class="o">{</span>
    <span class="k">if</span> <span class="o">([</span><span class="n">NSURLProtocol</span> <span class="nl">propertyForKey:</span><span class="n">protocolKey</span> <span class="nl">inRequest:</span><span class="n">request</span><span class="o">])</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">NO</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="c1">//满足条件时直接截获请求</span>
    <span class="k">if</span> <span class="o">([[</span><span class="n">UserConfig</span> <span class="n">sharedInstance</span><span class="o">]</span> <span class="n">isOffPicture</span><span class="o">]</span> <span class="o">&amp;&amp;</span> <span class="o">([</span><span class="n">request</span><span class="o">.</span><span class="na">URL</span><span class="o">.</span><span class="na">pathExtension</span> <span class="nl">caseInsensitiveCompare:</span><span class="err">@</span><span class="s">"jpg"</span><span class="o">]</span> <span class="o">==</span> <span class="n">NSOrderedSame</span> <span class="o">||</span> <span class="o">[</span><span class="n">request</span><span class="o">.</span><span class="na">URL</span><span class="o">.</span><span class="na">pathExtension</span> <span class="nl">caseInsensitiveCompare:</span><span class="err">@</span><span class="s">"png"</span><span class="o">]</span> <span class="o">==</span> <span class="n">NSOrderedSame</span><span class="o">)</span> <span class="o">&amp;&amp;</span> <span class="o">[</span><span class="n">self</span> <span class="n">isPictureDownload</span><span class="o">])</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">YES</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="k">return</span> <span class="n">NO</span><span class="o">;</span>
<span class="o">}</span>
</code></pre>
</div>

<p>从官方文档中可以了解到自定义的NSURLProtocol子类需要赋给NSURLSessionConfiguration的protocolClasses属性,同时其创建的Session时关联的NSURLSessionConfiguration为defaultSessionConfiguration。那么解决方法就跃然纸上了，如下代码：</p>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="o">+</span> <span class="o">(</span><span class="n">NSURLSessionConfiguration</span> <span class="o">*)</span><span class="n">zw_defaultSessionConfiguration</span> <span class="o">{</span>
<span class="c1">//    如果需要NSURLProtocol来截获NSURLSession发出的请求，需要每一个NSURLSession在创建时配置的NSURLSessionConfiguration类的protocolClasses属性附上自定义的NSURLProtocol：如下</span>
    <span class="n">NSURLSessionConfiguration</span> <span class="o">*</span><span class="n">configuration</span> <span class="o">=</span> <span class="o">[</span><span class="n">self</span> <span class="n">zw_defaultSessionConfiguration</span><span class="o">];</span>
    <span class="n">NSArray</span> <span class="o">*</span><span class="n">protocolClasses</span> <span class="o">=</span> <span class="err">@</span><span class="o">[[</span><span class="n">CodeURLProtocol</span> <span class="kd">class</span><span class="err">]];</span>
    <span class="nc">configuration</span><span class="o">.</span><span class="na">protocolClasses</span> <span class="o">=</span> <span class="n">protocolClasses</span><span class="o">;</span>
    
    <span class="k">return</span> <span class="n">configuration</span><span class="o">;</span>
<span class="o">}</span>
<span class="o">+</span> <span class="o">(</span><span class="kt">void</span><span class="o">)</span><span class="n">load</span> <span class="o">{</span>
<span class="c1">//  使用Method Swizzling方法，defaultSessionConfiguration实现（AFNetwork、SDWebImageCache在创建时使用的是[NSURLSessionConfiguration defaultSessionConfiguration]）如下：</span>
    <span class="n">Method</span> <span class="n">systemMethod</span> <span class="o">=</span> <span class="n">class_getClassMethod</span><span class="o">([</span><span class="n">NSURLSessionConfiguration</span> <span class="kd">class</span><span class="err">],</span> <span class="err">@</span><span class="nc">selector</span><span class="o">(</span><span class="n">defaultSessionConfiguration</span><span class="o">));</span>
    <span class="n">Method</span> <span class="n">zwMethod</span> <span class="o">=</span> <span class="n">class_getClassMethod</span><span class="o">([</span><span class="n">self</span> <span class="kd">class</span><span class="err">],</span> <span class="err">@</span><span class="nc">selector</span><span class="o">(</span><span class="n">zw_defaultSessionConfiguration</span><span class="o">));</span>
    <span class="n">method_exchangeImplementations</span><span class="o">(</span><span class="n">systemMethod</span><span class="o">,</span> <span class="n">zwMethod</span><span class="o">);</span>
    <span class="o">[</span><span class="n">NSURLProtocol</span> <span class="nl">registerClass:</span><span class="o">[</span><span class="n">CodeURLProtocol</span> <span class="kd">class</span><span class="err">]];</span>
<span class="err">}</span>
</code></pre>
</div>

<p>以上就解决了NSURLProtocol拦截NSURLSession的问题。</p>


                </div>
                <div class="read-all">
                    <a  href="/2015/10/15/NSURLProtocol/"><i class="fa fa-newspaper-o"></i>Read All</a>
                </div>
                <hr>
              </li>
            
        </ul>



        <!-- Pagination links -->
        <div class="pagination">
          
            <a href="/index.html" class="previous"><i class="fa fa-angle-double-left"></i></a>
            <a href="/page4" class="previous"><i class="fa fa-angle-left"></i></a>
          
          <span class="page_number ">5/6</span>
          
            <a href="/page6" class="next"><i class="fa fa-angle-right"></i></a>
            <a href="/page6" class="next"><i class="fa fa-angle-double-right"></i></a>
          
        </div>
    </div>
    <!-- <button class="anchor"><i class="fa fa-anchor"></i></button> -->
    <div class="right">
        <div class="wrap">
            <div class="side">
                <div>
                    <i class="fa fa-pencil-square-o" aria-hidden="true"></i>
                    最新文章
                </div>
                <ul class="content-ul" recent>
                    
                        <li><a href="/2017/02/07/AD-Fastlane/">自动化测试部署系列 - Fastlane的黑魔法:自动打包编译上传 AppStore</a></li>
                    
                        <li><a href="/2017/01/23/AD-XCTest/">自动化测试部署系列 - XCTest入门</a></li>
                    
                        <li><a href="/2017/01/18/SDiffuseMenu/">Swift 版 AwesomeMenu 的改写之旅:SDiffuseMenu</a></li>
                    
                        <li><a href="/2016/12/11/swift_X_Initialization_Deinitialization/">Swift3.0_X_构造过程和析构过程 </a></li>
                    
                        <li><a href="/2016/12/10/swift_IX_Methods_Subscripts_Inheritance/">Swift3.0_IX_方法、下标和继承 </a></li>
                    
                        <li><a href="/2016/12/08/swift_VIII_Enumerations_Classes_Structures_Properties/">Swift3.0_VIII_枚举、类、结构体、属性</a></li>
                    
                        <li><a href="/2016/12/07/swift_VII_Closures/">Swift3.0_VII_闭包</a></li>
                    
                        <li><a href="/2016/12/05/swift_VI_Functions/">Swift3.0_VI_函数</a></li>
                    
                        <li><a href="/2016/12/03/swift_V_Control-Flow/">Swift3.0_V_控制流</a></li>
                    
                        <li><a href="/2016/12/01/swift_IV_Collection-Types/">Swift3.0_IV_集合</a></li>
                    
                </ul>
            </div>

            <!-- Content -->
            <div class="side ">
                <div>
                    <i class="fa fa-th-list"></i>
                    分类
                </div>
                <ul class="content-ul" cate>
                    
                    <li>
                        <a href="/category/#OS_X" class="categories-list-item" cate="OS_X">
                            <span class="name">
                                OS_X
                            </span>
                            <span class="badge">2</span>
                        </a>
                    </li>
                    
                    <li>
                        <a href="/category/#Objective-C" class="categories-list-item" cate="Objective-C">
                            <span class="name">
                                Objective-C
                            </span>
                            <span class="badge">5</span>
                        </a>
                    </li>
                    
                    <li>
                        <a href="/category/#Reverse" class="categories-list-item" cate="Reverse">
                            <span class="name">
                                Reverse
                            </span>
                            <span class="badge">9</span>
                        </a>
                    </li>
                    
                    <li>
                        <a href="/category/#AD" class="categories-list-item" cate="AD">
                            <span class="name">
                                AD
                            </span>
                            <span class="badge">6</span>
                        </a>
                    </li>
                    
                    <li>
                        <a href="/category/#tips" class="categories-list-item" cate="tips">
                            <span class="name">
                                tips
                            </span>
                            <span class="badge">1</span>
                        </a>
                    </li>
                    
                    <li>
                        <a href="/category/#python" class="categories-list-item" cate="python">
                            <span class="name">
                                python
                            </span>
                            <span class="badge">1</span>
                        </a>
                    </li>
                    
                    <li>
                        <a href="/category/#Swift3.0" class="categories-list-item" cate="Swift3.0">
                            <span class="name">
                                Swift3.0
                            </span>
                            <span class="badge">11</span>
                        </a>
                    </li>
                    
                </ul>
            </div>
            <!-- 其他div框放到这里 -->
            <div class="side">
                <div>
                    <i class="fa fa-tags"></i>
                    Tags
                </div>
                <div class="tags-cloud">
                    
                    
                    
                    

                    

                    
                      
                      
                      
                      
                      
                      <a href="/tag/#apache" style="font-size: 9pt; color: #999;">apache</a>
                    
                      
                      
                      
                      
                      
                      <a href="/tag/#WKWebView、Native与JS、缓存、NSURLProtocol" style="font-size: 9pt; color: #999;">WKWebView、Native与JS、缓存、NSURLProtocol</a>
                    
                      
                      
                      
                      
                      
                      <a href="/tag/#Charles" style="font-size: 9pt; color: #999;">Charles</a>
                    
                      
                      
                      
                      
                      
                      <a href="/tag/#Reveal" style="font-size: 9pt; color: #999;">Reveal</a>
                    
                      
                      
                      
                      
                      
                      <a href="/tag/#iOSOpenDev" style="font-size: 9pt; color: #999;">iOSOpenDev</a>
                    
                      
                      
                      
                      
                      
                      <a href="/tag/#block" style="font-size: 9pt; color: #999;">block</a>
                    
                      
                      
                      
                      
                      
                      <a href="/tag/#NSURLProtocol" style="font-size: 9pt; color: #999;">NSURLProtocol</a>
                    
                      
                      
                      
                      
                      
                      <a href="/tag/#缓存" style="font-size: 10pt; color: #888;">缓存</a>
                    
                      
                      
                      
                      
                      
                      <a href="/tag/#NSURLCache" style="font-size: 9pt; color: #999;">NSURLCache</a>
                    
                      
                      
                      
                      
                      
                      <a href="/tag/#SecureCRT" style="font-size: 9pt; color: #999;">SecureCRT</a>
                    
                      
                      
                      
                      
                      
                      <a href="/tag/#博客" style="font-size: 9pt; color: #999;">博客</a>
                    
                      
                      
                      
                      
                      
                      <a href="/tag/#jekyll" style="font-size: 9pt; color: #999;">jekyll</a>
                    
                      
                      
                      
                      
                      
                      <a href="/tag/#sublime" style="font-size: 9pt; color: #999;">sublime</a>
                    
                      
                      
                      
                      
                      
                      <a href="/tag/#环境变量" style="font-size: 9pt; color: #999;">环境变量</a>
                    
                      
                      
                      
                      
                      
                      <a href="/tag/#mac_tips" style="font-size: 9pt; color: #999;">mac_tips</a>
                    
                      
                      
                      
                      
                      
                      <a href="/tag/#Sublime" style="font-size: 10pt; color: #888;">Sublime</a>
                    
                      
                      
                      
                      
                      
                      <a href="/tag/#iOS逆向" style="font-size: 9pt; color: #999;">iOS逆向</a>
                    
                      
                      
                      
                      
                      
                      <a href="/tag/#class_dump" style="font-size: 9pt; color: #999;">class_dump</a>
                    
                      
                      
                      
                      
                      
                      <a href="/tag/#Theos" style="font-size: 10pt; color: #888;">Theos</a>
                    
                      
                      
                      
                      
                      
                      <a href="/tag/#Logos" style="font-size: 9pt; color: #999;">Logos</a>
                    
                      
                      
                      
                      
                      
                      <a href="/tag/#iOS基础" style="font-size: 9pt; color: #999;">iOS基础</a>
                    
                      
                      
                      
                      
                      
                      <a href="/tag/#IDA、iFunBox、dyld_decache" style="font-size: 9pt; color: #999;">IDA、iFunBox、dyld_decache</a>
                    
                      
                      
                      
                      
                      
                      <a href="/tag/#iOS逆向工具集" style="font-size: 9pt; color: #999;">iOS逆向工具集</a>
                    
                      
                      
                      
                      
                      
                      <a href="/tag/#iOS逆向理论基础" style="font-size: 9pt; color: #999;">iOS逆向理论基础</a>
                    
                      
                      
                      
                      
                      
                      <a href="/tag/#脚本" style="font-size: 9pt; color: #999;">脚本</a>
                    
                      
                      
                      
                      
                      
                      <a href="/tag/#python" style="font-size: 9pt; color: #999;">python</a>
                    
                      
                      
                      
                      
                      
                      <a href="/tag/#Swift3.0" style="font-size: 18pt; color: #000;">Swift3.0</a>
                    
                      
                      
                      
                      
                      
                      <a href="/tag/#SDiffuseMenu" style="font-size: 9pt; color: #999;">SDiffuseMenu</a>
                    
                      
                      
                      
                      
                      
                      <a href="/tag/#Animation" style="font-size: 9pt; color: #999;">Animation</a>
                    
                      
                      
                      
                      
                      
                      <a href="/tag/#XCTest" style="font-size: 9pt; color: #999;">XCTest</a>
                    
                      
                      
                      
                      
                      
                      <a href="/tag/#fastlane" style="font-size: 9pt; color: #999;">fastlane</a>
                    
                </div>
            </div>

            <!-- <div class="side">
                <div>
                    <i class="fa fa-external-link"></i>
                    Links
                </div>
                <ul  class="content-ul">

                </ul>
            </div> -->
        </div>
    </div>
</div>
<!-- <script src="/js/scroll.min.js " charset="utf-8"></script> -->
<!-- <script src="/js/pageContent.js " charset="utf-8"></script> -->


    <footer class="site-footer">


    <div class="wrapper">

        <p class="description">
             3行代码的技术博客 
        </p>
        <p class="contact">
            Contact me at:  
            <a href="mailto:mythziven@gmail.com" title="email"><i class="fa fa-envelope-o" aria-hidden="true"></i></a>   -->
<!--            <a href="mailto:mythziven@gmail.com" title="email"><i class="fa fa-envelope-o" aria-hidden="true"></i></a>-->
<!--            <a href="mailto:mythziven@gmail.com" title="email"><i class="fa fa-envelope-o" aria-hidden="true"></i></a>        -->


        </p>
        <p>
            本站总访问量<span id="busuanzi_value_site_pv"></span>次，本站访客数<span id="busuanzi_value_site_uv"></span>人次，本文总阅读量<span id="busuanzi_value_page_pv"></span>次
        </p>
        <p class="power">
        
            <span>
                Site powered by <a href="https://jekyllrb.com/">Jekyll</a> & <a href="https://pages.github.com/">Github Pages</a>.
            </span>

          <!--   <span>
                Theme designed by <a href="https://github.com/mythkiven">MyKiven</a>.
            </span> -->

        </p>
    </div>
</footer>
<script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>

    <div class="back-to-top">
    <a href="#top" class="scroll">
        <i class="fa fa-arrow-up" aria-hidden="true"></i>
    </a>
</div>

    <script src=" /js/main.js " charset="utf-8"></script>
    <script src=" /js/scroll.min.js " charset="utf-8"></script>
  </body>

</html>
